# -*- coding: utf-8 -*-

import os
import logging
import random
import io
from datetime import datetime
from telegram import (
    Update,
    InlineKeyboardButton,
    InlineKeyboardMarkup,
    ChatMember,
    ChatMemberUpdated,
)
from telegram.ext import (
    Application,
    CommandHandler,
    ContextTypes,
    MessageHandler,
    filters,
    CallbackQueryHandler,
    ChatMemberHandler,
    ConversationHandler,
)
from telegram.constants import ParseMode
import psycopg2
from PIL import Image, ImageDraw, ImageFont
import arabic_reshaper
from bidi.algorithm import get_display
import time
import asyncio

# --- ูพฺฉุฑุจูุฏ ุงุตู ---
OWNER_IDS = [7662192190, 6041119040] # ุขุฏโูุง ุนุฏุฏ ุงุฏููโูุง ุงุตู ุฑุจุงุช
SUPPORT_USERNAME = "OLDKASEB" # ูุฒุฑูู ูพุดุชุจุงู ุจุฏูู @
FORCED_JOIN_CHANNEL = "@RHINOSOUL_TM" # ฺฉุงูุงู ุนุถูุช ุงุฌุจุงุฑ ุจุง @
GROUP_INSTALL_LIMIT = 50 # ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ฺฏุฑููโูุง ฺฉู ุฑุจุงุช ูโุชูุงูุฏ ุฏุฑ ุขูโูุง ูุตุจ ุดูุฏ
INITIAL_LIVES = 10 # ุชุนุฏุงุฏ ุฌุงู ุงููู ุฏุฑ ุจุงุฒ ุญุฏุณ ฺฉููู

# --- ุชุนุฑู ุญุงูุชโูุง ูฺฉุงููู ---
# ุจุฑุง ุจุงุฒ ูุงุฑฺ
ASKING_GOD_USERNAME, CONFIRMING_GOD = range(2)
# ุจุฑุง ุจุงุฒ ุญุฏุณ ุนุฏุฏ
SELECTING_RANGE, GUESSING = range(2, 4)
# ุจุฑุง ุงุนุชุฑุงู ุณูุงุฑุด
ENTERING_ETERAF_TEXT = range(4, 5)

# --- ูุณุช ฺฉููุงุช ู ุฌููุงุช (ุจุฏูู ุชุบุฑ) ---
WORD_LIST = [
    "ุงุณุจ", "ฺฏุงู", "ฺฏูุณููุฏ", "ุจุฒ", "ูุฑุบ", "ุฎุฑูุณ", "ุฌูุฌู", "ุงุฑุฏฺฉ", "ุบุงุฒ", "ุจูููููู", "ุดุชุฑ", "ุงูุงุบ", "ูุงุทุฑ", "ุณฺฏ", "ฺฏุฑุจู",
    "ููุด", "ุฎุฑฺฏูุด", "ููุณุชุฑ", "ุฎูฺฉฺู", "ุณูุฌุงุจ", "ูุงฺฉูพุดุช", "ูุงุฑ", "ุชูุณุงุญ", "ุณูุณูุงุฑ", "ูุงุฑูููฺฉ", "ููุฑุจุงุบู", "ูุฒุบ",
    "ูุงู", "ฺฉูุณู", "ูููฺฏ", "ุฏููู", "ูุดุชูพุง", "ุนุฑูุณ", "ุฏุฑุง", "ุณุชุงุฑู", "ุฎุฑฺูฺฏ", "ูฺฏู", "ุตุฏู", "ุญูุฒูู",
    "ุดุฑ", "ุจุจุฑ", "ูพููฺฏ", "ูุฒูพููฺฏ", "ฺฏุฑฺฏ", "ุฑูุจุงู", "ุดุบุงู", "ฺฉูุชุงุฑ", "ุฎุฑุณ", "ฺฏุฑุงุฒ", "ฺฏูุฒู", "ุขูู", "ุฌุจุฑ", "ฺฏูุฑุฎุฑ",
    "ูู", "ฺฉุฑฺฏุฏู", "ุงุณุจ", "ุขุจ", "ุฒุฑุงูู", "ฺฉุงูฺฏูุฑู", "ฺฉูุงูุง", "ูพุงูุฏุง", "ูููู", "ฺฏูุฑู", "ุดุงููพุงูุฒู", "ุงูุฑุงูฺฏูุชุงู",
    "ุฎูุงุด", "ุฌุบุฏ", "ุนูุงุจ", "ุดุงูู", "ุจุงุฒ", "ฺฉุฑฺฉุณ", "ูุงุดุฎูุฑ", "ฺฉูุงุบ", "ุฒุงุบ", "ฺฏูุฌุดฺฉ", "ฺฉุจูุชุฑ", "ููุฑ", "ุงฺฉุฑู",
    "ูพุฑุณุชู", "ุจูุจู", "ููุงุฑ", "ุณูุฑู", "ุทูุท", "ูุฑุบ", "ุนุดู", "ูุฑุบ", "ููุง", "ุฏุงุฑฺฉูุจ", "ูพูฺฏูุฆู", "ุดุชุฑูุฑุบ", "ููุงููฺฏู",
    "ูพูฺฉุงู", "ูุฑุบุงุจ", "ูู", "ูฺฉ", "ูฺฉ", "ุญูุงุตู", "ุฏุฑูุง", "ฺฉุจฺฉ", "ุจูุฏุฑฺู", "ูุฑูุงูู", "ุทุงููุณ", "ูพุฑูุงูู", "ุดุงูพุฑฺฉ",
    "ุฒูุจูุฑ", "ุนุณู", "ุฒูุจูุฑ", "ูุญุด", "ููุฑฺู", "ููุฑุงูู", "ูพุดู", "ูฺฏุณ", "ุณูุณฺฉ", "ฺฉูุดุฏูุฒฺฉ", "ููุฎ", "ุขุฎููุฏฺฉ", "ุฌุฑุฌุฑฺฉ",
    "ุนูฺฉุจูุช", "ุฑุชู", "ุนูุฑุจ", "ูุฒุงุฑูพุง", "ุตุฏูพุง", "ฺฉุฑู", "ุฎุงฺฉ", "ูพุงูุฏุง", "ุฑุงุณู", "ุณููุฑ", "ููุด", "ฺฉูุฑ", "ุฌูุฌู", "ุชุบ",
    "ฺฏูุฑฺฉู", "ุฑุงฺฉูู", "ูุงูุง", "ุขููพุงฺฉุง", "ุจููุงูู", "ฺฏุงููุด", "ุจุงุณูู", "ฺฉู", "ููฺ", "ุจุฒฺฉูู", "ุณุงูฺฏูุด", "ฺฉุงุฑุงฺฉุงู",
    "ุฌฺฏูุงุฑ", "ูพููุง", "ุจุงุจูู", "ูุงูุฏุฑู", "ูููุฑ", "ูุงุฑููุณุช", "ุชุงูุงุฑู", "ุชูุจู", "ููุฑฺูุฎูุงุฑ", "ุขุฑูุงุฏูู", "ูุงูุจุช",
    "ุฑุงฺฉู", "ูุงูุจุช", "ุชุด", "ููฺฉุงุฑุฏฺฉ", "ูพูุงุชูพูุณ", "ุงฺฉุฏูุง", "ูุงูุงุจ", "ฺฉุงุณูุขุฑ", "ุงูู", "ฺฉู", "ุชูฺฉุงู", "ูุงฺฉุงุฆู",
    "ฺฉุงฺฉุงุชู", "ููุฑูุจู", "ูุฑุบ", "ูฺฏุณุฎูุงุฑ", "ุขูุจุฑุชูุณ", "ูุฑุบ", "ุฏุฑุง", "ูพุงูู", "ฺฏูููุช", "ฺฉูุฑููุฑุงูุช", "ูฺฉ",
    "ุดุฑ", "ุฏุฑุง", "ฺฏุฑุงุฒ", "ุฏุฑุง", "ูุงูุฑูุณ", "ุณููุฑ", "ุขุจ", "ุจูุฑ", "ฺฉูพุจุงุฑุง", "ููุชุฑุง", "ูุงุฑููุช", "ุฑุงุณู",
    "ูุทุจ", "ูููุฑู", "ุชููู", "ุณฺฏ", "ุจฺู", "ฺฏุฑุจู", "ฺฉุฑู", "ุงุณุจ", "ุจุฑู", "ุจุฒุบุงูู", "ฺฏูุณุงูู", "ุชููู", "ุดุฑ", "ุชููู", "ุฎุฑุณ",
    "ุงฺฏูุงูุง", "ุขูุชุงุจูพุฑุณุช", "ฺฏฺฉู", "ุจูุง", "ูพุชูู", "ุขูุงฺฉููุฏุง", "ฺฉุจุฑ", "ูุงูุจุง", "ุฑุชู", "ุงูุน", "ูุงุฑุฒูฺฏ", "ุณููุฏุฑ",
    "ุชุฑุชูู", "ุขฺฉุณูููุชู", "ูพุฑุงูุง", "ฺฏุฑุจููุงู", "ุณุงูููู", "ูุฒูุขูุง", "ุชูู", "ุดูุดุฑูุงู", "ุจุงุฑุงฺฉูุฏุง", "ุงุฑููุงู",
    "ุณูุฑููุงู", "ุงุณุจ", "ุฏุฑุง", "ฺูููุงู", "ุดูุงู", "ุฏุฑุง", "ูุฑุฌุงู", "ุงุณููุฌ", "ุฏุงูุงุณูุฑ", "ุชุฑุงููุฒุงุฑูุณ",
    "ุงุณุชฺฏูุฒุงุฑูุณ", "ุชุฑุณุฑุงุชููพุณ", "ุจุฑุงูุชูุฒุงุฑูุณ", "ูพุชุฑูุฏุงฺฉุชู", "ูุงููุช", "ุจุจุฑ", "ุฏูุฏุงู", "ุดูุดุฑ", "ุงฺุฏูุง", "ููููุณ",
    "ููฺฉูุฑู", "ูพฺฏุงุณูุณ", "ฺฏุฑูู", "ุณูุชูุฑ", "ูพุฑ", "ุฏุฑุง", "ุณุงุฑู", "ููููุณ", "ุณูุฑุบ", "ุนููุง", "ููุง", "ุงฺุฏูุง",
    "ูููุง", "ุฏู", "ุฌู", "ูพุฑ", "ูุฑุดุชู", "ุดุทุงู", "ุฑูุญ", "ุดุจุญ", "ุฒุงูุจ", "ุฎููุขุดุงู", "ฺฏุฑฺฏูู", "ูููุง", "ุงุณฺฉูุช",
    "ุนููุง", "ูุงุฑูุงู", "ูุงุจุณุชุฑ", "ฺฉุงูุงูุงุฑ", "ุงุฎุชุงูพูุณ", "ุจุงุฏฺฉูฺฉูุงู", "ูพุฑูุงูููุงู", "ูุฑุดุชููุงู", "ุฏููฺฉูุงู",
    "ุฌุฑุงุญูุงู", "ุทูุทูุงู", "ฺฏุงูฺฉูุณู", "ฺฺฉุดฺฉูุณู", "ุจุจุฑฺฉูุณู", "ูููฺฏ", "ูุงุชู", "ุงูุฑฺฉุง", "ูููฺฏ", "ุขุจ", "ูููฺฏ", "ฺฏูฺูพุดุช",
    "ูููฺฏ", "ุณูุฏ", "ุจููฺฏุง", "ูุงุฑูุงู", "ุฎูฺฉ", "ุฏุฑุง", "ุณฺฏ", "ุขุจ", "ฺฏุฑุจู", "ูุญุด", "ุณุฑูุงู", "ุงูุณููุช", "ูุดู",
    "ฺฉูฺฏุงุฑ", "ฺฉุงูุช", "ุฏูฺฏู", "ููฺฉ", "ุฑูุจุงู", "ูุทุจ", "ูพูููฺฉุช", "ุงุฑูู", "ููฺฉ", "ฺฏูุฒู", "ุดูุงู", "ููุณ", "ฺฉุงุฑุจู",
    "ุขุข", "ฺฏุงูฺฏู", "ูพูุชู", "ููุฑุณ", "ุชุงุฑุณุฑ", "ููุฑุจุงุบู", "ุฏุฑุฎุช", "ููุฑุจุงุบู", "ุณู", "ููุฑุจุงุบู", "ูพฺฉุงู",
    "ููุฑุจุงุบู", "ฺฏูุฌููุฑูฺฏ", "ูุงุฑ", "ูพุฑูุฏู", "ูุงุฑ", "ุฏุฑุฎุช", "ูุงุฑ", "ูุฑุฌุงู", "ูุงฺฉูพุดุช", "ฺุฑู", "ูุงฺฉูพุดุช", "ุณุจุฒ",
    "ูุงฺฉูพุดุช", "ูพูุฒูุนูุงุจ", "ูุงฺฉูพุดุช", "ุงูฺฏุงุชูุฑ", "ฺฉุงูู", "ฺฉุฑูฺฉูุฏู", "ฺฏุงุฑุงู", "ุชูุขุชุงุฑุง", "ุงฺุฏูุง", "ฺฉูููุฏู",
    "ุจุฒูุฌู", "ูุงุฑุงููุณ", "ุณูุณฺฉ", "ูุฑฺฉูู", "ุณูุณฺฉ", "ฺฏูุฒู", "ุณูุณฺฉ", "ฺฉุฑฺฏุฏู", "ุณูุณฺฉ", "ุฌูุงูุฑ", "ุดุจุชุงุจ", "ฺฉุฑู",
    "ุดุจุชุงุจ", "ุฒูุจูุฑ", "ูุฌุงุฑ", "ุฒูุจูุฑ", "ฺฉุงุบุฐ", "ุฒูุจูุฑ", "ุนูฺฉุจูุช", "ูุฑู", "ฺฉูู", "ุดูพุด", "ฺฉฺฉ", "ุณุงุณ", "ุนูุฑุจ", "ุจุงุฏ",
    "ุนูุฑุจ", "ุดูุงู", "ุนูฺฉุจูุช", "ุดูุงู", "ุนูฺฉุจูุช", "ุดฺฉุงุฑ", "ุนูฺฉุจูุช", "ฺฏุฑฺฏ", "ุนูฺฉุจูุช", "ูพุฑูุฏูุฎูุงุฑ", "ฺฏููุงุซ",
    "ุจูู", "ุณุงู", "ุนูฺฉุจูุช", "ูพุดุช", "ูุฑูุฒ", "ุนูฺฉุจูุช", "ฺฏูุดููุดู", "ููููุง", "ุฎุฑุฎุงฺฉ", "ูููพุฏ",
    "ุฒูู", "ุฎูุฑุดุฏ", "ูุงู", "ุณุชุงุฑู", "ุณุงุฑู", "ฺฉูฺฉุดุงู", "ุขุณูุงู", "ุงุจุฑ", "ุจุงุฑุงู", "ุจุฑู", "ุชฺฏุฑฺฏ", "ูู", "ุดุจูู", "ุฎ",
    "ุจุงุฏ", "ุทููุงู", "ฺฏุฑุฏุจุงุฏ", "ุฑุนุฏ", "ุจุฑู", "ุตุงุนูู", "ุฑูฺฏูฺฉูุงู", "ุดูู", "ูุฌุฑ", "ุบุฑูุจ", "ุทููุน", "ฺฉุณูู", "ุฎุณูู",
    "ฺฉูู", "ููู", "ุฏุงููู", "ุชูพู", "ุฏุฑู", "ุฌูฺฏู", "ุฏุดุช", "ุจุงุจุงู", "ฺฉูุฑ", "ุตุฎุฑู", "ุณูฺฏ", "ุฎุงฺฉ", "ฺฏู", "ุดู", "ูุงุณู",
    "ุฌูฺฏู", "ุจุดู", "ูุฑุชุน", "ฺููุฒุงุฑ", "ุจุงุชูุงู", "ุชุงูุงุจ", "ูุฑุฏุงุจ", "ุฑูุฏ", "ุฑูุฏุฎุงูู", "ููุฑ", "ุฌูุจุงุฑ", "ฺุดูู", "ุขุจุดุงุฑ",
    "ุฏุฑุง", "ุงูุงููุณ", "ุฎูุฌ", "ุณุงุญู", "ุฌุฒุฑู", "ุดุจูุฌุฒุฑู", "ุฏูุงุบู", "ุขุจุฑุงูู", "ุชูฺฏู", "ฺฉุงูุงู", "ุฏุฑุงฺู", "ุจุฑฺฉู",
    "ููุฌ", "ุฌุฒุฑ", "ูุฏ", "ฺฏุฑุฏุงุจ", "ุขุชุดูุดุงู", "ฺฏุฏุงุฒู", "ุฏูุงูู", "ุฎุงฺฉุณุชุฑ", "ุฒูุฒูู", "ฺฏุณู", "ุณููุงู", "ุณู", "ุจููู",
    "ุฑุงูุด", "ุฒูู", "ุฎุดฺฉุณุงู", "ูุญุท", "ุขููุฏฺฏ", "ูุญุท", "ุฒุณุช", "ุงฺฉูุณุณุชู", "ุฌุบุฑุงูุง", "ูุงุฑู", "ุงููู", "ุขุจ", "ููุง",
    "ุฏูุง", "ุฑุทูุจุช", "ูุดุงุฑ", "ุฌู", "ุงุชูุณูุฑ", "ุงูุงููุณู", "ุขูุฑูุง", "ุงุฑููพุง", "ุขุณุง", "ุขูุฑฺฉุง", "ูุทุจ", "ุดูุงู", "ุฌููุจ",
    "ุงุณุชูุง", "ูุฏุงุฑ", "ูุตูุงูููุงุฑ", "ุทูู", "ุฌุบุฑุงูุง", "ุนุฑุถ", "ฺฉุฑู", "ุดูู", "ูุทุจ", "ฺฉูุฑุจุง", "ุงููุงุณ", "ุทูุง", "ููุฑู",
    "ูุณ", "ุขูู", "ุณุฑุจ", "ุฑู", "ุขูููููู", "ุฒุบุงู", "ุณูฺฏ", "ููุช", "ฺฏุงุฒ", "ูุนุฏู", "ุบุงุฑ", "ููุฏู", "ฺุงู", "ุขุฑุชุฒู",
    "ุฎฺุงู", "ุทุจุน", "ฺฉูู", "ุฎ", "ุชูุฏุฑุง", "ุชุงฺฏุง", "ุณุงูุงูุง", "ุงุณุชูพ", "ููุงุช", "ูพุฑุชฺฏุงู", "ุตุฎุฑู", "ูุฑุฌุงู", "ุฎุฒู",
    "ุฌูุจฺฉ", "ฺฏุงู", "ุฏุฑุฎุช", "ุจูุชู", "ฺฏู", "ุดฺฉููู", "ุบูฺู", "ุจุฑฺฏ", "ุดุงุฎู", "ุชูู", "ุฑุดู", "ุณุงูู", "ููู", "ุฏุงูู",
    "ุณุจุฒู", "ุนูู", "ฺฉุงฺฉุชูุณ", "ูพฺฺฉ", "ููููุฑ", "ุงุฑฺฉุฏู", "ุฑุฒ", "ูุงูู", "ูุฑฺฏุณ", "ุจููุดู", "ูุฑู", "ุงุณูู", "ุณุฑู",
    "ฺฉุงุฌ", "ุจููุท", "ุงูุฑุง", "ุจุฏ", "ฺูุงุฑ", "ุตููุจุฑ", "ฺฏุฑุฏู", "ุจุงุฏุงู", "ูพุณุชู", "ุฎุฑูุง", "ูุงุฑฺฏู", "ุฒุชูู", "ุงูฺฏูุฑ",
    "ุณุจ", "ูพุฑุชูุงู", "ููู", "ููุฒ", "ุงูุจู", "ุขูุงูุงุณ", "ุชูุชูุฑูฺฏ", "ฺฏูุงุณ", "ุขูุจุงูู", "ููู", "ุดูู", "ุฒุฑุฏุขูู",
    "ุขูู", "ููุฏูุงูู", "ุฎุฑุจุฒู", "ุทุงูุจ", "ุฎุงุฑ", "ฺฏูุฌู", "ูุฑูฺฏ", "ูพุงุฒ", "ุณุฑ", "ุณุจุฒูู", "ููุฌ", "ฺฉูู", "ฺฉุงูู",
    "ุงุณููุงุฌ", "ูุงุฑฺ", "ููุจุง", "ูุฎูุฏ", "ุนุฏุณ", "ุจุฑูุฌ", "ฺฏูุฏู", "ุฌู", "ุฐุฑุช", "ุงุฏูู", "ุฒุนูุฑุงู", "ุฒูุฌุจู", "ุฏุงุฑฺู",
    "ูููู", "ููฺฉ", "ุดฺฉุฑ", "ุนุณู", "ฺฉูฺฉุดุงู", "ุฑุงู", "ุดุฑ", "ุขูุฏุฑููุฏุง", "ุณุญุงุจ", "ุฎูุดู", "ูพุฑูู", "ุดูุงุจุณูฺฏ", "ุดูุงุจ",
    "ุฏูุจุงููุฏุงุฑ", "ุณุงุฑฺฉ", "ููุธููู", "ุดูุณ", "ุฌุงุฐุจู", "ูุถุง", "ุฒูุงู", "ุณุงูฺุงูู", "ฺฉูุชููู", "ุณูุฏ", "ุบูู", "ุณุฑุฎ",
    "ุงุจุฑููุงุฎุชุฑ", "ูพุงูุณุงุฑ", "ฺฉูุงุฒุงุฑ", "ูุงุฏู", "ุชุงุฑฺฉ", "ุงูุฑฺ", "ุจฺฏุจูฺฏ", "ุฌูุงู", "ูุณุช", "ฺฉูุงู", "ูุตู", "ุจูุงุฑ",
    "ุชุงุจุณุชุงู", "ูพุงุฒ", "ุฒูุณุชุงู", "ุทุจุนุช", "ููุธุฑู", "ุงูู", "ุณูพุฏูุฏู", "ฺฏุฑฺฏููุด", "ูููุดุจ", "ุธูุฑ", "ุนุตุฑ", "ุตุจุญ",
    "ุงูุงููุณ", "ุขุฑุงู", "ุงุทูุณ", "ููุฏ", "ููุฌูุฏ", "ุดูุงู", "ุฌููุจ", "ุฏุฑุง", "ุฎุฒุฑ", "ูุฏุชุฑุงูู", "ุณุฑุฎ", "ฺฉุงุฑุงุฆุจ",
    "ุฑูุฏ", "ุขูุงุฒูู", "ูู", "ุงูฺฏุชุณู", "ูุณุณูพ", "ฺฉูฺฏู", "ุจุงุจุงู", "ุตุญุฑุง", "ุจุฒุฑฺฏ", "ฺฏุจ", "ฺฉุงูุงูุงุฑ", "ุนุฑุจุณุชุงู",
    "ฺฉูููุง", "ููุงูุง", "ุขููพ", "ุขูุฏ", "ุฑุงฺฉ", "ุงูุฑุณุช", "ฺฉููุงูุฌุงุฑู", "ุฏูุงููุฏ", "ุขุชุดูุดุงู", "ูุฒูู", "ููุฌ", "ุงุชูุง",
    "ุฌุฒุงุฑ", "ูุงูุง", "ููุงุฑ", "ูุงูุฏู", "ฺฏุงูุงูพุงฺฏูุณ", "ุฌูฺฏููุง", "ุขูุงุฒูู", "ฺฉูฺฏู", "ุจูุฑูุฆู", "ููุงุฏ", "ูุนุฏู",
    "ฺฉุฑุณุชุงู", "ฺฉูุงุฑุชุฒ", "ุงููุช", "ุฒูุฑุฏ", "ุงููุงุณ", "ูุฑูุฒู", "ุนูู", "ูุฑูุฑ", "ฺฏุฑุงูุช", "ุขูฺฉ",
    "ุจุฒุฑฺฏ", "ฺฉูฺฺฉ", "ุจููุฏ", "ฺฉูุชุงู", "ูพูู", "ุจุงุฑฺฉ", "ุถุฎู", "ูุงุฒฺฉ", "ุณูฺฏู", "ุณุจฺฉ", "ฺฏุฑู", "ุณุฑุฏ", "ุฏุงุบ", "ุฎ",
    "ุฒุจุง", "ุฒุดุช", "ุฎูุดฺฏู", "ุจุฏฺฏู", "ุฌุฐุงุจ", "ุฏูุฑุจุง", "ุฏูุณุชุฏุงุดุชู", "ููุฑุชุงูฺฏุฒ", "ุฎูุจ", "ุจุฏ", "ุนุงู", "ุงูุชุถุงุญ",
    "ูู", "ุถุนู", "ุณุงูู", "ุจูุงุฑ", "ุชูุฏุฑุณุช", "ูุงุชูุงู", "ุณุฑุน", "ุขูุณุชู", "ฺฉูุฏ", "ุชูุฏ", "ุดุงุฏ", "ุบูฺฏู", "ุฎูุดุญุงู",
    "ูุงุฑุงุญุช", "ุนุตุจุงู", "ุขุฑุงู", "ุฎุดูฺฏู", "ููุฑุจุงู", "ูุงููุฑุจุงู", "ุณุฎุชฺฏุฑ", "ุขุณุงูฺฏุฑ", "ุจุงููุด", "ฺฉู ููุด", "ูุงุจุบู",
    "ุฎูฺฏ", "ุฒุฑูฺฏ", "ุชูุจู", "ฺฉูุดุง", "ูพุฑุชูุงุด", "ุจุฎุงู", "ุดุฌุงุน", "ุชุฑุณู", "ุฏูุฑ", "ุจุฒุฏู", "ุฌุณูุฑ", "ูุญุชุงุท", "ุตุงุฏู",
    "ุฏุฑูุบฺฏู", "ุฑุงุณุชฺฏู", "ูุฑุจฺฉุงุฑ", "ููุงุฏุงุฑ", "ุจููุง", "ุฎุงูุชฺฉุงุฑ", "ุจุฎุดูุฏู", "ุฎุณุณ", "ุณุฎุงูุชููุฏ", "ุชูฺฏูุธุฑ", "ูููู",
    "ูุงูููู", "ูพุฑูุฒ", "ุดฺฉุณุชุฎูุฑุฏู", "ุจุฑูุฏู", "ุจุงุฒูุฏู", "ุซุฑูุชููุฏ", "ููุฑ", "ูพููุฏุงุฑ", "ุจูู", "ุฌุฏุฏ", "ูุฏู",
    "ฺฉููู", "ูู", "ุชุงุฒู", "ุจุงุช", "ุฌูุงู", "ูพุฑ", "ูุงูุณุงู", "ููุฌูุงู", "ฺฉูุฏฺฉ", "ููุฒุงุฏ", "ุฑูุดู", "ุชุงุฑฺฉ", "ุชุฑู",
    "ุฏุฑุฎุดุงู", "ูุงุช", "ุดูุงู", "ฺฉุฏุฑ", "ุณูุฏ", "ุณุงู", "ูุฑูุฒ", "ุขุจ", "ุฒุฑุฏ", "ุณุจุฒ", "ูุงุฑูุฌ", "ุจููุด", "ุตูุฑุช",
    "ููููุง", "ุฎุงฺฉุณุชุฑ", "ุทูุง", "ููุฑูุง", "ุตุงู", "ูุงุตุงู", "ูุฑู", "ุฒุจุฑ", "ุฎุดู", "ูุทู", "ฺฏุฑุฏ", "ูุฑุจุน", "ูุซูุซ",
    "ูุณุชุทู", "ุฏุงุฑู", "ุจุถ", "ุชุฒ", "ฺฉูุฏ", "ุดฺฉุณุชู", "ุณุงูู", "ุชุฑฺฉุฎูุฑุฏู", "ุชูุฒ", "ฺฉุซู", "ุขููุฏู", "ูพุงฺฉ", "ูุฑุชุจ",
    "ูุงูุฑุชุจ", "ุดููุบ", "ุฎููุช", "ูพุฑ", "ุฎุงู", "ฺฉุงูู", "ูุงูุต", "ุฏุฑุณุช", "ุบูุท", "ุตุญุญ", "ุงุดุชุจุงู", "ููู", "ุจุงููุช",
    "ุถุฑูุฑ", "ุบุฑุถุฑูุฑ", "ุณุงุฏู", "ูพฺุฏู", "ุฏุดูุงุฑ", "ุขุณุงู", "ุฑุงุญุช", "ุณุฎุช", "ุดุฑู", "ุชูุฎ", "ุดูุฑ", "ุชุฑุด", "ุจูุฒู",
    "ุฎูุดูุฒู", "ุจุฏูุฒู", "ุชูุฏ", "ููุงู", "ุฒูุฏู", "ูุฑุฏู", "ุจุฏุงุฑ", "ุฎูุงุจ", "ููุดุงุฑ", "ุจููุด", "ุฎุณ", "ุฎุดฺฉ", "ูุฑุทูุจ",
    "ูููุงฺฉ", "ูุงููู", "ุบุฑูุงููู", "ูุฌุงุฒ", "ุบุฑูุฌุงุฒ", "ุฑุณู", "ุบุฑุฑุณู", "ุดุฎุต", "ุนููู", "ุฎุตูุต", "ุฏููุช",
    "ุขุฒุงุฏ", "ุฒูุฏุงู", "ุฑูุง", "ุงุณุฑ", "ุฎุทุฑูุงฺฉ", "ุงูู", "ุจุฎุทุฑ", "ุขุฑุงู", "ูพุฑุณุฑูุตุฏุง", "ุณุงฺฉุช", "ุดููุบ", "ุฎุฌุงูุช",
    "ูพุฑุฑู", "ุฌุณูุฑ", "ฺฏุณุชุงุฎ", "ููุฏุจ", "ุจุงุฏุจ", "ุจุงููุงุฑ", "ุณุจฺฉุณุฑ", "ูุชู", "ุฌูู", "ุนุงูู", "ุฏูุงูู", "ูุฌููู", "ุฎุฑุฏููุฏ",
    "ุงุจูู", "ุฏุงูุง", "ูุงุฏุงู", "ุจุงุณูุงุฏ", "ุจุณูุงุฏ", "ููุฑููุฏ", "ุจููุฑ", "ุฎูุงู", "ุชููุฏฺฉุงุฑ", "ูุจุชฺฉุฑ", "ฺฉููุงุฎุช", "ูุชููุน",
    "ุฌุงูุจ", "ฺฉุณูฺฉููุฏู", "ูุฌุงูุงูฺฏุฒ", "ุฎุณุชูฺฉููุฏู", "ุชุฑุณูุงฺฉ", "ูุญุดุชูุงฺฉ", "ุขุฑุงูุจุฎุด", "ุงุณุชุฑุณุฒุง", "ููุฏ", "ูุถุฑ",
    "ุณูุฏููุฏ", "ุจููุฏู", "ฺฏุฑุงู", "ุงุฑุฒุงู", "ููุช", "ุจุงููุช", "ุฑุงฺฏุงู", "ูุฌุงู", "ูุดููุฑ", "ูุนุฑูู", "ฺฏููุงู", "ูุงุดูุงุณ",
    "ุนุฌุจ", "ุบุฑุจ", "ุนุงุฏ", "ูุนููู", "ูุงุฏุฑ", "ฺฉูุงุจ", "ูุฑุงูุงู", "ุฒุงุฏ", "ฺฉู", "ุงูุฏฺฉ", "ฺฉุงู", "ูุงฺฉุงู", "ุงูู",
    "ุขุฎุฑ", "ุงุจุชุฏุง", "ููุง", "ูุงู", "ูุฑฺฉุฒ", "ุฌุงูุจ", "ุฏุงุฎู", "ุฎุงุฑุฌ", "ุจุฑูู", "ุฏุฑูู", "ุจุงูุง", "ูพุงู",
    "ูุจู", "ุจุนุฏ", "ุขูุฏู", "ฺฏุฐุดุชู", "ูุนู", "ฺฉููู", "ุญุงุถุฑ", "ุบุงุจ", "ูุงูุน", "ุฎุงู", "ูุฌุงุฒ", "ุญูู", "ูุตููุน",
    "ุทุจุน", "ุณุงุฎุชฺฏ", "ุงุตู", "ุชููุจ", "ูุซุจุช", "ููู", "ุฎูุซ", "ูุนุงู", "ุบุฑูุนุงู", "ุฑูุดููฺฉุฑ", "ูุชุนุตุจ", "ููุทู",
    "ุงุญุณุงุณ", "ุนูู", "ุชุฎู", "ุชุงุฑุฎ", "ุจุงุณุชุงู", "ูุฏุฑู", "ฺฉูุงุณฺฉ", "ุณูุช", "ูุญู", "ุจูู", "ูู", "ุจูุงูููู",
    "ุฌูุงู", "ููุทููุง", "ุดูุฑ", "ุฑูุณุชุง", "ุนุดุงุฑ", "ุตูุนุช", "ฺฉุดุงูุฑุฒ", "ุชุฌุงุฑ", "ุงุฏุงุฑ", "ูุณฺฉูู", "ุขููุฒุด",
    "ูุฑููฺฏ", "ูุฑุฒุด", "ุณุงุณ", "ุงูุชุตุงุฏ", "ุงุฌุชูุงุน", "ูุธุงู", "ุงููุช", "ูุถุง", "ูพููุงู", "ุขุดฺฉุงุฑ", "ูุฎู",
    "ุนูู", "ูุญุฑูุงูู", "ุณุฑ", "ูุงุจู", "ูุดุงูุฏู", "ูุงูุฑุฆ", "ูุฑุฆ", "ูุงุบุฑ", "ฺุงู", "ุชูพู", "ุงุณุชุฎูุงู", "ุนุถูุงู",
    "ูุฑุฒุฏู", "ุขูุงุฏู", "ุฎุณุชู", "ุณุฑุญุงู", "ูพุฑุงูุฑฺ", "ุจุญุงู", "ุบูุฒุฏู", "ุงูุณุฑุฏู", "ุดุงุฏูุงู", "ุฎูุฏุงู", "ฺฏุฑุงู", "ูุชูฺฉุฑ",
    "ูฺฏุฑุงู", "ูุถุทุฑุจ", "ุขุณูุฏู", "ุญูุงุณุฌูุน", "ุญูุงุณ ูพุฑุช", "ุฏูู", "ุจุฏูุช", "ููุธู", "ุจูุธู", "ูุณูุงุณ", "ุดูุฎุชู", "ูุบุฑูุฑ",
    "ูุชูุงุถุน", "ูุฑูุชู", "ุฎูุฏุฎูุงู", "ูุฏุงฺฉุงุฑ", "ุงุซุงุฑฺฏุฑ", "ุญุณูุฏ", "ุจุฎู", "ุตุจูุฑ", "ุนุฌูู", "ุจูุฑุงุฑ", "ุดฺฉุจุง", "ูุตูู",
    "ุฏูุฏู", "ุจุงุนุชูุงุฏ", "ูุทูุฆู", "ูุดฺฉูฺฉ", "ุจุฏุจู", "ุฎูุดุจู", "ูุงูุนุจู", "ุงุฏูุขูฺฏุฑุง", "ฺฉุงููฺฏุฑุง", "ุนููฺฏุฑุง", "ุญุฑููุง",
    "ุขูุงุชูุฑ", "ุจุงุชุฌุฑุจู", "ุจุชุฌุฑุจู", "ูุชุฎุตุต", "ุชุงุฒูฺฉุงุฑ", "ูุงูุฑ", "ูุงุด", "ุชูุงูุง", "ุนุงุฌุฒ", "ูุฏุฑุชููุฏ", "ุถุนู", "ูุณุชูู",
    "ูุงุจุณุชู", "ุชููุง", "ุงุฌุชูุงุน", "ููุฒู", "ฺฏูุดูฺฏุฑ", "ุจุฑููฺฏุฑุง", "ุฏุฑููฺฏุฑุง", "ุฌุฏ", "ุดูุฎ", "ุจุงูุฒู", "ุจููฺฉ", "ููุณ",
    "ุจุงููฺฉ", "ฺฉุงุฑุฒูุงุชฺฉ", "ุงููุงูุจุฎุด", "ุงูุณุฑุฏูฺฉููุฏู", "ุงูุฏูุงุฑฺฉููุฏู", "ูุงุงูุฏฺฉููุฏู", "ุดฺฏูุชุงูฺฏุฒ", "ุญุฑุชุงูฺฏุฒ",
    "ุจุงูุฑูฺฉุฑุฏู", "ุนุงุฏ", "ูพุดูพุงุงูุชุงุฏู", "ุงุณุชุซูุง", "ุจโูุธุฑ", "ุชฺฉุฑุงุฑ", "ุฎุงูุต", "ูุงุฎุงูุต", "ูุฎููุท", "ฺฉุฏุณุช",
    "ุจูุฏู", "ุดุฏู", "ุฏุงุดุชู", "ฺฉุฑุฏู", "ฺฏูุชู", "ุขูุฏู", "ุฑูุชู", "ุฏุฏู", "ุดูุฏู", "ุฎูุฑุฏู", "ููุดุฏู", "ุฎูุงุจุฏู", "ุจุฏุงุฑ",
    "ูุงูุฏู", "ฺฏุฑูุชู", "ุฏุงุฏู", "ุขูุฑุฏู", "ุจุฑุฏู", "ุณุงุฎุชู", "ุฎุฑุงุจ", "ุดฺฉุณุชู", "ุฏูุฎุชู", "ูพูุดุฏู", "ุฎูุงูุฏู", "ููุดุชู",
    "ฺฉุดุฏู", "ูููุฏู", "ุฏุงูุณุชู", "ุชูุงูุณุชู", "ุฎูุงุณุชู", "ุจุฎุดุฏู", "ุจูุฏู", "ฺุดุฏู", "ููุณ", "ุฒุฏู", "ุงูุชุงุฏู", "ุจููุฏ",
    "ูุดุณุชู", "ุงุณุชุงุฏู", "ุฏูุฏู", "ูพุฑุฏู", "ุฑุงู", "ุฑูุชู", "ุฎุฒุฏู", "ุดูุง", "ูพุฑูุงุฒ", "ุฎูุฏุฏู", "ฺฏุฑู", "ูฺฉุฑ", "ุญุฑู",
    "ุณฺฉูุช", "ูฺฏุงู", "ฺฉุงุฑ", "ุจุงุฒ", "ุงุณุชุฑุงุญุช", "ุฎุฑุฏู", "ูุฑูุฎุชู", "ุงุฌุงุฑู", "ูุฑุถ", "ูพุณ", "ูพุฑุฏุงุฎุช", "ุฏุฑุงูุช", "ุดูุฑุฏู",
    "ุญุณุงุจ", "ุงูุฏุงุฒู", "ฺฏุฑูุชู", "ูุฒู", "ุจุฑุฏู", "ฺุณุจุงูุฏู", "ุฑูฺฏ", "ุทุฑุงุญ", "ููุงุด", "ุนฺฉุงุณ", "ูููุจุฑุฏุงุฑ", "ุขุดูพุฒ",
    "ูพุฎุชู", "ุณุฑุฎ", "ุดุณุชู", "ุชูุฒ", "ูุฑุชุจ", "ุฌูุน", "ูพูู", "ุชุง", "ุจุงุฒ", "ุจุณุชู", "ููู", "ุฑูุดู", "ุฎุงููุด", "ุนูุถ", "ุชุนูุฑ",
    "ุชุบุฑ", "ุฌุณุชุฌู", "ูพุฏุง", "ฺฏู", "ูุฑุงููุด", "ุงุฏุขูุฑ", "ุงุฏ", "ฺฏุฑูุชู", "ุฏุฑุณ", "ุฎูุงูุฏู", "ุขููุฒุด", "ุฏุงุฏู", "ูพุฑุณุฏู",
    "ูพุงุณุฎ", "ุฌูุงุจ", "ุชูุถุญ", "ูุจูู", "ุฑุฏ", "ุฏุนูุช", "ุดุฑูุน", "ุชูุงู", "ุงุฏุงูู", "ูุชููู", "ุตุจุฑ", "ุนุฌูู", "ฺฉูฺฉ", "ุญูุงุช",
    "ุชุดูู", "ุงูุชูุงุฏ", "ูุถุงูุช", "ุจุงูุฑ", "ุดฺฉ", "ุงุนุชูุงุฏ", "ุฎุงูุช", "ุนุดู", "ูุฑุฒุฏู", "ุฏูุณุช", "ุฏุงุดุชู", "ูุชููุฑ", "ุจูุฏู",
    "ุงุญุชุฑุงู", "ฺฏุฐุงุดุชู", "ุชููู", "ูุนุฐุฑุช", "ุฎูุงุณุชู", "ุจุฎุดุฏู", "ุฌูฺฏุฏู", "ูุจุงุฑุฒู", "ุตูุญ", "ูุฐุงฺฉุฑู", "ุชุณูู", "ูุฑุงุฑ",
    "ูพููุงู", "ุญููู", "ุฏูุงุน", "ูพุฑูุฒ", "ุดฺฉุณุช", "ุฎูุฑุฏู", "ุจุฑูุฏู", "ุจุงุฒูุฏู", "ุฑูุงุจุช", "ููฺฉุงุฑ", "ูุดุงุฑฺฉุช", "ุฑูุจุฑ",
    "ุฏูุจุงู", "ูพุฑู", "ุณูุฑ", "ููุงุฌุฑุช", "ุจุงุฒฺฏุดุช", "ูุงูุฏู", "ุฑุดุฏ", "ฺฉูฺฺฉ", "ูพุฑ", "ุฌูุงู", "ูุฑุฏู", "ูุชููุฏ", "ุฒูุฏฺฏ",
    "ููุณ", "ฺฉุดุฏู", "ุณุฑูู", "ุนุทุณู", "ุฎูุงุฒู", "ูุฑุฒุฏู", "ุนุฑู", "ุฎููุฑุฒ", "ุฏุฑุฏ", "ฺฉุดุฏู", "ูุฑุงุฏ", "ุฒูุฒูู", "ุขูุงุฒ",
    "ุณูุช", "ุฌุบ", "ฺฏูุด", "ุฏุงุฏู", "ุตุญุจุช", "ุจุญุซ", "ฺฏูุชฺฏู", "ุณฺฉูุช", "ูุนุฏู", "ุฏุงุฏู", "ูุณู", "ุฎูุฑุฏู", "ุฏุฑูุบ", "ฺฏูุชู",
    "ุตุฏุงูุช", "ุฏุงุดุชู", "ุณุงุฎุชู", "ุงุฌุงุฏ", "ุฎูู", "ุงุจุฏุงุน", "ุงุฎุชุฑุงุน", "ฺฉุดู", "ูุงุจูุฏ", "ูุฑุงู", "ูููุฏู", "ุญูุธ", "ูฺฏูุฏุงุฑ",
    "ูุฑุงูุจุช", "ุฑูุง", "ุชุฑฺฉ", "ุงูุฏุงุฎุชู", "ูพุฑุชุงุจ", "ูู", "ุฏุงุฏู", "ฺฉุดุฏู", "ูุดุงุฑ", "ุญูู", "ฺฏุฐุงุดุชู", "ุจุฑุฏุงุดุชู", "ุงูุชุฎุงุจ",
    "ุณูุงุฑ", "ูพุงุฏู", "ุฑุงููุฏฺฏ", "ูพุงุฑฺฉ", "ูพุฑูุงุฒ", "ูุฑูุฏ", "ุขูุฏู", "ุดูุง", "ฺฉุฑุฏู", "ุบูุงุต", "ุจุงูุง", "ุฑูุชู", "ูพุงู",
    "ุขูุฏู", "ูุงุฑุฏ", "ุฎุงุฑุฌ", "ุนุจูุฑ", "ุฑุฏ", "ุงุฌุงุฏ", "ฺฉุฑุฏู", "ูุฎููุท", "ุฌุฏุง", "ุชูุณู", "ุถุฑุจ", "ุฌูุน", "ุชูุฑู", "ูุญุงุณุจู",
    "ุญุฏุณ", "ุฒุฏู", "ุงูุชุญุงู", "ุชุณุช", "ุขุฒูุงุด", "ุชุฌุฑุจู", "ูุดุงูุฏู", "ุจุฑุฑุณ", "ุชุญูู", "ูุทุงูุนู", "ฺฉูพ", "ฺุงูพ", "ุงุฑุณุงู",
    "ุฏุฑุงูุช", "ุฏุงูููุฏ", "ุขูพููุฏ", "ูุตุจ", "ุญุฐู", "ูพุงฺฉ", "ุฐุฎุฑู", "ุจุงุฒุงุจ", "ุจุฑูุงูู", "ุฑุฒ", "ุทุฑุงุญ", "ุชุญูู",
    "ูพุด", "ุจู", "ุชุตูู", "ฺฏุฑูุชู", "ุงุฌุฑุง", "ุงูุฌุงู", "ุฏูุจุงู", "ฺฉุฑุฏู", "ูุฏุงุช", "ฺฉูุชุฑู", "ูุฏุฑุช", "ุณุงุฒูุงูุฏู",
    "ูุงููู", "ฺฏุฐุงุฑ", "ุฑุง", "ุฏุงุฏู", "ุงูุชุฎุงุจ", "ุญฺฉููุช", "ุงุนุชุฑุงุถ", "ุชุธุงูุฑุงุช", "ุงูููุงุจ", "ุงุตูุงุญ", "ุฌุดู", "ฺฏุฑูุชู",
    "ุนุฒุงุฏุงุฑ", "ุณูฺฏูุงุฑ", "ุงุฒุฏูุงุฌ", "ุทูุงู", "ฺฏุฑูุชู", "ุขุฑุฒู", "ฺฉุฑุฏู", "ุงูุฏูุงุฑ", "ุจูุฏู", "ูุงุงูุฏ", "ุดุฏู", "ุชุฑุณุฏู",
    "ูฺฏุฑุงู", "ุจูุฏู", "ุขุฑุงู", "ุดุฏู", "ูุฌุงู", "ุฒุฏู", "ุดุฏู", "ุดฺฏูุช", "ุฒุฏู", "ุดุฏู", "ุฎุฌุงูุช", "ฺฉุดุฏู", "ุงูุชุฎุงุฑ",
    "ฺฉุฑุฏู", "ุญุณุงุฏุช", "ฺฉุฑุฏู", "ุฏูุชูฺฏ", "ุดุฏู", "ูุฐุช", "ุจุฑุฏู", "ุฑูุฌ", "ุจุฑุฏู", "ุชุญูู", "ฺฉุฑุฏู", "ูููู", "ุดุฏู", "ุดฺฉุณุช",
    "ุฎูุฑุฏู", "ุชูุงุด", "ฺฉุฑุฏู", "ฺฉูุดุด", "ฺฉุฑุฏู", "ุชูุฑู", "ฺฉุฑุฏู", "ุงุณุชุนุฏุงุฏ", "ุฏุงุดุชู", "ูพุดุฑูุช", "ฺฉุฑุฏู", "ูพุณุฑูุช",
    "ฺฉุฑุฏู", "ุซุฑูุชููุฏ", "ุดุฏู", "ููุฑ", "ุดุฏู", "ูุนุฑูู", "ุดุฏู", "ูุฑุงููุด", "ุดุฏู", "ุจู", "ุฏูุง", "ุขูุฏู", "ุงุฒ", "ุฏูุง",
    "ุฑูุชู", "ูู", "ุฏุงุฏู", "ฺุฑุช", "ุฒุฏู", "ุฑูุง", "ุฏุฏู", "ฺฉุงุจูุณ", "ุฏุฏู", "ูุงูุฏู", "ุขู", "ฺฉุดุฏู", "ูุจุฎูุฏ", "ุฒุฏู",
    "ุงุฎู", "ฺฉุฑุฏู", "ูพูฺฉ", "ุฒุฏู", "ฺุดูฺฉ", "ุฒุฏู", "ุฌูุฏู", "ููุฑุช", "ุฏุงุฏู", "ูุณุฏู", "ูฺฉุฏู", "ุชู", "ฺฉุฑุฏู", "ุจุงูุง",
    "ุขูุฑุฏู", "ุฎุฑุงุดุฏู", "ุฎุงุฑุงูุฏู", "ููุงุฒุด", "ฺฉุฑุฏู", "ุจูุณุฏู", "ุจุบู", "ฺฉุฑุฏู", "ุฏุณุช", "ุฏุงุฏู", "ูุดุช", "ุฒุฏู", "ูฺฏุฏ", "ุฒุฏู",
    "ุถุฑุจู", "ุฒุฏู", "ุจุฑุฏู", "ุณูุฑุงุฎ", "ฺฉุฑุฏู", "ฺฉูุฏู", "ฺฉุงุดุชู", "ุขุจุงุฑ", "ฺฉุฑุฏู", "ูุฑุณ", "ฺฉุฑุฏู", "ุจุฑุฏุงุดุช", "ฺฉุฑุฏู",
    "ุดุฎู", "ุฒุฏู", "ุฏุฑู", "ฺฉุฑุฏู", "ุจุงูุชู", "ุฑุณุฏู", "ุชุงุจุฏู", "ฺฏุฑู", "ุฒุฏู", "ุจุงุฒ", "ฺฉุฑุฏู", "ุงุชู", "ฺฉุฑุฏู", "ฺฏุฑุฏฺฏุฑ",
    "ฺฉุฑุฏู", "ุฌุงุฑู", "ฺฉุฑุฏู", "ุช", "ฺฉุดุฏู", "ฺฏุฑุฏุด", "ุฑูุชู", "ฺฉููููุฑุฏ", "ฺฉุฑุฏู", "ุตุฎุฑู", "ููุฑุฏ", "ฺฉุฑุฏู", "ุงุณฺฉ",
    "ฺฉุฑุฏู", "ููุฌ", "ุณูุงุฑ", "ฺฉุฑุฏู", "ูุงูุฑุงู", "ฺฉุฑุฏู", "ูุงูฺฏุฑ", "ฺฉุฑุฏู", "ุดฺฉุงุฑ", "ฺฉุฑุฏู", "ูุฏู", "ฺฏุฑ", "ฺฉุฑุฏู",
    "ุดูฺฉ", "ฺฉุฑุฏู", "ุฌุงุฎุงู", "ุฏุงุฏู", "ุฎู", "ุดุฏู", "ุฏุฑุงุฒ", "ฺฉุดุฏู", "ฺุฑุฎุฏู", "ูุบุฒุฏู", "ุณูุฑ", "ุฎูุฑุฏู", "ุงุดุงุฑู",
    "ฺฉุฑุฏู", "ุตุฏุง", "ฺฉุฑุฏู", "ุฏุนูุง", "ฺฉุฑุฏู", "ุขุดุช", "ฺฉุฑุฏู", "ุชููุช", "ุฒุฏู", "ุฏูุงุน", "ฺฉุฑุฏู", "ุดูุงุฏุช", "ุฏุงุฏู", "ุงุนุชุฑุงู",
    "ฺฉุฑุฏู", "ุงูฺฉุงุฑ", "ฺฉุฑุฏู", "ุชูุฏุฏ", "ฺฉุฑุฏู", "ููู", "ุฏุงุฏู", "ุจุฏููู", "ฺฉุฑุฏู", "ููุชุธุฑ", "ูุงูุฏู", "ุฎุฏุงุญุงูุธ", "ฺฉุฑุฏู",
    "ุณูุงู", "ฺฉุฑุฏู", "ูุนุฑู", "ฺฉุฑุฏู", "ุขุดูุง", "ุดุฏู", "ุบุจุช", "ฺฉุฑุฏู", "ุฎุจุฑฺู", "ฺฉุฑุฏู", "ูุฎุฑูุฑูุด", "ฺฉุฑุฏู", "ูพุฒ",
    "ุฏุงุฏู", "ุดฺฉุงุช", "ฺฉุฑุฏู", "ุบุฑ", "ุฒุฏู", "ุชุญุณู", "ฺฉุฑุฏู", "ุณุชุงุด", "ฺฉุฑุฏู", "ุณุฑุฒูุด", "ฺฉุฑุฏู", "ุชูุจู", "ฺฉุฑุฏู", "ุชุดูู",
    "ฺฉุฑุฏู", "ุฌุงุฒู", "ุฏุงุฏู", "ุฌุฑูู", "ฺฉุฑุฏู", "ุญฺฉู", "ฺฉุฑุฏู", "ุขุฒุงุฏ", "ฺฉุฑุฏู", "ุฒูุฏุงู", "ฺฉุฑุฏู", "ุชุจุนุฏ", "ฺฉุฑุฏู",
    "ุงุณุชุฎุฏุงู", "ฺฉุฑุฏู", "ุงุฎุฑุงุฌ", "ฺฉุฑุฏู", "ุงุณุชุนูุง", "ุฏุงุฏู", "ุจุงุฒูุดุณุชู", "ุดุฏู", "ุณุฑูุงู", "ฺฏุฐุงุฑ", "ฺฉุฑุฏู", "ูพุณ",
    "ุงูุฏุงุฒ", "ฺฉุฑุฏู", "ุฎุฑุฌ", "ฺฉุฑุฏู", "ูุฏุฑ", "ุฏุงุฏู", "ฺฏุฏุง", "ฺฉุฑุฏู", "ุฏุฒุฏ", "ฺฉุฑุฏู", "ฺฉูุงูุจุฑุฏุงุฑ", "ฺฉุฑุฏู", "ุชููุจ",
    "ฺฉุฑุฏู", "ุงุซุจุงุช", "ฺฉุฑุฏู", "ุงุณุชุฏูุงู", "ฺฉุฑุฏู", "ูุชุฌู", "ฺฏุฑูุชู", "ูุฑุถ", "ฺฉุฑุฏู", "ุฎูุงุตู", "ฺฉุฑุฏู", "ุชุฑุฌูู", "ฺฉุฑุฏู",
    "ุชูุณุฑ", "ฺฉุฑุฏู", "ููู", "ููู", "ฺฉุฑุฏู", "ูุฑุงุด", "ฺฉุฑุฏู", "ุญุฐู", "ฺฉุฑุฏู", "ุงุถุงูู", "ฺฉุฑุฏู", "ูุตู", "ฺฉุฑุฏู", "ูุทุน",
    "ฺฉุฑุฏู", "ุฑูุดู", "ูฺฉุฑ", "ฺฉุฑุฏู", "ุชุงุฑฺฉ", "ูฺฉุฑ", "ฺฉุฑุฏู", "ุงูุถุง", "ฺฉุฑุฏู", "ููุฑ", "ุฒุฏู", "ุจุงุทู", "ฺฉุฑุฏู", "ุชุงุฏ",
    "ฺฉุฑุฏู", "ุงุจุทุงู", "ฺฉุฑุฏู", "ุตุฏูุฑ", "ฺฉุฑุฏู", "ุฏุฑุฎูุงุณุช", "ฺฉุฑุฏู", "ุฏุณุชูุฑ", "ุฏุงุฏู", "ุฎูุงูุด", "ฺฉุฑุฏู", "ุงูุชูุงุณ", "ฺฉุฑุฏู",
    "ูุฑูุงู", "ุฏุงุฏู", "ุงุทุงุนุช", "ฺฉุฑุฏู", "ุณุฑูพฺ", "ฺฉุฑุฏู", "ุดูุฑุด", "ฺฉุฑุฏู", "ูุงู", "ฺฉุฑุฏู", "ุขุบุงุฒ", "ฺฉุฑุฏู", "ูพุงุงู",
    "ุฏุงุฏู", "ุฎุชู", "ฺฉุฑุฏู"
]

TYPING_SENTENCES = [
    "ุฏุฑ ฺฉ ุฏูฺฉุฏู ฺฉูฺฺฉ ูุฑุฏ ุฒูุฏฺฏ ูฺฉุฑุฏ ฺฉู ุจู ุดุฌุงุนุช ู ุฏุงูุง ูุดููุฑ ุจูุฏ", "ููุงูุฑ ุจูุงฺฉฺู ูพุชุงูุณู ุงุฌุงุฏ ุชุญูู ุฏุฑ ุตูุงุน ูุฎุชูู ุฑุง ุฏุงุฑุฏ", 
    "ุงุฏฺฏุฑ ฺฉ ุฒุจุงู ุจุฑูุงูู ููุณ ุฌุฏุฏ ูุชูุงูุฏ ุฏุฑูุง ุฌุฏุฏ ุจู ุฑู ุดูุง ุจุงุฒ ฺฉูุฏ", "ฺฉุชุงุจ ุฎูุงูุฏู ุจูุชุฑู ุฑุงู ุจุฑุง ุณูุฑ ุจู ุฏูุงูุง ุฏฺฏุฑ ุจุฏูู ุชุฑฺฉ ฺฉุฑุฏู ุฎุงูู ุงุณุช", 
    "ุดุจ ูุง ูพุฑุณุชุงุฑู ฺฉูุฑ ููุธุฑู ุง ูุฑุงููุด ูุดุฏู ุฑุง ุจู ููุงุด ูฺฏุฐุงุฑูุฏ", "ุชู ูุง ุจุฑุง ุฑุณุฏู ุจู ุงู ููููุช ุชูุงุด ูุง ุดุจุงูู ุฑูุฒ ุฒุงุฏ ุงูุฌุงู ุฏุงุฏ", 
    "ุญูุธ ูุญุท ุฒุณุช ูุธูู ุชฺฉ ุชฺฉ ูุง ุจุฑุง ูุณู ูุง ุขูุฏู ุงุณุช", "ููููุช ุฏุฑ ุฒูุฏฺฏ ูุงุฒููุฏ ุชูุงุด ูพุดุชฺฉุงุฑ ู ฺฉู ุดุงูุณ ุงุณุช", 
    "ุงูุชุฑูุช ุงุดุงุก ุฏูุง ุฑุง ูุชุตูุฑ ูุดูุฏ ฺฉู ููู ฺุฒ ุจู ูู ูุชุตู ุงุณุช", "ุจุฒุฑฺฏุชุฑู ูุงุฌุฑุงุฌู ฺฉู ูุชูุงู ุฏุงุดุชู ุจุงุด ุฒูุฏฺฏ ฺฉุฑุฏู ุฑูุงูุงุช ุงุณุช", 
    "ุจุฑุง ุญู ูุณุงุฆู ูพฺุฏู ฺฏุงู ุจุงุฏ ุงุฒ ุฒูุงุง ูุฎุชูู ุจู ุขููุง ูฺฏุงู ฺฉุฑุฏ", "ุชุงุฑุฎ ูพุฑ ุงุฒ ุฏุฑุณ ูุง ุงุณุช ฺฉู ูุชูุงูู ุจุฑุง ุณุงุฎุชู ุขูุฏู ุง ุจูุชุฑ ุงุฒ ุขููุง ุจุงููุฒู", 
    "ููุด ูุตููุน ุจู ุณุฑุนุช ุฏุฑ ุญุงู ุชุบุฑ ฺูุฑู ุฌูุงู ูุง ุงุณุช", "ฺฉ ุฏูุณุช ุฎูุจ ฺฏูุฌ ฺฏุฑุงูุจูุง ุฏุฑ ูุฑุงุฒ ู ูุดุจ ูุง ุฒูุฏฺฏ ุงุณุช", "ุณูุฑ ฺฉุฑุฏู ุจู ููุงุท ูุฎุชูู ุฌูุงู ุฏุฏฺฏุงู ุงูุณุงู ุฑุง ฺฏุณุชุฑุด ูุฏูุฏ", 
    "ูุฑุฒุด ููุธู ฺฉูุฏ ุงุตู ุจุฑุง ุฏุงุดุชู ุจุฏู ุณุงูู ู ุฑูุญ ุดุงุฏุงุจ ุงุณุช", "ููุณู ุฒุจุงู ูุดุชุฑฺฉ ุชูุงู ุงูุณุงู ูุง ุฏุฑ ุณุฑุงุณุฑ ฺฉุฑู ุฒูู ุงุณุช", 
    "ูฺฺฏุงู ุจุฑุง ุงุฏฺฏุฑ ู ุดุฑูุน ฺฉ ูุณุฑ ุฌุฏุฏ ุฏุฑ ูุณุช", "ุงุญุชุฑุงู ุจู ุนูุงุฏ ุฏฺฏุฑุงู ุญุช ุงฺฏุฑ ุจุง ุขููุง ูุฎุงูู ุจุงุดู ูุดุงูู ุจููุบ ุงุณุช", 
    "ุชุบุฑ ุชููุง ูพุฏุฏู ุซุงุจุช ุฏุฑ ุฌูุงู ูุณุช ุงุณุช ุจุงุฏ ุฎูุฏ ุฑุง ุจุง ุขู ููู ุฏูู", "ุตุจุฑ ู ุดฺฉุจุง ุฏุฑ ุจุฑุงุจุฑ ูุดฺฉูุงุช ุขููุง ุฑุง ุฏุฑ ููุงุช ุญู ุดุฏู ูฺฉูุฏ", 
    "ุฎูุงูุช ุนู ุฏุฏู ฺุฒ ฺฉู ุฏฺฏุฑุงู ููุจููุฏ ู ุงูุฌุงู ฺฉุงุฑ ฺฉู ุฏฺฏุฑุงู ุฌุฑุงุชุด ุฑุง ูุฏุงุฑูุฏ", "ุดุงุฏ ูุงูุน ุฏุฑ ุฏุงุดุชู ฺุฒูุง ุฒุงุฏ ูุณุช ุจูฺฉู ุฏุฑ ูุฐุช ุจุฑุฏู ุงุฒ ฺุฒูุง ุงุณุช ฺฉู ุฏุงุฑู", 
    "ุตุฏุงูุช ู ุฑุงุณุชฺฏู ุณูฺฏ ุจูุง ูุฑ ุฑุงุจุทู ูพุงุฏุงุฑ ู ูููู ุงุณุช", "ฺฉูฺฉุดุงู ุฑุงู ุดุฑ ุชููุง ฺฉ ุงุฒ ููุงุฑุฏูุง ฺฉูฺฉุดุงู ููุฌูุฏ ุฏุฑ ฺฉูุงู ุงุณุช", 
    "ุจุฑุง ุณุงุฎุชู ฺฉ ุฑุจุงุช ูพุดุฑูุชู ุจู ุฏุงูุด ุจุฑูุงูู ููุณ ู ุงูฺฉุชุฑููฺฉ ูุงุฒ ุงุณุช", "ุงููุช ุณุงุจุฑ ุฏุฑ ุฏูุง ุฏุฌุชุงู ุงูุฑูุฒ ุงุฒ ุงููุช ููู ุงูุนุงุฏู ุง ุจุฑุฎูุฑุฏุงุฑ ุงุณุช", 
    "ูุฑฺฏุฒ ูุฏุฑุช ฺฉ ุงุฏู ุฎูุจ ุฑุง ุฏุณุช ฺฉู ูฺฏุฑ ูุชูุงูุฏ ุฏูุง ุฑุง ุชุบุฑ ุฏูุฏ", "ฺฉุงุฑ ฺฏุฑูู ู ููฺฉุงุฑ ูุชูุงูุฏ ููุฌุฑ ุจู ูุชุงุฌ ุดฺฏูุช ุงูฺฏุฒ ุดูุฏ", 
    "ุดฺฉุณุช ุจุฎุด ุงุฒ ูุณุฑ ููููุช ุงุณุช ุงุฒ ุขู ุฏุฑุณ ุจฺฏุฑุฏ ู ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ", "ุฌูฺฏู ูุง ุขูุงุฒูู ุจู ุนููุงู ุฑู ูุง ฺฉุฑู ุฒูู ุดูุงุฎุชู ูุดููุฏ", 
    "ฺฉูู ุงูุฑุณุช ุจููุฏุชุฑู ููู ุฌูุงู ุฏุฑ ุฑุดุชู ฺฉูู ููุงูุง ูุฑุงุฑ ุฏุงุฑุฏ", "ุฏูุงุฑ ุจุฒุฑฺฏ ฺู ฺฉ ุงุฒ ุดฺฏูุช ูุง ุณุงุฎุช ุจุดุฑ ุฏุฑ ุทูู ุชุงุฑุฎ ุงุณุช", 
    "ุงูุฑุงู ุซูุงุซู ูุตุฑ ููุงุฏ ุชูุฏู ุจุงุณุชุงู ู ูุนูุงุฑ ุดฺฏูุช ุงูฺฏุฒ ุขู ุฏูุฑุงู ูุณุชูุฏ", "ุฎูุฑุดุฏ ฺฏุฑูุชฺฏ ุฒูุงู ุฑุฎ ูุฏูุฏ ฺฉู ูุงู ุจู ุฒูู ู ุฎูุฑุดุฏ ูุฑุงุฑ ุจฺฏุฑุฏ", 
    "ุขุจ ูุงู ุญุงุช ุงุณุช ู ุจุงุฏ ุฏุฑ ูุตุฑู ุขู ุตุฑูู ุฌู ฺฉูู", "ุฒูุจูุฑูุง ุนุณู ููุด ุจุณุงุฑ ููู ุฏุฑ ฺฏุฑุฏู ุงูุดุงู ู ุญุงุช ฺฏุงูุงู ุฏุงุฑูุฏ", 
    "ุจุงุฒุงูุช ุฒุจุงูู ุจู ุญูุธ ููุงุจุน ุทุจุน ู ฺฉุงูุด ุขููุฏฺฏ ฺฉูฺฉ ูฺฉูุฏ", "ฺฉูฺฉุดุงู ุขูุฏุฑููุฏุง ูุฒุฏฺฉุชุฑู ฺฉูฺฉุดุงู ูุงุฑูพฺ ุจู ฺฉูฺฉุดุงู ูุง ุงุณุช", 
    "ุณุฑุนุช ููุฑ ุจุงูุงุชุฑู ุณุฑุนุช ููฺฉู ุฏุฑ ุฌูุงู ูุณุช ูุญุณูุจ ูุดูุฏ", "ูุฑ ุงูุณุงู ุฏุงุฑุง ุงุซุฑ ุงูฺฏุดุช ููุญุตุฑ ุจู ูุฑุฏ ุงุณุช ฺฉู ุงู ุฑุง ุงุฒ ุฏฺฏุฑุงู ูุชูุงุฒ ูฺฉูุฏ", 
    "ูุฒูพููฺฏ ุณุฑุนุชุฑู ุญูุงู ุฑู ุฎุดฺฉ ุงุณุช ู ูุชูุงูุฏ ุจู ุณุฑุนุช ุจุงูุง ุจุฑุณุฏ", "ููุจ ฺฉ ุงูุณุงู ุจุงูุบ ุจู ุทูุฑ ูุชูุณุท ุตุฏ ูุฒุงุฑ ุจุงุฑ ุฏุฑ ุฑูุฒ ูุชูพุฏ", 
    "ุฎูุงุจ ฺฉุงู ุจุฑุง ุณูุงูุช ุฌุณู ู ุฑูุงู ู ุนููฺฉุฑุฏ ุจูุชุฑ ูุบุฒ ุถุฑูุฑ ุงุณุช", "ูุชุงูู ุฏ ุจุง ูุฑุงุฑ ฺฏุฑูุชู ุฏุฑ ูุนุฑุถ ููุฑ ุฎูุฑุดุฏ ุฏุฑ ุจุฏู ุชููุฏ ูุดูุฏ", 
    "ุฎูุฏู ุจูุชุฑู ุฏุงุฑู ุจุฑุง ฺฉุงูุด ุงุณุชุฑุณ ู ุชููุช ุณุณุชู ุงูู ุจุฏู ุงุณุช", "ุงุฏฺฏุฑ ููุณู ูุชูุงูุฏ ุจู ุจูุจูุฏ ุญุงูุธู ู ููุงููฺฏ ุงุนุถุง ุจุฏู ฺฉูฺฉ ฺฉูุฏ", 
    "ุงุฑุชุจุงุทุงุช ูุงููุงุฑู ุง ุงูฺฉุงู ุจุฑูุฑุงุฑ ุชูุงุณ ุฏุฑ ุณุฑุงุณุฑ ุฌูุงู ุฑุง ูุฑุงูู ฺฉุฑุฏู ุงุณุช", "ูุจุฑ ููุฑ ุจุง ุงุณุชูุงุฏู ุงุฒ ูพุงูุณ ูุง ููุฑ ุฏุงุฏู ูุง ุฑุง ุจุง ุณุฑุนุช ุจุงูุง ููุชูู ูฺฉูุฏ", 
    "ูุงูุนุช ูุฌุงุฒ ุชุฌุฑุจู ุง ูุฑุงฺฏุฑ ุงุฒ ฺฉ ุฏูุง ุดุจู ุณุงุฒ ุดุฏู ุฑุง ุงุฑุงุฆู ูุฏูุฏ", "ฺุงูพฺฏุฑูุง ุณู ุจุนุฏ ูุงุฏุฑ ุจู ุณุงุฎุช ุงุดุงุก ูุฒฺฉ ุงุฒ ุฑู ูุฏู ูุง ุฏุฌุชุงู ูุณุชูุฏ", 
    "ุฎูุฏุฑููุง ุงูฺฉุชุฑฺฉ ุจุง ูุฏู ฺฉุงูุด ุขููุฏฺฏ ููุง ุฏุฑ ุญุงู ฺฏุณุชุฑุด ูุณุชูุฏ", "ุงูุฑฺ ูุณุชู ุง ุงุฒ ุดฺฉุงูุช ุงุชู ูุง ุจุฑุง ุชููุฏ ุจุฑู ุงุณุชูุงุฏู ูฺฉูุฏ", "ูุทุฑู ูุทุฑู ุฌูุน ฺฏุฑุฏุฏ ูุงูฺฏู ุฏุฑุง ุดูุฏ", 
    "ุขูุฏู ุณุงุฎุชู ุงุณุช ูู ุงูุชู ูพุณ ุจุงุฏ ุจุฑุง ุขู ุชูุงุด ฺฉุฑุฏ", "ุจูุชุฑู ุฒูุงู ุจุฑุง ฺฉุงุดุชู ฺฉ ุฏุฑุฎุช ุจุณุช ุณุงู ูพุด ุจูุฏ ุฒูุงู ุจุนุฏ ููู ุงูุฑูุฒ ุงุณุช", 
    "ุจุฑุง ุฏุฏู ุฑูฺฏู ฺฉูุงู ุจุงุฏ ูู ุจุงุฑุงู ุฑุง ุชุญูู ฺฉู ูู ุขูุชุงุจ ุฑุง", "ููููุช ูุฌููุนู ุง ุงุฒ ุชูุงุด ูุง ฺฉูฺฺฉ ุงุณุช ฺฉู ูุฑ ุฑูุฒ ุชฺฉุฑุงุฑ ูุดููุฏ", 
    "ุชููุง ูุญุฏูุฏุช ูุง ุฒูุฏฺฏ ุขููุง ูุณุชูุฏ ฺฉู ุฎูุฏูุงู ุจุฑุง ุฎูุฏูุงู ุงุฌุงุฏ ูฺฉูู", "ุจู ุฌุง ูฺฏุฑุงู ุฏุฑ ููุฑุฏ ฺุฒูุง ฺฉู ููุชูุงู ฺฉูุชุฑู ฺฉู ุฑู ฺุฒูุง ฺฉู ูุชูุงู ุชุบุฑ ุฏู ุชูุฑฺฉุฒ ฺฉู", 
    "ุดุฌุงุนุช ูุจูุฏู ุชุฑุณ ูุณุช ุจูฺฉู ุนูู ฺฉุฑุฏู ุจุง ูุฌูุฏ ุชุฑุณ ุงุณุช", "ฺฉ ุณูุฑ ูุฒุงุฑ ฺฉูููุชุฑ ุจุง ุงููู ูุฏู ุขุบุงุฒ ูุดูุฏ", "ุฒูุฏฺฏ ูุซู ุฏูฺุฑุฎู ุณูุงุฑ ุงุณุช ุจุฑุง ุญูุธ ุชุนุงุฏู ุจุงุฏ ุจู ุญุฑฺฉุช ุงุฏุงูู ุฏู", 
    "ุงูุณุงู ูุง ูููู ููุดู ุจู ุฏูุจุงู ูุฑุตุช ูุง ุจุฑุง ฺฉูฺฉ ุจู ุฏฺฏุฑุงู ูุณุชูุฏ", "ูุฏู ฺฏุฐุงุฑ ุงููู ูุฏู ุจุฑุง ุชุจุฏู ูุงุฏุฏู ูุง ุจู ุฏุฏู ูุง ุงุณุช", 
    "ุฑุงุฒ ูพุดุฑูุช ุดุฑูุน ฺฉุฑุฏู ุงุณุช ูพุณ ููุชุธุฑ ุฒูุงู ููุงุณุจ ููุงู", "ุงฺฏุฑ ูุฎูุงู ูุชูุงูุช ุจุงุด ุจุงุฏ ฺฉุงุฑูุง ูุชูุงูุช ุงูุฌุงู ุฏู", "ุงุดุชุจุงู ฺฉุฑุฏู ุจุฎุด ุงุฒ ุงูุณุงู ุจูุฏู ุงุณุช ููู ุฏุฑุณ ฺฏุฑูุชู ุงุฒ ุขููุง ุงุณุช", 
    "ุงุฌุงุฒู ูุฏู ุณุฑ ู ุตุฏุง ุนูุงุฏ ุฏฺฏุฑุงู ุตุฏุง ุฏุฑูู ุชู ุฑุง ุฎุงููุด ฺฉูุฏ", "ุฎูุดุจุฎุช ฺฉ ูุณุฑ ุงุณุช ูู ฺฉ ููุตุฏ ุงุฒ ูุญุธุงุช ุฎูุฏ ูุฐุช ุจุจุฑ", 
    "ุชููุง ุฑุงู ุงูุฌุงู ุฏุงุฏู ฺฉุงุฑูุง ุจุฒุฑฺฏ ุฏูุณุช ุฏุงุดุชู ฺฉุงุฑ ุงุณุช ฺฉู ุงูุฌุงู ูุฏู", "ูุฑุตุช ูุง ูุงููุฏ ุทููุน ุฎูุฑุดุฏ ูุณุชูุฏ ุงฺฏุฑ ุฒุงุฏ ุตุจุฑ ฺฉู ุขููุง ุฑุง ุงุฒ ุฏุณุช ูุฏู", 
    "ุงุณุชุนุฏุงุฏ ุฐุงุช ููุท ฺฉ ุดุฑูุน ุงุณุช ุจุงุฏ ุจุง ุชูุงุด ุขู ุฑุง ูพุฑูุฑุด ุฏู", "ุจุง ุงูฺฉุงุฑ ูุซุจุช ุฏูุง ุฎูุฏ ุฑุง ุฒุจุงุชุฑ ฺฉู ฺูู ุฒูุฏฺฏ ุงูุนฺฉุงุณ ุงูฺฉุงุฑ ุชู ุงุณุช", 
    "ุจุฑุง ุฑุณุฏู ุจู ููู ุจุงุฏ ุณุฎุช ูุง ูุณุฑ ุฑุง ุชุญูู ฺฉุฑุฏ", "ุณฺฉูุช ฺฏุงู ุจูุชุฑู ูพุงุณุฎ ุจู ุณูุงูุงุช ุจ ูุนู ุงุณุช", "ุจุฑุง ุฏุงุดุชู ุฏูุณุช ููุงุฏุงุฑ ุจุงุฏ ุฎูุฏุช ฺฉ ุฏูุณุช ููุงุฏุงุฑ ุจุงุด", 
    "ุงูุฏ ูุงููุฏ ฺุฑุงุบ ุฏุฑ ุชุงุฑฺฉ ูุณุฑ ุฑุง ุจุฑุงุช ุฑูุดู ูฺฉูุฏ", "ฺฉุชุงุจ ูุง ุจูุชุฑู ุฏูุณุชุงู ุฎุงููุด ูุง ูุณุชูุฏ ฺฉู ูุฑฺฏุฒ ูุง ุฑุง ุชุฑฺฉ ููฺฉููุฏ", 
    "ุฏุงูุด ูุฏุฑุช ุงุณุช ฺฉู ูฺฺฉุณ ููุชูุงูุฏ ุขู ุฑุง ุงุฒ ุชู ุจฺฏุฑุฏ", "ฺฏุฐุดุชู ุฑุง ููุชูุงู ุชุบุฑ ุฏุงุฏ ุงูุง ุขูุฏู ูููุฒ ุฏุฑ ุฏุณุชุงู ุชู ุงุณุช", 
    "ุชูุงูุช ุจู ฺฉ ูุฑุฏ ูููู ู ุฏฺฏุฑุงู ฺฉูุจูุฏ ูุฏุฑุช ูุณุช ุจูฺฉู ฺฉูุจูุฏ ุงุฑุงุฏู ุงุณุช", "ุงูุณุงู ูุง ุจุฒุฑฺฏ ุฏุฑุจุงุฑู ุงุฏู ูุง ุตุญุจุช ูฺฉููุฏ ุงูุณุงู ูุง ูุชูุณุท ุฏุฑุจุงุฑู ุฑูุฏุงุฏูุง ู ุงูุณุงู ูุง ฺฉูฺฺฉ ุฏุฑุจุงุฑู ุฏฺฏุฑุงู", 
    "ุจุฑุง ูพุฑูุงุฒ ฺฉุฑุฏู ูุงุฒู ูุณุช ุญุชูุง ุจุงู ุฏุงุดุชู ุจุงุด ุฏุงุดุชู ุงุฑุงุฏู ู ุฑูุง ฺฉุงู ุงุณุช", "ุณุงุฏู ุชุฑู ฺฉุงุฑูุง ุงุบูุจ ุฏุฑุณุช ุชุฑู ุขููุง ูุณุชูุฏ", 
    "ุชูุฑู ุฒุงุฏ ุจุงุนุซ ูุดูุฏ ฺฉุงุฑูุง ุณุฎุช ุขุณุงู ุจู ูุธุฑ ุจุฑุณูุฏ", "ฺฉ ุฐูู ุขุฑุงู ูุชูุงูุฏ ูู ุชุฑู ุทููุงู ูุง ุฑุง ูพุดุช ุณุฑ ุจฺฏุฐุงุฑุฏ", 
    "ูุฑฺฏุฒ ุงุฌุงุฒู ูุฏู ุฏุฑูุฒ ุจุฎุด ุฒุงุฏ ุงุฒ ุงูุฑูุฒ ุชู ุฑุง ุจู ุฎูุฏ ุงุฎุชุตุงุต ุฏูุฏ", "ุงฺฏุฑ ุจู ุฏูุจุงู ูุชุงุฌ ูุชูุงูุช ูุณุช ุจุงุฏ ุฑูุด ูุง ูุชูุงูุช ุฑุง ุงูุชุญุงู ฺฉู", 
    "ุตุจุฑ ฺฉูุฏ ููููุช ุฏุฑ ุชูุงู ูุฑุงุญู ุฒูุฏฺฏ ุงุณุช", "ุณุน ูฺฉู ุงูุณุงู ูููู ุจุงุด ุจูฺฉู ุณุน ฺฉู ุงูุณุงู ุจุง ุงุฑุฒุด ุจุงุด", "ุฑุงุฒ ุดุงุฏ ุฒุณุชู ุฏุฑ ูุฐุช ุจุฑุฏู ุงุฒ ฺุฒูุง ฺฉูฺฺฉ ุงุณุช", 
    "ููุดู ุจู ุงุฏ ุฏุงุดุชู ุจุงุด ฺฉู ูุณุฑ ููููุช ุฏุฑ ุญุงู ุณุงุฎุช ุงุณุช ูู ฺฉ ุฌุงุฏู ุขูุงุฏู", "ฺฉ ูุจุฎูุฏ ูุชูุงูุฏ ุดุฑูุน ฺฉ ุฏูุณุช ุฒุจุง ุจุงุดุฏ", 
    "ุงฺฏุฑ ูุฎูุงู ุฏูุง ุฑุง ุชุบุฑ ุฏู ุงุฒ ูุฑุชุจ ฺฉุฑุฏู ุชุฎุช ุฎูุฏุช ุดุฑูุน ฺฉู", "ุจุฎุดุฏู ุฏฺฏุฑุงู ุจู ูุนูุง ูุฑุงููุด ฺฉุฑุฏู ฺฏุฐุดุชู ูุณุช ุจูฺฉู ุจู ูุนูุง ุณุงุฎุชู ุขูุฏู ุง ุจูุชุฑ ุงุณุช", 
    "ููุฑุจุงู ุฒุจุงู ุงุณุช ฺฉู ูุงุดููุงุงู ูุชูุงููุฏ ุจุดูููุฏ ู ูุงุจูุงุงู ูุชูุงููุฏ ุจุจููุฏ", "ูุฑ ุฑูุฒ ฺฉ ูุฑุตุช ุฌุฏุฏ ุจุฑุง ุดุฑูุน ุฏูุจุงุฑู ู ุจูุชุฑ ุดุฏู ุงุณุช", 
    "ุณุน ูฺฉู ุฏุฑ ุจุฑุงุจุฑ ุทููุงู ููุงููุช ฺฉู ุงุฏ ุจฺฏุฑ ุฏุฑ ุจุงุฑุงู ุจุฑูุต", "ุฒูุฏฺฏ ฺฉ ุจูู ููุงุด ุงุณุช ุณุน ฺฉู ุขู ุฑุง ุจุง ุฑูฺฏ ูุง ุดุงุฏ ุฑูฺฏ ุขูุฒ ฺฉู", 
    "ุงฺฏุฑ ุจุชูุงู ฺุฒ ุฑุง ุฑูุงูพุฑุฏุงุฒ ฺฉู ูพุณ ุญุชูุง ูุชูุงู ุขู ุฑุง ุงูุฌุงู ุฏู", "ููู ูุณุช ฺูุฏุฑ ุขูุณุชู ุญุฑฺฉุช ูฺฉู ุชุง ุฒูุงู ฺฉู ูุชููู ูุดู ูพุดุฑูุช ุฎูุงู ฺฉุฑุฏ", 
    "ฺฉ ุดูุน ูุชูุงูุฏ ูุฒุงุฑุงู ุดูุน ุฏฺฏุฑ ุฑุง ุฑูุดู ฺฉูุฏ ุจุฏูู ุขูฺฉู ุงุฒ ุนูุฑุด ฺฉุงุณุชู ุดูุฏ", "ุดุงุฏ ุฒูุงู ุฏูฺูุฏุงู ูุดูุฏ ฺฉู ุขู ุฑุง ุจุง ุฏฺฏุฑุงู ุชูุณู ฺฉู", 
    "ุจูุชุฑู ุฑุงู ุจุฑุง ูพุด ุจู ุขูุฏู ุณุงุฎุชู ุขู ุงุณุช", "ูุฑฺฏุฒ ุจุฑุง ุชุจุฏู ุดุฏู ุจู ุขู ฺฉุณ ฺฉู ูุชูุงูุณุช ุจุงุด ุฏุฑ ูุณุช", 
    "ุฐูู ุงูุณุงู ูุงููุฏ ฺฉ ุจุงุบ ุงุณุช ูุฑฺู ุฏุฑ ุขู ุจฺฉุงุฑ ููุงู ุฑุง ุฏุฑู ูฺฉู", "ฺฉ ฺฏูุชฺฏู ุตุงุฏูุงูู ูุชูุงูุฏ ุจุณุงุฑ ุงุฒ ูุดฺฉูุงุช ุฑุง ุญู ฺฉูุฏ", 
    "ุณุฎุงูุช ุนู ุจุฎุดุฏู ุจุด ุงุฒ ุชูุงูุง ุงุช ู ุบุฑูุฑ ุนู ฺฏุฑูุชู ฺฉูุชุฑ ุงุฒ ูุงุฒุช", "ฺฉุณุงู ฺฉู ุจู ุงูุฏุงุฒู ฺฉุงู ุฏูุงูู ูุณุชูุฏ ฺฉู ูฺฉุฑ ฺฉููุฏ ูุชูุงููุฏ ุฏูุง ุฑุง ุชุบุฑ ุฏููุฏ ููุงู ูุง ูุณุชูุฏ ฺฉู ุงู ฺฉุงุฑ ุฑุง ูฺฉููุฏ", 
    "ุงูุชูุงู ฺฏุฑูุชู ุชู ุฑุง ุจุง ุฏุดููุช ุจุฑุงุจุฑ ูฺฉูุฏ ุงูุง ุจุฎุดุฏู ุงู ุชู ุฑุง ุจุฑุชุฑ ุงุฒ ุงู ูุฑุงุฑ ูุฏูุฏ", "ฺฉุณ ฺฉู ุณูุงู ููพุฑุณุฏ ุจุฑุง ฺฉ ุฏููู ูุงุฏุงู ุงุณุช ุงูุง ฺฉุณ ฺฉู ุณูุงู ูููพุฑุณุฏ ุจุฑุง ููุดู ูุงุฏุงู ุจุงู ููุงูุฏ", 
    "ุฒูุฏฺฏ ฺฉูุชุงูุชุฑ ุงุฒ ุขู ุงุณุช ฺฉู ููุช ุฎูุฏ ุฑุง ุตุฑู ูุชููุฑ ุจูุฏู ุงุฒ ุฏฺฏุฑุงู ฺฉู", "ุจุฑุง ุณุงุฎุชู ฺฉ ุฎุงูู ูุญฺฉู ุจุงุฏ ูพุงู ูุง ุขู ุฑุง ูู ุจูุง ฺฉู", 
    "ฺฉ ฺฉุชุงุจ ุฎูุจ ูุชูุงูุฏ ุฏุฏฺฏุงู ุชู ุฑุง ูุณุจุช ุจู ฺฉู ุฏูุง ุชุบุฑ ุฏูุฏ", "ูุฏุฑุช ูุงูุน ุฏุฑ ฺฉูุชุฑู ฺฉุฑุฏู ุฏฺฏุฑุงู ูุณุช ุจูฺฉู ุฏุฑ ฺฉูุชุฑู ฺฉุฑุฏู ุฎูุฏ ุงุณุช", 
    "ูุฑฺฏุฒ ุงุฑุฒุด ฺฉ ูุญุธู ุฑุง ููููู ุชุง ุฒูุงู ฺฉู ุจู ฺฉ ุฎุงุทุฑู ุชุจุฏู ุดูุฏ", "ุจุฑุง ุดูุง ฺฉุฑุฏู ุฏุฑ ุฌูุช ูุฎุงูู ุฑูุฏุฎุงูู ุจุงุฏ ููุชุฑ ุงุฒ ุฌุฑุงู ุขุจ ุจุงุด", 
    "ฺฉ ููุฑูุงู ูุงูุน ฺฉุณ ุงุณุช ฺฉู ุจุง ูุฌูุฏ ุชูุงู ุณุฎุช ูุง ุฏูุจุงุฑู ุจุฑูุฎุฒุฏ", "ุขุฑุงูุด ุฑุง ุฏุฑ ุฏุฑูู ุฎูุฏุช ูพุฏุง ฺฉู ูู ุฏุฑ ุฏูุง ุจุฑูู", 
    "ุงููู ูุฏู ุจุฑุง ุฑุณุฏู ุจู ูุฑ ุฌุง ุชุตูู ฺฏุฑูุชู ุจุฑุง ุญุฑฺฉุช ุงุณุช", "ุงฺฏุฑ ุจู ุฒุจุง ุงุนุชูุงุฏ ุฏุงุดุชู ุจุงุด ุขู ุฑุง ุฏุฑ ููู ุฌุง ุฎูุงู ุฏุฏ", 
    "ูฺ ฺุฒ ุงุฑุฒุดููุฏ ุจู ุขุณุงู ุจู ุฏุณุช ูู ุขุฏ", "ฺฉ ุฏุฑูุบ ููฺฉู ุงุณุช ุจุฑุง ูุฏุช ุชู ุฑุง ูุฌุงุช ุฏูุฏ ุงูุง ุฏุฑ ููุงุช ุญููุช ุขุดฺฉุงุฑ ูุดูุฏ", 
    "ุจุฑุง ุดูุฏู ุตุฏุง ูุฑุตุช ูุง ุจุงุฏ ฺฏูุด ูุงุช ุฑุง ุชุฒ ฺฉู", "ฺฉ ุฑูุจุฑ ูุงูุน ุฑุงู ุฑุง ุจูุฏ ุงุณุช ุฑุงู ุฑุง ูุฑูุฏ ู ุฑุงู ุฑุง ูุดุงู ูุฏูุฏ", 
    "ูุฑฺฏุฒ ุงุฌุงุฒู ูุฏู ููููุช ูุงุช ุชู ุฑุง ูุบุฑูุฑ ู ุดฺฉุณุช ูุงุช ุชู ุฑุง ูุงุงูุฏ ฺฉูุฏ", "ุฒุจุง ูุงูุน ุฏุฑ ุณุงุฏฺฏ ูููุชู ุงุณุช", 
    "ฺฉ ุฏูุณุช ุฎูุจ ุฏุฑ ุฑูุฒูุง ุณุฎุช ูุงููุฏ ุขูู ู ุฏุฑ ุฑูุฒูุง ุฎูุจ ูุงููุฏ ุณุงู ุงุณุช", "ุจุฑุง ุฑุณุฏู ุจู ููุฑ ุจุงุฏ ุงุฒ ุชุงุฑฺฉ ุนุจูุฑ ฺฉุฑุฏ", 
    "ุฏุงูุด ุจุฏูู ุนูู ูุงููุฏ ุงุจุฑ ุจ ุจุงุฑุงู ุงุณุช", "ุฒูุฏฺฏ ฺฉ ุจุงุฒ ุงุณุช ุณุน ฺฉู ุงุฒ ุขู ูุฐุช ุจุจุฑ ู ุฌูุงููุฑุฏุงูู ุจุงุฒ ฺฉู", 
    "ุงุนุชูุงุฏ ูุงููุฏ ฺฉ ฺฉุงุบุฐ ุงุณุช ุงฺฏุฑ ูฺุงูู ุดูุฏ ุฏฺฏุฑ ูุฑฺฏุฒ ุตุงู ูุฎูุงูุฏ ุดุฏ", "ฺฉ ููุจ ููุฑุจุงู ุงุฒ ุชูุงู ูุนุงุจุฏ ู ูุณุงุฌุฏ ุฏูุง ููุฏุณ ุชุฑ ุงุณุช", 
    "ุขูุฏู ูุชุนูู ุจู ฺฉุณุงู ุงุณุช ฺฉู ุจู ุฒุจุง ุฑูุงูุงุดุงู ุงูุงู ุฏุงุฑูุฏ", "ุฌุงุฏู ุงุจุฑุดู ฺฉ ูุณุฑ ุชุฌุงุฑ ุจุงุณุชุงู ุจุฑุง ุงุชุตุงู ุดุฑู ู ุบุฑุจ ุจูุฏ", 
    "ฺฉูู ุฏูุงููุฏ ุจููุฏุชุฑู ููู ุขุชุดูุดุงู ุฏุฑ ุฎุงูุฑูุงูู ุงุณุช", "ุขุฑุด ฺฉูุงูฺฏุฑ ูุฑุฒ ุงุฑุงู ู ุชูุฑุงู ุฑุง ุจุง ูพุฑุชุงุจ ฺฉ ุชุฑ ูุดุฎุต ฺฉุฑุฏ", 
    "ุฎูุฌ ูุงุฑุณ ฺฉ ุงุฒ ูููุชุฑู ุขุจุฑุงู ูุง ุงุณุชุฑุงุชฺฺฉ ุฌูุงู ุจู ุดูุงุฑ ูุฑูุฏ", "ุฑุงุฒ ุชุบุฑ ฺฉุฑุฏู ุฏุฑ ุงู ุงุณุช ฺฉู ุชูุงู ุงูุฑฺ ุฎูุฏ ุฑุง ุฑู ุณุงุฎุชู ุนุงุฏุช ูุง ุฌุฏุฏ ุจฺฏุฐุงุฑ"
]

# --- ุฏฺฉุดูุฑ ุชูุถุญุงุช ุจุงุฒโูุง ุจุฑุง ูพูู ุฑุงูููุง ---
GAME_DESCRIPTIONS = {
    "hokm": "ุจุงุฒ ฺฉุงุฑุช ูุญุจูุจ ู ุงุณุชุฑุงุชฺฺฉ ุญฺฉู ฺฉู ุจู ุตูุฑุช ฒ ุง ด ููุฑู ูุงุจู ุงุฌุฑุงุณุช. ุชูุงุด ฺฉูุฏ ุจุง ุจุฑูุฏู ุดุฏู ุฏุฑ ุฏุณุชโูุงุ ุจู ุงูุชุงุฒ ท ุจุฑุณุฏ.",
    "dooz": "ุจุงุฒ ฺฉูุงุณฺฉ ุฏูุฒ (XO) ุจู ุตูุฑุช ุฏู ููุฑู. ุงููู ฺฉุณ ฺฉู ุณู ููุฑู ุฎูุฏ ุฑุง ุฏุฑ ฺฉ ุฑุฏู ุงููุ ุนููุฏ ุง ููุฑุจ ูุฑุงุฑ ุฏูุฏุ ุจุฑูุฏู ุงุณุช.",
    "doz4p": "ูุณุฎู ูุฌุงูโุงูฺฏุฒุชุฑ ุจุงุฒ ุฏูุฒ ุจู ุตูุฑุช ฺูุงุฑ ููุฑู. ุจุฑุง ุจุฑูุฏู ุดุฏู ุจุงุฏ ด ููุฑู ุฑุง ุฏุฑ ฺฉ ุฑุฏู ูุฑุงุฑ ุฏูุฏ.",
    "connect4": "ุจุงุฒ ุงุณุชุฑุงุชฺฺฉ 'ฺูุงุฑ ุฏุฑ ฺฉ ุฑุฏู'. ุจุงุฒฺฉูุงู ุจู ููุจุช ููุฑูโูุง ุฎูุฏ ุฑุง ุงุฒ ุจุงูุง ุจู ุฏุงุฎู ุณุชููโูุง ูโุงูุฏุงุฒูุฏ ู ุงููู ฺฉุณ ฺฉู ฺฉ ุฑุฏู ฺูุงุฑุชุง ุจุณุงุฒุฏุ ุจุฑูุฏู ุงุณุช.",
    "rps": "ุจุงุฒ ฺฉูุงุณฺฉ ุณูฺฏุ ฺฉุงุบุฐุ ูฺ. ุงูุชุฎุงุจ ุฎูุฏ ุฑุง ูุฎูุงูู ุงูุฌุงู ุฏูุฏ ู ุจุจูุฏ ฺู ฺฉุณ ุจุฑูุฏู ูโุดูุฏ!",
    "memory": "ุญุงูุธู ุฎูุฏ ุฑุง ุจู ฺุงูุด ุจฺฉุดุฏ! ฺฉุงุฑุชโูุง ุฑุง ุฏู ุจู ุฏู ุจุฑฺฏุฑุฏุงูุฏ ู ุณุน ฺฉูุฏ ุฌูุชโูุง ฺฉุณุงู ุฑุง ูพุฏุง ฺฉูุฏ. ุจุงุฒฺฉู ฺฉู ุจุดุชุฑู ุฌูุช ุฑุง ูพุฏุง ฺฉูุฏุ ุจุฑูุฏู ุงุณุช.",
    "hads_kalame": "ฺฉ ฺฉููู ูุฎู ูโุดูุฏ ู ุดูุง ุจุงุฏ ุจุง ุญุฏุณ ุญุฑููุ ุขู ุฑุง ูพุฏุง ฺฉูุฏ. ูุฑ ฺฉุงุฑุจุฑ ุชุนุฏุงุฏ ุฌุงู ูุดุฎุต ุฏุงุฑุฏ!",
    "type_speed": "ฺฉ ุฌููู ููุงุด ุฏุงุฏู ูโุดูุฏ ู ุงููู ฺฉุณ ฺฉู ุขู ุฑุง ุณุฑุน ู ุฏุฑุณุช ุชุงูพ ฺฉูุฏุ ุจุฑูุฏู ูุณุงุจูู ุณุฑุนุช ุฎูุงูุฏ ุจูุฏ.",
    "hads_addad": "(ูฺู ุงุฏูู) ุงุฏูู ฺฉ ุจุงุฒู ุนุฏุฏ ูุดุฎุต ูโฺฉูุฏ ู ุฑุจุงุช ุนุฏุฏ ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ. ุจูู ุจุงุฏ ุณุน ฺฉููุฏ ุจุง ุฑุงูููุงโูุง 'ุจุงูุงุชุฑ' ู 'ูพุงูโุชุฑ'ุ ุนุฏุฏ ุฑุง ูพุฏุง ฺฉููุฏ.",
    "2048": "ฺฉ ุจุงุฒ ุชฺฉโููุฑู ูฺฉุฑ. ุจุง ุญุฑฺฉุช ุฏุงุฏู ุฎุงููโูุงุ ุงุนุฏุงุฏ ฺฉุณุงู ุฑุง ุจุง ูู ุชุฑฺฉุจ ฺฉูุฏ ุชุง ุจู ุนุฏุฏ 2048 ุจุฑุณุฏ.",
    "spuzzle": "ุจุงุฒ ูพุงุฒู ฺฉุดู (Sliding Puzzle). ุงุนุฏุงุฏ ุจู ูู ุฑุฎุชู ุฑุง ูุฑุชุจ ฺฉูุฏ ุชุง ุจู ุชุฑุชุจ ุตุญุญ ุงุฒ ฑ ุชุง ฑต ุจุฑุณูุฏ.",
    "samegame": "ุจุงุฒ ูฺฉุฑ ุฌูุชโูุง. ุฑู ฺฏุฑููโูุง ุงุฒ ุจููฺฉโูุง ููุฑูฺฏ (ุญุฏุงูู ฒ ุชุง) ฺฉูฺฉ ฺฉูุฏ ุชุง ุญุฐู ุดููุฏ ู ุงูุชุงุฒ ุจฺฏุฑุฏ.",
    "eteraf": "(ูฺู ุงุฏูู) ุงุฏูู ฺฉ ููุถูุน ุจุฑุง ุงุนุชุฑุงู ุงุฌุงุฏ ูโฺฉูุฏ ู ุงุนุถุง ฺฏุฑูู ุจู ุตูุฑุช ฺฉุงููุงู ูุงุดูุงุณ ุจู ุขู ูพุงุณุฎ ูโุฏููุฏ.",
    "gharch": "(ูฺู ุงุฏูู) ุฏุฑ ุงู ุจุงุฒ ูุงุดูุงุณุ ุงุฏูู ฺฉ 'ฺฏุงุฏ' ุชุนู ูโฺฉูุฏ. ูพุงูโูุง ูุงุดูุงุณ ุงุนุถุง ููุท ุจุฑุง 'ฺฏุงุฏ' ูุงุด ูโุดูุฏ.",
    "gardone": "(ูฺู ุงุฏูู) ฺฉ ฺฏุฑุฏููู ุดุงูุณ ุง ูุฑุนูโฺฉุด ุจู ุงุนุถุง ฺฏุฑูู ุงุฌุงุฏ ฺฉูุฏ. ุงุนุถุง ูพุณ ุงุฒ ุนุถูุช ุฏุฑ ฺฉุงูุงู ูโุชูุงููุฏ ุจู ฺฏุฑุฏููู ุจูพููุฏูุฏ."
}

SAMEGAME_WIDTH, SAMEGAME_HEIGHT = 10, 10
SAMEGAME_COLORS = ["๐ฅ", "๐ฉ", "๐ฆ", "๐จ", "๐ช"]
EMPTY_CELL = "โฌ๏ธ" # ุง ูุฑ ุงููุฌ ุฏฺฏุฑ ฺฉู ุจุฑุง ุฎุงูู ุฎุงู ูโูพุณูุฏุฏ

# --- ุชูุธูุงุช ูุงฺฏ ---
logging.basicConfig(format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", level=logging.INFO)
logger = logging.getLogger(__name__)

# --- ูุฏุฑุช ุฏุชุงุจุณ (ุจุฏูู ุชุบุฑ) ---
DATABASE_URL = os.environ.get("DATABASE_URL")
def get_db_connection():
    try: return psycopg2.connect(DATABASE_URL)
    except Exception as e:
        logger.error(f"Database connection failed: {e}")
        return None

def setup_database():
    conn = get_db_connection()
    if conn:
        try:
            with conn.cursor() as cur:
                cur.execute("CREATE TABLE IF NOT EXISTS users (user_id BIGINT PRIMARY KEY, first_name VARCHAR(255), username VARCHAR(255), start_time TIMESTAMP WITH TIME ZONE DEFAULT NOW());")
                cur.execute("CREATE TABLE IF NOT EXISTS groups (group_id BIGINT PRIMARY KEY, title VARCHAR(255), member_count INT, added_time TIMESTAMP WITH TIME ZONE DEFAULT NOW());")
                cur.execute("CREATE TABLE IF NOT EXISTS start_message (id INT PRIMARY KEY, message_id BIGINT, chat_id BIGINT);")
                cur.execute("CREATE TABLE IF NOT EXISTS banned_users (user_id BIGINT PRIMARY KEY);")
                cur.execute("CREATE TABLE IF NOT EXISTS banned_groups (group_id BIGINT PRIMARY KEY);")
            conn.commit()
            logger.info("Database setup complete.")
        except Exception as e: logger.error(f"Database setup failed: {e}")
        finally: conn.close()

# --- ุชูุงุจุน ฺฉูฺฉ ---
async def is_owner(user_id: int) -> bool: return user_id in OWNER_IDS
async def is_group_admin(user_id: int, chat_id: int, context: ContextTypes.DEFAULT_TYPE) -> bool:
    if await is_owner(user_id): return True
    admins = await context.bot.get_chat_administrators(chat_id)
    return user_id in {admin.user.id for admin in admins}
def convert_persian_to_english_numbers(text: str) -> str:
    if not text: return ""
    return text.translate(str.maketrans("ฐฑฒณดตถทธน", "0123456789"))

# --- ูุฏุฑุช ูุถุนุช ุจุงุฒโูุง ---
active_games = {'guess_number': {}, 'dooz': {}, 'hangman': {}, 'typing': {}, 'hokm': {}, 'connect4': {}, 'rps': {}, 'memory': {}, '2048': {}, 'samegame': {}, 'spuzzle': {}, 'doz4p': {}, 'gardone': {}}
active_gharch_games = {}

# --- ##### ุชุบุฑ ฺฉูุฏ: ููุทู ุฌุฏุฏ ุนุถูุช ุงุฌุจุงุฑ ู ุจู ##### ---
async def check_ban_status(update: Update, context: ContextTypes.DEFAULT_TYPE) -> bool:
    """ฺฺฉ ูโฺฉูุฏ ฺฉู ุขุง ฺฉุงุฑุจุฑ ุง ฺฏุฑูู ุจู ุดุฏู ุงุณุช ุง ุฎุฑ. ุงฺฏุฑ ฺฏุฑูู ุจู ุจุงุดุฏุ ุฑุจุงุช ุฎุงุฑุฌ ูโุดูุฏ."""
    user = update.effective_user
    chat = update.effective_chat
    if not user: return True # ุงฺฏุฑ ฺฉุงุฑุจุฑ ูุฌูุฏ ูุฏุงุดุชุ ุจู ุดุฏู ุฏุฑ ูุธุฑ ุจฺฏุฑ

    conn = get_db_connection()
    if not conn: return False # ุงฺฏุฑ ุฏุชุงุจุณ ูุตู ูุดุฏุ ูุฑุถ ุจุฑ ุนุฏู ุจู ุจูุฏู ุงุณุช
    
    is_banned = False
    try:
        with conn.cursor() as cur:
            cur.execute("SELECT 1 FROM banned_users WHERE user_id = %s;", (user.id,))
            if cur.fetchone():
                is_banned = True
            
            if not is_banned and chat.type != 'private':
                cur.execute("SELECT 1 FROM banned_groups WHERE group_id = %s;", (chat.id,))
                if cur.fetchone():
                    is_banned = True
                    try:
                        await context.bot.leave_chat(chat.id)
                    except Exception:
                        pass
    except Exception as e:
        logger.error(f"Error checking ban status: {e}")
    finally:
        conn.close()
    
    return is_banned

async def check_join_for_alert(update: Update, context: ContextTypes.DEFAULT_TYPE) -> bool:
    """
    ุงู ุชุงุจุน ููุท ุจุฑุง **ูพูุณุชู** ุจู ุจุงุฒโูุง ฺฉุงุฑุช ุงุณุชูุงุฏู ูโุดูุฏ ู ุฏุฑ ุตูุฑุช ุนุฏู ุนุถูุชุ ุงูุฑุช ูโุฏูุฏ.
    """
    user = update.effective_user
    if not user or await is_owner(user.id):
        return True

    try:
        member = await context.bot.get_chat_member(chat_id=FORCED_JOIN_CHANNEL, user_id=user.id)
        if member.status in ['member', 'administrator', 'creator']:
            return True
    except Exception as e:
        logger.warning(f"Could not check channel membership for alert: {user.id}: {e}")

    if update.callback_query:
        await update.callback_query.answer(
            "ุจุฑุง ูพูุณุชู ุจู ุจุงุฒ ุจุงุฏ ุฏุฑ ฺฉุงูุงู ุนุถู ุดูุฏ",
            show_alert=True
        )
    return False

async def check_forced_join(update: Update, context: ContextTypes.DEFAULT_TYPE) -> bool:
    """
    ุนุถูุช ฺฉุงุฑุจุฑ ุฏุฑ ฺฉุงูุงู ุฑุง ฺฺฉ ูโฺฉูุฏ. ุงฺฏุฑ ุนุถู ูุจุงุดุฏุ ูพุงู ุนุถูุช ุงุฑุณุงู ฺฉุฑุฏู ู False ุจุฑูโฺฏุฑุฏุงูุฏ.
    ุงู ุชุงุจุน ููุท ุจุฑุง ุจุงุฒโูุง ฺฉู ูุงุฒ ุจู ุนุถูุช ุฏุงุฑูุฏ ุงุณุชูุงุฏู ูโุดูุฏ.
    """
    user = update.effective_user
    if not user or await is_owner(user.id):
        return True

    try:
        member = await context.bot.get_chat_member(chat_id=FORCED_JOIN_CHANNEL, user_id=user.id)
        if member.status in ['member', 'administrator', 'creator']:
            return True
    except Exception as e:
        logger.warning(f"Could not check channel membership for {user.id}: {e}")

    keyboard = [[InlineKeyboardButton(" ุนุถูุช ุฏุฑ ฺฉุงูุงู ", url=f"https://t.me/{FORCED_JOIN_CHANNEL.lstrip('@')}")]]
    text = f"โ๏ธ{user.mention_html()}ุ ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุงู ุจุฎุด ุงุจุชุฏุง ุจุงุฏ ุฏุฑ ฺฉุงูุงู ูุง ุนุถู ุดู."
    
    # ุชุดุฎุต ุงูฺฉู ูพุงุณุฎ ุจู ูพุงู ุจุงุดุฏ ุง ุจู ฺฉูฺฉ ุฑู ุฏฺฉูู
    if update.callback_query:
        await update.callback_query.answer(
            " @RHINOSOUL_TM ุจุฑุง ุงุฏุงูู ุจุงุฒ ุจุงุฏ ุฏุฑ ฺฉุงูุงู ุนุถู ุดูุฏ",
            show_alert=True
        )
    elif update.message:
        await update.message.reply_text(
            text, 
            reply_markup=InlineKeyboardMarkup(keyboard), 
            parse_mode=ParseMode.HTML
        )
        
    return False

async def rsgame_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ุฏุณุชูุฑ ุงุตู ุจุฑุง ููุงุด ูพูู ุจุงุฒโูุง ุจุง ุจุฑุฑุณ ุงููู ุนุถูุช ู ุจู ุตูุฑุช ุงุฎุชุตุงุต."""
    if await check_ban_status(update, context):
        return
    
    user = update.effective_user
    user_id = user.id
    chat_id = update.effective_chat.id
    is_member = False

    # ุจุฎุด ุจุฑุฑุณ ุนุถูุช
    if await is_owner(user_id):
        is_member = True
    else:
        try:
            member = await context.bot.get_chat_member(chat_id=FORCED_JOIN_CHANNEL, user_id=user_id)
            if member.status in ['member', 'administrator', 'creator']:
                is_member = True
        except Exception:
            is_member = False

    # --- ุณุงุฎุชุงุฑ ุตุญุญ ู ุงุตูุงุญ ุดุฏู IF/ELSE ---

    if is_member:
        # ฑ. ุงฺฏุฑ ฺฉุงุฑุจุฑ ุนุถู ุงุณุชุ ูพูู ุงุตู ุฑุง ููุงุด ุจุฏู
        text = f"๐ฎ {user.first_name} ุนุฒุฒุ ุจู ูพูู ุจุงุฒ ุฎูุด ุขูุฏุฏ.\n\nูุทูุง ุฏุณุชู ุจูุฏ ููุฑุฏ ูุธุฑ ุฎูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:"
        
        keyboard = [
            [
                InlineKeyboardButton("๐ค ุจุงุฒโูุง ุชฺฉโููุฑู", callback_data=f"rsgame_cat_single_{user_id}"),
                InlineKeyboardButton("๐ ุจุงุฒโูุง ฺฏุฑูู", callback_data=f"rsgame_cat_board_{user_id}")
            ],
            [
                InlineKeyboardButton("โ๏ธ ุจุงุฒโูุง ุชุงูพ", callback_data=f"rsgame_cat_typing_{user_id}"),
                InlineKeyboardButton("๐คซ ุจุงุฒโูุง ูุงุดูุงุณ", callback_data=f"rsgame_cat_anon_{user_id}")
            ]
        ]

        if update.effective_chat.type != 'private':
            if await is_group_admin(user_id, chat_id, context):
                keyboard.append([InlineKeyboardButton("๐ก ฺฏุฑุฏููู ุดุงูุณ (ูฺู ุงุฏูู)", callback_data=f"gardone_start_{user_id}")])
        
        keyboard.append([InlineKeyboardButton("โ๏ธ ุจุณุชู ูพูู", callback_data=f"rsgame_close_{user_id}")])
        
        # ุจุฑุฑุณ ุงูฺฉู ุขุง ุจุงุฏ ูพุงู ุฌุฏุฏ ุงุฑุณุงู ุดูุฏ ุง ูพุงู ูุจู ูุฑุงุด ุดูุฏ
        if update.message:
            await update.message.reply_text(text, reply_markup=InlineKeyboardMarkup(keyboard))
        elif update.callback_query:
            await update.callback_query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

    else:
        # ฒ. ุงฺฏุฑ ฺฉุงุฑุจุฑ ุนุถู ูุณุชุ ูพูู ุนุถูุช ุฑุง ููุงุด ุจุฏู
        text = "โ๏ธุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุจุงุฒโูุงุ ูุทูุง ุงุจุชุฏุง ุฏุฑ ฺฉุงูุงู ูุง ุนุถู ุดูุฏ ู ุณูพุณ ุฏฺฉูู ยซุนุถู ุดุฏูยป ุฑุง ุจุฒูุฏ."
        keyboard = [
            [InlineKeyboardButton("ุนุถูุช ุฏุฑ ฺฉุงูุงู", url=f"https://t.me/{FORCED_JOIN_CHANNEL.lstrip('@')}")],
            [InlineKeyboardButton("โ ุนุถู ุดุฏู", callback_data="rsgame_check_join")]
        ]
        
        if update.message:
            await update.message.reply_text(text, reply_markup=InlineKeyboardMarkup(keyboard))
        elif update.callback_query:
            await update.callback_query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

async def rsgame_check_join_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ุจุฑุฑุณ ูุฌุฏุฏ ุนุถูุช ูพุณ ุงุฒ ฺฉูฺฉ ุฑู ุฏฺฉูู 'ุนุถู ุดุฏู'."""
    query = update.callback_query
    user = query.from_user
    
    try:
        member = await context.bot.get_chat_member(chat_id=FORCED_JOIN_CHANNEL, user_id=user.id)
        if member.status in ['member', 'administrator', 'creator']:
            await query.answer("ุนุถูุช ุดูุง ุชุงุฏ ุดุฏ!")
            # ุญุงูุง ฺฉู ุนุถูุช ุชุงุฏ ุดุฏุ ูพูู ุงุตู ุฑุง ุจู ุงู ูุดุงู ูโุฏูู
            await rsgame_command(update, context)
        else:
            await query.answer("ุดูุง ูููุฒ ุฏุฑ ฺฉุงูุงู ุนุถู ูุดุฏูโุงุฏ!", show_alert=True)
    except Exception:
        await query.answer("ุฎุทุง ุฏุฑ ุจุฑุฑุณ ุนุถูุช ุฑุฎ ุฏุงุฏ. ูุทูุงู ูุญุธุงุช ุฏฺฏุฑ ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ.", show_alert=True)

async def rsgame_callback_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ูุฏุฑุช ุฏฺฉููโูุง ูพูู ุงุตู ุจุงุฒโูุง ู ุจุฑุฑุณ ูุงูฺฉุช ูพูู."""
    query = update.callback_query
    
    # -- ุจุฎุด ุฌุฏุฏ: ุจุฑุฑุณ ูุงูฺฉุช ูพูู --
    data = query.data.split('_')
    try:
        # ุขุฎุฑู ุจุฎุด callback_data ููุดู ุขุฏ ฺฉุงุฑุจุฑ ุงุณุช
        target_user_id = int(data[-1]) 
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง: ุงู ุฏฺฉูู ูููุถ ุดุฏู ุงุณุช. ูุทูุงู ุฏูุจุงุฑู ุฏุณุชูุฑ ุฑุง ุงุฑุณุงู ฺฉูุฏ.", show_alert=True)
        return

    clicker_user_id = query.from_user.id

    if clicker_user_id != target_user_id:
        await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
        return
    # -- ูพุงุงู ุจุฎุด ุฌุฏุฏ --

    await query.answer()
    
    if await check_ban_status(update, context):
        return

    action_type = data[1]
    
    if len(data) > 2 and data[2] == "main":
        await rsgame_command(update, context)
        return
        
    # ุงู ุจุฎุด ุจู ุชุงุจุน ุฌุฏุงฺฏุงูู ููุชูู ุดุฏุ ูพุณ ุงูุฌุง ูุงุฒ ุจู ุขู ูุณุช
    # if action_type == "close":
    #    await query.edit_message_text("ูพูู ุจุณุชู ุดุฏ.")
    #    return

    category = data[2]
    user_id = target_user_id
    text = "ูุทูุง ุจุงุฒ ููุฑุฏ ูุธุฑ ุฎูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:"
    keyboard = []
    
    if category == "board":
        text = " ุฏุณุชู ุจูุฏ ุจุงุฒโูุง ฺฉุงุฑุช ู ฺฏุฑูู:\n\n(ุนุถูุช ุฏุฑ ฺฉุงูุงู ุจุฑุง ูพูุณุชู ุจู ุจุงุฒ ุงูุฒุงู ุงุณุช)"
        keyboard = [
            [InlineKeyboardButton(" ุญฺฉู ฒ ููุฑู ", callback_data=f"hokm_start_2p_{user_id}")],
            [InlineKeyboardButton(" ุญฺฉู ด ููุฑู ", callback_data=f"hokm_start_4p_{user_id}")],
            [InlineKeyboardButton("๐ ุฏูุฒ ุฏู ููุฑู ", callback_data=f"dooz_start_2p_{user_id}")],
            [InlineKeyboardButton("๐ ุฏูุฒ ฺูุงุฑ ููุฑู", callback_data=f"doz4p_start_{user_id}")],
            [InlineKeyboardButton(" ฺูุงุฑ ุฏุฑ ฺฉ ุฑุฏู ", callback_data=f"connect4_start_{user_id}")],
            [InlineKeyboardButton(" ุณูฺฏ ฺฉุงุบุฐ ูฺ โ๏ธ", callback_data=f"rps_start_{user_id}")],
            [InlineKeyboardButton("๐ง ุจุงุฒ ุญุงูุธู", callback_data=f"rsgame_cat_memory_{user_id}")],
            [InlineKeyboardButton(" ุจุงุฒฺฏุดุช ", callback_data=f"rsgame_cat_main_{user_id}")]
        ]
    elif category == "memory":
        text = "๐ง ูุทูุง ุณุทุญ ุจุงุฒ ุญุงูุธู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:"
        keyboard = [
            [
                InlineKeyboardButton("ุขุณุงู (4x3)", callback_data=f"memory_start_4x3_{user_id}"),
                InlineKeyboardButton("ูุชูุณุท (4x4)", callback_data=f"memory_start_4x4_{user_id}")
            ],
            [
                InlineKeyboardButton("ุณุฎุช (6x4)", callback_data=f"memory_start_6x4_{user_id}"),
                InlineKeyboardButton("ุญุฑููโุง (6x6)", callback_data=f"memory_start_6x6_{user_id}")
            ],
            [InlineKeyboardButton(" ุจุงุฒฺฏุดุช ", callback_data=f"rsgame_cat_main_{user_id}")]
        ]
    elif category == "typing":
        text = " ุฏุณุชู ุจูุฏ ุจุงุฒโูุง ุชุงูพ ู ุณุฑุนุช (ุจุฏูู ุงุฌุจุงุฑ ุนุถูุช):"
        keyboard = [
            [InlineKeyboardButton(" ุญุฏุณ ฺฉููู ", callback_data=f"hads_kalame_start_{user_id}")],
            [InlineKeyboardButton(" ุชุงูพ ุณุฑุนุช ", callback_data=f"type_start_{user_id}")],
            [InlineKeyboardButton(" ุญุฏุณ ุนุฏุฏ (ูฺู ุงุฏูู)", callback_data=f"hads_addad_start_{user_id}")],
            [InlineKeyboardButton(" ุจุงุฒฺฏุดุช ", callback_data=f"rsgame_cat_main_{user_id}")]
        ]
    elif category == "single":
        text = "๐ค ูุทูุง ุจุงุฒ ุชฺฉโููุฑู ููุฑุฏ ูุธุฑ ุฎูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:"
        keyboard = [
            [InlineKeyboardButton("2๏ธโฃ0๏ธโฃ4๏ธโฃ8๏ธโฃ", callback_data=f"2048_start_{user_id}")],
            [InlineKeyboardButton("๐ข ูพุงุฒู ฺฉุดู", callback_data=f"spuzzle_start_{user_id}")],
            [InlineKeyboardButton("โจ ุจุงุฒ ุฌูุชโูุง", callback_data=f"samegame_start_{user_id}")],
            [InlineKeyboardButton(" ุจุงุฒฺฏุดุช ", callback_data=f"rsgame_cat_main_{user_id}")]
        ]
    elif category == "anon":
        if not await is_group_admin(clicker_user_id, query.message.chat.id, context):
            await query.answer("ุงู ุจุฎุด ููุท ุจุฑุง ูุฏุฑุงู ฺฏุฑูู ุฏุฑ ุฏุณุชุฑุณ ุงุณุช.", show_alert=True)
            return
            
        text = " ุฏุณุชู ุจูุฏ ุจุงุฒโูุง ูุงุดูุงุณ (ูฺู ุงุฏูู):"
        keyboard = [
            [InlineKeyboardButton(" ุงุนุชุฑุงู (ูุชู ูพุดโูุฑุถ) ", callback_data=f"eteraf_start_default_{user_id}")],
            [InlineKeyboardButton(" ุงุนุชุฑุงู (ูุชู ุณูุงุฑุด) ", callback_data=f"eteraf_start_custom_{user_id}")],
            [InlineKeyboardButton(" ูุงุฑฺ (ุจุง ูุธุงุฑุช ฺฏุงุฏ) ", callback_data=f"gharch_start_{user_id}")],
            [InlineKeyboardButton(" ุจุงุฒฺฏุดุช ", callback_data=f"rsgame_cat_main_{user_id}")]
        ]
        
    await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

# --------------------------- GAME: HOKM (ุจุฏูู ุชุบุฑ ุฏุฑ ููุทู ุงุตู) ---------------------------
# ุชูุงุจุน ฺฉูฺฉ ุญฺฉู (card_to_persian, create_deck, ...) ููุงููุฏ ูุจู ุจุงู ูโูุงููุฏ
# ... (ฺฉุฏ ุจุงุฒ ุญฺฉู ุฏุฑ ุงูุฌุง ูุฑุงุฑ ูโฺฏุฑุฏ - ุจุฏูู ุชุบุฑ)

async def rsgame_close_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ูพูู ุจุงุฒ ุฑุง ูโุจูุฏุฏ ู ูุงูฺฉุช ุขู ุฑุง ฺฺฉ ูโฺฉูุฏ."""
    query = update.callback_query
    
    # --- ุจุฎุด ุงููุช ุฌุฏุฏ ---
    data = query.data.split('_')
    try:
        target_user_id = int(data[-1])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
        return

    if query.from_user.id != target_user_id:
        await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
        return
    # --- ูพุงุงู ุจุฎุด ุงููุช ---

    await query.answer()
    try:
        await query.edit_message_text("ูพูู ุจุณุชู ุดุฏ.")
    except Exception:
        # ุงฺฏุฑ ูพุงู ุฎู ูุฏู ุจุงุดุฏ ุง ูุดฺฉู ุฏุฑ ูุฑุงุด ูพุด ุจุงุฏุ ุขู ุฑุง ุญุฐู ูโฺฉูู
        try:
            await query.delete_message()
        except Exception:
            pass

# --- ุชูุงุจุน ฺฉูฺฉ ุญฺฉู (ุจุฏูู ุชุบุฑ ุฏุฑ ููุทู) ---

def create_deck():
    """ฺฉ ุฏุณุชู ฺฉุงุฑุช ูุฑุชุจ ุดุฏู ตฒุชุง ุงุฌุงุฏ ู ุขู ุฑุง ุจูุฑ ูโุฒูุฏ."""
    suits = ['S', 'H', 'D', 'C']  # Spades, Hearts, Diamonds, Clubs
    ranks = list(range(2, 15))  # 2-10, J(11), Q(12), K(13), A(14)
    deck = [f"{s}{r}" for s in suits for r in ranks]
    random.shuffle(deck)
    return deck

def card_to_persian(card):
    """ฺฉุงุฑุช ุฑุง ุจู ูุฑูุช ูุงุฑุณ ุจุง ุงููุฌ ุชุจุฏู ูโฺฉูุฏ."""
    if not card: return "๐"
    suits = {'S': 'โ๏ธ', 'H': 'โฅ๏ธ', 'D': 'โฆ๏ธ', 'C': 'โฃ๏ธ'}
    ranks = {11: 'J', 12: 'Q', 13: 'K', 14: 'A'}
    suit, rank = card[0], int(card[1:])
    rank_display = str(ranks.get(rank, rank))
    return f"{suits[suit]} {rank_display}"

def get_card_value(card, hokm_suit, trick_suit):
    """ุงุฑุฒุด ุนุฏุฏ ฺฉ ฺฉุงุฑุช ุฑุง ุจุฑุง ููุงุณู ู ุชุนู ุจุฑูุฏู ุฏุณุช ูุญุงุณุจู ูโฺฉูุฏ."""
    suit, rank = card[0], int(card[1:])
    value = rank
    if suit == hokm_suit:
        value += 200  # ฺฉุงุฑุชโูุง ุญฺฉู ุจุงูุงุชุฑู ุงุฑุฒุด ุฑุง ุฏุงุฑูุฏ
    elif suit == trick_suit:
        value += 100  # ฺฉุงุฑุชโูุง ุฎุงู ุฒูู ุงุฑุฒุด ุจุดุชุฑ ุงุฒ ุณุงุฑ ุฎุงูโูุง ุฏุงุฑูุฏ
    return value

async def render_hokm_board(game: dict, context: ContextTypes.DEFAULT_TYPE):
    """ุตูุญู ุจุงุฒ (ูุชู ู ุฏฺฉููโูุง) ุฑุง ุจุฑ ุงุณุงุณ ูุถุนุช ูุนู ุจุงุฒ ุชููุฏ ูโฺฉูุฏ."""
    game_id = game['message_id']
    keyboard = []
    
    p_names = [p['name'] for p in game['players']]
    p_ids = [p['id'] for p in game['players']]
    
    table_cards_map = {pid: "โ" for pid in p_ids}
    for play in game.get('current_trick', []):
        table_cards_map[play['player_id']] = card_to_persian(play['card'])

    # ุจุฎุด ููุงุด ุจุงุฒฺฉูุงู ู ฺฉุงุฑุชโูุง ุฑู ูุฒ
    if game['mode'] == '4p':
        team_a_text = f"๐ด ุชู 1: {p_names[0]} ู {p_names[2]}"
        team_b_text = f"๐ต ุชู 2: {p_names[1]} ู {p_names[3]}"
        
        board_layout = [
            [InlineKeyboardButton(team_a_text, callback_data=f"hokm_noop_{game_id}")],
            [InlineKeyboardButton(team_b_text, callback_data=f"hokm_noop_{game_id}")],
            [InlineKeyboardButton("ุจุงุฒฺฉู", callback_data=f"hokm_noop_{game_id}"), InlineKeyboardButton("ฺฉุงุฑุช ุจุงุฒ ุดุฏู", callback_data=f"hokm_noop_{game_id}")],
        ]
        for i in range(4):
            board_layout.append([
                InlineKeyboardButton(p_names[i], callback_data=f"hokm_noop_{game_id}"), 
                InlineKeyboardButton(table_cards_map[p_ids[i]], callback_data=f"hokm_noop_{game_id}")
            ])
        keyboard.extend(board_layout)
    else: # ุญุงูุช ุฏู ููุฑู
        for i in range(2):
            keyboard.append([
                InlineKeyboardButton(p_names[i], callback_data=f"hokm_noop_{game_id}"), 
                InlineKeyboardButton(table_cards_map[p_ids[i]], callback_data=f"hokm_noop_{game_id}")
            ])

    # ุจุฎุด ููุงุด ูุถุนุช ู ุงูุชุงุฒุงุช
    hokm_suit_fa = card_to_persian(f"{game['hokm_suit']}2")[0] if game.get('hokm_suit') else 'โ'
    hakem_name = game.get('hakem_name', '...')
    
    if game['mode'] == '4p':
        trick_score_text = f"ุฏุณุช: ๐ด {game['trick_scores']['A']} - {game['trick_scores']['B']} ๐ต"
        game_score_text = f"ุงูุชุงุฒ ฺฉู: ๐ด {game['game_scores']['A']} - {game['game_scores']['B']} ๐ต"
    else:
        trick_score_text = f"ุฏุณุช: {p_names[0]} {game['trick_scores'][p_ids[0]]} - {game['trick_scores'][p_ids[1]]} {p_names[1]}"
        game_score_text = f"ุงูุชุงุฒ ฺฉู: {p_names[0]} {game['game_scores'][p_ids[0]]} - {game['game_scores'][p_ids[1]]} {p_names[1]}"

    keyboard.append([InlineKeyboardButton(f"ุญุงฺฉู: {hakem_name}", callback_data=f"hokm_noop_{game_id}"), InlineKeyboardButton(f"ุญฺฉู: {hokm_suit_fa}", callback_data=f"hokm_noop_{game_id}")])
    keyboard.append([InlineKeyboardButton(trick_score_text, callback_data=f"hokm_noop_{game_id}")])
    keyboard.append([InlineKeyboardButton(game_score_text, callback_data=f"hokm_noop_{game_id}")])

    # ุจุฎุด ุฏฺฉููโูุง ฺฉูุชุฑู
    keyboard.append([InlineKeyboardButton("๐ ููุงุด ุฏุณุช ูู (ุฎุตูุต)", callback_data=f"hokm_showhand_{game_id}")])

    if game['status'] == 'hakem_choosing' and game.get('turn_index') is not None and game['players'][game['turn_index']]['id'] == game.get('hakem_id'):
        suit_map = {'โ๏ธ': 'S', 'โฅ๏ธ': 'H', 'โฆ๏ธ': 'D', 'โฃ๏ธ': 'C'}
        choose_buttons = [InlineKeyboardButton(emoji, callback_data=f"hokm_choose_{game_id}_{char}") for emoji, char in suit_map.items()]
        keyboard.append(choose_buttons)
    elif game['status'] == 'playing' and game.get('turn_index') is not None:
        current_player_id = game['players'][game['turn_index']]['id']
        if current_player_id in game['hands']:
            player_hand = sorted(game['hands'][current_player_id])
            card_buttons = [InlineKeyboardButton(str(i + 1), callback_data=f"hokm_play_{game_id}_{i}") for i in range(len(player_hand))]
            for i in range(0, len(card_buttons), 7):
                keyboard.append(card_buttons[i:i+7])
    
    return InlineKeyboardMarkup(keyboard)

# --- ุชุงุจุน ุงุตู ู ุงุตูุงุญ ุดุฏู ุญฺฉู ---

async def hokm_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    chat_id = query.message.chat_id
    
    # if await check_ban_status(update, context): return
    
    data = query.data.split('_')
    action = data[1]

    # --- ุจููฺฉ ฑ: ุดุฑูุน ุจุงุฒ ---
    if action == "start":
        try:
            target_user_id = int(data[-1])
            if user.id != target_user_id:
                await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
                return
        except (ValueError, IndexError):
            await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
            return

        mode = data[2]
        max_players = 4 if mode == '4p' else 2

        if chat_id not in active_games['hokm']:
            active_games['hokm'][chat_id] = {}
        
        sent_message = await query.message.reply_text(f"ุฏุฑ ุญุงู ุณุงุฎุช ุจุงุฒ ุญฺฉู {max_players} ููุฑู...")
        game_id = sent_message.message_id
        
        game = {
            "status": "joining", 
            "mode": mode, 
            "players": [{'id': user.id, 'name': user.first_name}], 
            "message_id": game_id,
            "hands": {}, "deck": [], "hakem_id": None
        }
        active_games['hokm'][chat_id][game_id] = game
        
        keyboard = [[InlineKeyboardButton(f"ูพูุณุชู ุจู ุจุงุฒ (1/{max_players})", callback_data=f"hokm_join_{game_id}")]]
        await sent_message.edit_text(
            f"ุจุงุฒ ุญฺฉู {max_players} ููุฑู ุชูุณุท {user.mention_html()} ุณุงุฎุชู ุดุฏ! ููุชุธุฑ ุจุงุฒฺฉูุงู...\n\n( @RHINOSOUL_TM ุจุฑุง ูพูุณุชู ุจู ุจุงุฒุ ุจุงุฏ ุฏุฑ ฺฉุงูุงู ุนุถู ุจุงุดุฏ)", 
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode=ParseMode.HTML
        )
        
        try:
            await query.message.delete()
        except Exception:
            pass
        return

    # --- ุจููฺฉ ฒ: ูุฏุฑุช ุณุงุฑ ุงฺฉุดูโูุง ุจุงุฒ (Join, Play, Choose ...) ---
    try:
        game_id = int(data[2])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง ุฏุฑ ูพุฑุฏุงุฒุด ุฏุฑุฎูุงุณุช.", show_alert=True)
        return

    if chat_id not in active_games['hokm'] or game_id not in active_games['hokm'][chat_id]:
        await query.answer("ุงู ุจุงุฒ ุฏฺฏุฑ ูุนุงู ูุณุช.", show_alert=True)
        try: await query.edit_message_text("ุงู ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.")
        except: pass
        return
        
    game = active_games['hokm'][chat_id][game_id]

    # --- ุณุงุฎุชุงุฑ ุฌุฏุฏ ุจุง elif ---
    if action == "join":
        if not await check_join_for_alert(update, context):
            return
            
        if any(p['id'] == user.id for p in game['players']):
            await query.answer("ุดูุง ูุจูุงู ุจู ุจุงุฒ ูพูุณุชูโุงุฏ!", show_alert=True)
            return
            
        max_players = 4 if game['mode'] == '4p' else 2
        if len(game['players']) >= max_players:
            await query.answer("ุธุฑูุช ุจุงุฒ ุชฺฉูู ุงุณุช.", show_alert=True)
            return
            await query.answer()
        game['players'].append({'id': user.id, 'name': user.first_name})
        num_players = len(game['players'])

        if num_players < max_players:
            keyboard = [[InlineKeyboardButton(f"ูพูุณุชู ุจู ุจุงุฒ ({num_players}/{max_players})", callback_data=f"hokm_join_{game_id}")]]
            player_names = "ุ ".join([p['name'] for p in game['players']])
            await query.edit_message_text(f"ุจุงุฒ ุญฺฉู ููุชุธุฑ ุจุงุฒฺฉูุงู...\n\nุจุงุฒฺฉูุงู ูุนู: {player_names}\n\n( @RHINOSOUL_TM ุจุฑุง ูพูุณุชู ุจู ุจุงุฒุ ุจุงุฏ ุฏุฑ ฺฉุงูุงู ุนุถู ุจุงุดุฏ)", reply_markup=InlineKeyboardMarkup(keyboard))
        else:
            p_ids = [p['id'] for p in game['players']]
            game.update({
                "status": "dealing_first_5", "deck": create_deck(), "hands": {pid: [] for pid in p_ids},
                "hakem_id": None, "hakem_name": None, "turn_index": 0, "hokm_suit": None, "current_trick": [],
                "trick_scores": {'A': 0, 'B': 0} if game['mode'] == '4p' else {pid: 0 for pid in p_ids},
                "game_scores": game.get('game_scores', {'A': 0, 'B': 0} if game['mode'] == '4p' else {pid: 0 for pid in p_ids})
            })

            for _ in range(5):
                for p in game['players']: game['hands'][p['id']].append(game['deck'].pop(0))
            
            hakem_p = next((p for p in game['players'] if 'S14' in game['hands'][p['id']]), game['players'][0])
            game.update({"hakem_id": hakem_p['id'], "hakem_name": hakem_p['name'], "status": 'hakem_choosing'})
            game['turn_index'] = next(i for i, p in enumerate(game['players']) if p['id'] == hakem_p['id'])
            
            reply_markup = await render_hokm_board(game, context)
            await query.edit_message_text(f"ุจุงุฒฺฉูุงู ฺฉุงูู ุดุฏูุฏ!\nุญุงฺฉู: {game['hakem_name']}\n\nูุทูุง ุญฺฉู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ.", reply_markup=reply_markup)

    elif action == "choose":
        if user.id != game.get('hakem_id'):
            await query.answer("ุดูุง ุญุงฺฉู ูุณุชุฏ!", show_alert=True)
            return
        if game['status'] != 'hakem_choosing':
            await query.answer("ุงูุงู ุฒูุงู ุงูุชุฎุงุจ ุญฺฉู ูุณุช!", show_alert=True)
            return
            
        game['hokm_suit'] = data[3]
        
        for p in game['players']:
            while len(game['hands'][p['id']]) < 13: 
                if not game['deck']: break
                game['hands'][p['id']].append(game['deck'].pop(0))
        
        game['status'] = 'playing'
        game['turn_index'] = next(i for i, p in enumerate(game['players']) if p['id'] == game['hakem_id'])
        turn_player_name = game['players'][game['turn_index']]['name']
        
        reply_markup = await render_hokm_board(game, context)
        await query.edit_message_text(f"ุจุงุฒ ุดุฑูุน ุดุฏ! ุญฺฉู: {card_to_persian(game['hokm_suit']+'2')[0]}\n\nููุจุช {turn_player_name} ุงุณุช.", reply_markup=reply_markup)

    elif action == "showhand":
        if not any(p['id'] == user.id for p in game['players']):
            await query.answer("ุดูุง ุจุงุฒฺฉู ุงู ูุณุงุจูู ูุณุชุฏ!", show_alert=True)
            return
        hand = sorted(game['hands'].get(user.id, []))
        hand_str = "\n".join([f"{i+1}. {card_to_persian(c)}" for i, c in enumerate(hand)]) or "ุดูุง ฺฉุงุฑุช ุฏุฑ ุฏุณุช ูุฏุงุฑุฏ."
        await query.answer(f"ุฏุณุช ุดูุง:\n{hand_str}", show_alert=True)

    elif action == "play":
        if game['status'] != 'playing' or user.id != game['players'][game['turn_index']]['id']:
            await query.answer("ููุจุช ุดูุง ูุณุช!", show_alert=True)
            return
        
        card_index = int(data[3])
        hand = sorted(game['hands'][user.id]) 
        if not (0 <= card_index < len(hand)):
            await query.answer("ุดูุงุฑู ฺฉุงุฑุช ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
            return
        
        card_played = hand[card_index]
        if game['current_trick']:
            trick_suit = game['current_trick'][0]['card'][0]
            if any(c.startswith(trick_suit) for c in hand) and not card_played.startswith(trick_suit):
                await query.answer(f"ุดูุง ุจุงุฏ ุงุฒ ุฎุงู ุฒูู ({card_to_persian(trick_suit+'2')[0]}) ุจุงุฒ ฺฉูุฏ!", show_alert=True)
                return

        game['hands'][user.id].remove(card_played)
        game['current_trick'].append({'player_id': user.id, 'card': card_played})

        num_players = len(game['players'])
        if len(game['current_trick']) < num_players:
            game['turn_index'] = (game['turn_index'] + 1) % num_players
            turn_player_name = game['players'][game['turn_index']]['name']
            reply_markup = await render_hokm_board(game, context)
            await query.edit_message_text(f"ุญฺฉู: {card_to_persian(game['hokm_suit']+'2')[0]}\n\nููุจุช {turn_player_name} ุงุณุช.", reply_markup=reply_markup)
            return

        # --- ุฏุณุช ุชฺฉูู ุดุฏูุ ุจุฑูุฏู ุฑุง ูุดุฎุต ฺฉู ---
        trick_suit = game['current_trick'][0]['card'][0]
        winner_play = max(game['current_trick'], key=lambda p: get_card_value(p['card'], game['hokm_suit'], trick_suit))
        winner_id = winner_play['player_id']
        
        if game['mode'] == '4p':
            winner_team = 'A' if winner_id in [game['players'][0]['id'], game['players'][2]['id']] else 'B'
            game['trick_scores'][winner_team] += 1
            round_over = game['trick_scores']['A'] == 7 or game['trick_scores']['B'] == 7
        else:
            game['trick_scores'][winner_id] += 1
            round_over = any(score == 7 for score in game['trick_scores'].values())

        game['turn_index'] = next(i for i, p in enumerate(game['players']) if p['id'] == winner_id)
        
        # ููุงุด ูููุช ูุชุฌู ุฏุณุช
        winner_name = next(p['name'] for p in game['players'] if p['id'] == winner_id)
        temp_game_state = game.copy()
        temp_reply_markup = await render_hokm_board(temp_game_state, context)
        await query.edit_message_text(f"ุจุฑูุฏู ุงู ุฏุณุช: {winner_name}\n\nุตุจุฑ ฺฉูุฏ...", reply_markup=temp_reply_markup)
        
        await asyncio.sleep(2.5)

        game['current_trick'] = [] # ูพุงฺฉ ฺฉุฑุฏู ูุฒ

        if not round_over:
            turn_player_name = game['players'][game['turn_index']]['name']
            reply_markup = await render_hokm_board(game, context)
            await query.edit_message_text(f"ุญฺฉู: {card_to_persian(game['hokm_suit']+'2')[0]}\n\nููุจุช {turn_player_name} ุงุณุช.", reply_markup=reply_markup)
        else:
            # --- ุฏูุฑ ุชูุงู ุดุฏูุ ุงูุชุงุฒ ุฑุง ุซุจุช ฺฉู ---
            if game['mode'] == '4p':
                winning_team_name = 'A' if game['trick_scores']['A'] == 7 else 'B'
                game['game_scores'][winning_team_name] += 1
                winner_display_name = f"ุชู {winning_team_name}"
                game_over = game['game_scores'][winning_team_name] == 7
            else:
                round_winner_id = next(pid for pid, score in game['trick_scores'].items() if score == 7)
                winner_display_name = next(p['name'] for p in game['players'] if p['id'] == round_winner_id)
                game['game_scores'][round_winner_id] += 1
                game_over = any(score == 7 for score in game['game_scores'].values())

            if game_over:
                await query.edit_message_text(f"๐ **ุจุงุฒ ุชูุงู ุดุฏ!** ๐\n\nุจุฑูุฏู ููุง: **{winner_display_name}**", parse_mode=ParseMode.MARKDOWN)
                del active_games['hokm'][chat_id][game_id]
                return
            
            # --- ุดุฑูุน ุฏูุฑ ุฌุฏุฏ ---
            current_hakem_index = next(i for i, p in enumerate(game['players']) if p['id'] == game['hakem_id'])
            if game['mode'] == '4p':
                hakem_team = 'A' if current_hakem_index in [0, 2] else 'B'
                next_hakem_index = current_hakem_index if winning_team_name == hakem_team else (current_hakem_index + 1) % 4
            else:
                round_winner_id = next(pid for pid, score in game['trick_scores'].items() if score == 7)
                next_hakem_index = current_hakem_index if round_winner_id == game['hakem_id'] else (current_hakem_index + 1) % 2
            
            p_ids = [p['id'] for p in game['players']]
            game.update({ 
                "status": "dealing_first_5", "deck": create_deck(), 
                "hands": {pid: [] for pid in p_ids},
                "trick_scores": {'A': 0, 'B': 0} if game['mode'] == '4p' else {pid: 0 for pid in p_ids} 
            })
            for _ in range(5):
                for p in game['players']: game['hands'][p['id']].append(game['deck'].pop(0))
            
            game['hakem_id'] = game['players'][next_hakem_index]['id']
            game['hakem_name'] = game['players'][next_hakem_index]['name']
            game['status'] = 'hakem_choosing'
            game['turn_index'] = next_hakem_index

            reply_markup = await render_hokm_board(game, context)
            await query.edit_message_text(f"ุงู ุฏุณุช ุชูุงู ุดุฏ! ุจุฑูุฏู: {winner_display_name}\n\n-- ุฏูุฑ ุฌุฏุฏ --\nุญุงฺฉู ุฌุฏุฏ: {game['hakem_name']}\nููุชุธุฑ ุงูุชุฎุงุจ ุญฺฉู...", reply_markup=reply_markup)

    elif action == "noop":
        # ุงู ุฏฺฉููโูุง ฺฉุงุฑ ุงูุฌุงู ููโุฏููุฏุ ูพุณ ููุท answer ูโุฏูู
        pass
# --------------------------- GAME: 2048 (ุฌุฏุฏ) ---------------------------
# --- ุชูุงุจุน ฺฉูฺฉ 2048 (ุจุฏูู ุชุบุฑ ุฏุฑ ููุทู) ---

def new_2048_board():
    """ฺฉ ุตูุญู ุฎุงู ดxด ุจุฑุง ุจุงุฒ 2048 ุงุฌุงุฏ ูโฺฉูุฏ."""
    return [[0] * 4 for _ in range(4)]

def add_new_2048_tile(board):
    """ฺฉ ููุฑู ฒ ุง ด ุจู ุตูุฑุช ุชุตุงุฏู ุจู ฺฉ ุฎุงูู ุฎุงู ุงุถุงูู ูโฺฉูุฏ."""
    empty_cells = [(r, c) for r in range(4) for c in range(4) if board[r][c] == 0]
    if not empty_cells:
        return board
    r, c = random.choice(empty_cells)
    board[r][c] = 2 if random.random() < 0.9 else 4  # 90% ุดุงูุณ ุจุฑุง ฒ
    return board

def can_move_2048(board):
    """ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ุญุฑฺฉุช ุฏุฑ ุตูุญู ุงูฺฉุงูโูพุฐุฑ ุงุณุช ุง ุฎุฑ."""
    for r in range(4):
        for c in range(4):
            if board[r][c] == 0:
                return True  # ุฎุงูู ุฎุงู ูุฌูุฏ ุฏุงุฑุฏ
            # ฺฺฉ ฺฉุฑุฏู ููุณุงูโูุง ุณูุช ุฑุงุณุช ู ูพุงู
            if c < 3 and board[r][c] == board[r][c+1]:
                return True
            if r < 3 and board[r][c] == board[r+1][c]:
                return True
    return False

def transform_2048_board(board, direction):
    """ุตูุญู ุฑุง ุจุฑ ุงุณุงุณ ุฌูุช ุญุฑฺฉุช ูโฺุฑุฎุงูุฏ ุชุง ููุทู ุญุฑฺฉุช ุจู ฺูพ ุจุฑุง ููู ุฌูุงุช ูุงุจู ุงุณุชูุงุฏู ุจุงุดุฏ."""
    if direction == 'left':
        return board
    if direction == 'right':
        return [row[::-1] for row in board]
    if direction == 'up':
        return [list(col) for col in zip(*board)]  # Transpose
    if direction == 'down':
        new_board = [list(col) for col in zip(*board)]  # Transpose
        return [row[::-1] for row in new_board]

def reverse_transform_2048_board(board, direction):
    """ุตูุญู ฺุฑุฎุงูุฏู ุดุฏู ุฑุง ุจู ุญุงูุช ุงููู ุจุฑูโฺฏุฑุฏุงูุฏ."""
    if direction == 'left':
        return board
    if direction == 'right':
        return [row[::-1] for row in board]
    if direction == 'up':
        return [list(col) for col in zip(*board)]  # Transpose
    if direction == 'down':
        board = [row[::-1] for row in board]
        return [list(col) for col in zip(*board)]  # Transpose

def move_2048_left(board):
    """ููุทู ุงุตู ุญุฑฺฉุช ู ุงุฏุบุงู ููุฑูโูุง ุจู ุณูุช ฺูพ."""
    new_board = []
    score_increment = 0
    moved = False
    for row in board:
        compressed_row = [num for num in row if num != 0]
        new_row = []
        i = 0
        while i < len(compressed_row):
            if i + 1 < len(compressed_row) and compressed_row[i] == compressed_row[i+1]:
                new_value = compressed_row[i] * 2
                new_row.append(new_value)
                score_increment += new_value
                i += 2
            else:
                new_row.append(compressed_row[i])
                i += 1
        new_row.extend([0] * (4 - len(new_row)))
        new_board.append(new_row)
    
    if board != new_board:
        moved = True
        
    return new_board, score_increment, moved

async def render_2048_board(game):
    """ุตูุญู ุจุงุฒ 2048 ุฑุง ุจุฑุง ููุงุด ุจู ฺฉุงุฑุจุฑ ุฑูุฏุฑ ูโฺฉูุฏ."""
    game_id = game['game_id']
    board = game['board']
    score = game['score']
    
    tile_map = {0: " ", 2: "2๏ธโฃ", 4: "4๏ธโฃ", 8: "8๏ธโฃ", 16: "1๏ธโฃ6๏ธโฃ", 32: "3๏ธโฃ2๏ธโฃ", 64: "6๏ธโฃ4๏ธโฃ", 128: "1๏ธโฃ2๏ธโฃ8๏ธโฃ", 256: "2๏ธโฃ5๏ธโฃ6๏ธโฃ", 512: "5๏ธโฃ1๏ธโฃ2๏ธโฃ", 1024: "๐2๏ธโฃ4๏ธโฃ", 2048: "๐"}
    
    text = f"๐ข **ุจุงุฒ 2048**\n\nุงูุชุงุฒ: **{score}**"
    
    keyboard = []
    for r in range(4):
        row_buttons = [InlineKeyboardButton(tile_map.get(cell, str(cell)), callback_data=f"2048_noop_{game_id}") for cell in board[r]]
        keyboard.append(row_buttons)
        
    keyboard.extend([
        [
            InlineKeyboardButton(" ", callback_data=f"2048_noop_{game_id}"),
            InlineKeyboardButton("โฌ๏ธ", callback_data=f"2048_move_{game_id}_up"),
            InlineKeyboardButton(" ", callback_data=f"2048_noop_{game_id}"),
        ],
        [
            InlineKeyboardButton("โฌ๏ธ", callback_data=f"2048_move_{game_id}_left"),
            InlineKeyboardButton(" ", callback_data=f"2048_noop_{game_id}"),
            InlineKeyboardButton("โก๏ธ", callback_data=f"2048_move_{game_id}_right"),
        ],
        [
            InlineKeyboardButton(" ", callback_data=f"2048_noop_{game_id}"),
            InlineKeyboardButton("โฌ๏ธ", callback_data=f"2048_move_{game_id}_down"),
            InlineKeyboardButton(" ", callback_data=f"2048_noop_{game_id}"),
        ],
        [InlineKeyboardButton("โ๏ธ ุจุณุชู ุจุงุฒ", callback_data=f"2048_close_{game_id}")]
    ])
    
    return text, InlineKeyboardMarkup(keyboard)

# --- ุชุงุจุน ุงุตู ู ุงุตูุงุญ ุดุฏู 2048 ---

async def game_2048_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    user = query.from_user
    chat_id = query.message.chat.id

    data = query.data.split('_')
    action = data[1]

    if action == "start":
        try:
            target_user_id = int(data[-1])
            if user.id != target_user_id:
                await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
                return
        except (ValueError, IndexError):
            await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
            return

        if chat_id not in active_games['2048']:
            active_games['2048'][chat_id] = {}
        
        if any(g['player_id'] == user.id for g in active_games['2048'].get(chat_id, {}).values()):
            await query.answer("ุดูุง ุงุฒ ูุจู ฺฉ ุจุงุฒ 2048 ูุนุงู ุฏุงุฑุฏ.", show_alert=True)
            return

        sent_message = await query.message.reply_text("ุฏุฑ ุญุงู ุณุงุฎุช ุจุงุฒ 2048...")
        game_id = sent_message.message_id
        
        initial_board = new_2048_board()
        add_new_2048_tile(initial_board)
        add_new_2048_tile(initial_board)
        
        game = {
            "game_id": game_id,
            "player_id": user.id,
            "board": initial_board,
            "score": 0,
            "is_busy": False
        }
        active_games['2048'][chat_id][game_id] = game
        
        text, reply_markup = await render_2048_board(game)
        await sent_message.edit_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
        
        try:
            await query.message.delete()
        except Exception:
            pass
        return

    try:
        game_id = int(data[2])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง ุฏุฑ ูพุฑุฏุงุฒุด ุฏุฑุฎูุงุณุช.", show_alert=True)
        return

    if chat_id not in active_games['2048'] or game_id not in active_games['2048'][chat_id]:
        await query.answer("ุงู ุจุงุฒ ุฏฺฏุฑ ูุนุงู ูุณุช.", show_alert=True)
        try: await query.edit_message_text("ุงู ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.")
        except: pass
        return
        
    game = active_games['2048'][chat_id][game_id]
    
    if user.id != game['player_id']:
        await query.answer("ุงู ุจุงุฒ ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
        return

    if game.get('is_busy', False):
        return

    if action == "move":
        game['is_busy'] = True
        try:
            direction = data[3]
            
            transformed = transform_2048_board(game['board'], direction)
            moved_board, score_inc, moved = move_2048_left(transformed)
            final_board = reverse_transform_2048_board(moved_board, direction)

            if moved:
                game['board'] = add_new_2048_tile(final_board)
                game['score'] += score_inc
            else:
                await query.answer("ุญุฑฺฉุช ุบุฑูุฌุงุฒ!")
                return

            text, reply_markup = await render_2048_board(game)
            
            game_over = False
            if any(2048 in row for row in game['board']):
                text += f"\n\n๐ **ุชุจุฑฺฉ!** ุดูุง ุจุฑูุฏู ุดุฏุฏ! ๐"
                game_over = True
            elif not can_move_2048(game['board']):
                text += f"\n\nโ๏ธ **ุจุงุฒ ุชูุงู ุดุฏ!** ุดูุง ุจุงุฎุชุฏ."
                game_over = True

            if game_over:
                await query.edit_message_text(text, reply_markup=None, parse_mode=ParseMode.MARKDOWN)
                del active_games['2048'][chat_id][game_id]
            else:
                await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
        finally:
            if chat_id in active_games['2048'] and game_id in active_games['2048'][chat_id]:
                active_games['2048'][chat_id][game_id]['is_busy'] = False

    elif action == "close":
        await query.edit_message_text("ุจุงุฒ 2048 ุจุณุชู ุดุฏ.")
        del active_games['2048'][chat_id][game_id]

    elif action == "noop":
        pass

# --------------------------- GAME: GUESS THE NUMBER (ConversationHandler - ุจุฏูู ุชุบุฑ) ---------------------------
async def hads_addad_start_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    query = update.callback_query
    user = query.from_user
    context.chat_data['starter_admin_id'] = query.from_user.id
    data = query.data.split('_')
    try:
        target_user_id = int(data[-1])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
        return

    if user.id != target_user_id:
        await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
        return
        await query.answer()
    
    if await check_ban_status(update, context): return ConversationHandler.END
    
    # ุงูุฑุช ุจุฑุง ฺฉุงุฑุจุฑ ุนุงุฏ
    if not await is_group_admin(query.from_user.id, query.message.chat.id, context):
        await query.answer("โ ุงู ุจุงุฒ ููุท ุชูุณุท ูุฏุฑุงู ฺฏุฑูู ูุงุจู ุงุฌุฑุงุณุช.", show_alert=True)
        return ConversationHandler.END
        
    if query.message.chat.id in active_games['guess_number']:
        await query.answer("ฺฉ ุจุงุฒ ุญุฏุณ ุนุฏุฏ ุฏุฑ ุงู ฺฏุฑูู ูุนุงู ุงุณุช.", show_alert=True)
        return ConversationHandler.END
        
    await query.edit_message_text("ุจุงุฒู ุจุงุฒ ุฑุง ูุดุฎุต ฺฉูุฏ. (ูุซุงู: `1-1000`)\nุจุฑุง ูุบู /cancel ุฑุง ุงุฑุณุงู ฺฉูุฏ.", parse_mode=ParseMode.MARKDOWN)
    return SELECTING_RANGE

async def receive_range(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    starter_admin_id = context.chat_data.get('starter_admin_id')
    current_user_id = update.effective_user.id

    # ุงฺฏุฑ ฺฉุงุฑุจุฑ ฺฉู ูพุงู ุฏุงุฏูุ ููุงู ุงุฏูู ูุณุช ฺฉู ุจุงุฒ ุฑุง ุดุฑูุน ฺฉุฑุฏูุ ูพุงู ุฑุง ูุงุฏุฏู ุจฺฏุฑ
    if current_user_id != starter_admin_id:
        return SELECTING_RANGE # ุฏุฑ ููุงู ูุถุนุช ุจุงู ุจูุงู ู ูฺ ฺฉุงุฑ ูฺฉู
    # --- ูพุงุงู ุจุฎุด ุฌุฏุฏ ---
    chat = update.effective_chat
    try:
        min_str, max_str = convert_persian_to_english_numbers(update.message.text).split('-')
        min_range, max_range = int(min_str.strip()), int(max_str.strip())
        if min_range >= max_range: raise ValueError
    except:
        await update.message.reply_text("ูุฑูุช ุงุดุชุจุงู ุงุณุช. ูุทูุง ุจู ุงู ุตูุฑุช ูุงุฑุฏ ฺฉูุฏ: `ุนุฏุฏ ฺฉูฺฺฉ-ุนุฏุฏ ุจุฒุฑฺฏ`", parse_mode=ParseMode.MARKDOWN)
        return SELECTING_RANGE
    secret_number = random.randint(min_range, max_range)
    active_games['guess_number'][chat.id] = {"number": secret_number}
    await update.message.reply_text(f"๐ฒ **ุจุงุฒ ุญุฏุณ ุนุฏุฏ ุดุฑูุน ุดุฏ!** ๐ฒ\n\nฺฉ ุนุฏุฏ ุจู **{min_range}** ู **{max_range}** ุงูุชุฎุงุจ ุดุฏู.", parse_mode=ParseMode.MARKDOWN)
    return GUESSING

async def handle_guess_conversation(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    chat_id = update.effective_chat.id
    if chat_id not in active_games['guess_number']: return ConversationHandler.END
    guess = int(convert_persian_to_english_numbers(update.message.text))
    secret_number = active_games['guess_number'][chat_id]['number']
    user = update.effective_user
    if guess < secret_number: await update.message.reply_text("ุจุงูุงุชุฑ โฌ๏ธ")
    elif guess > secret_number: await update.message.reply_text("ูพุงูโุชุฑ โฌ๏ธ")
    else:
        await update.message.reply_text(f"๐ **ุชุจุฑฺฉ!** {user.mention_html()} ุจุฑูุฏู ุดุฏ! ๐\n\nุนุฏุฏ ุตุญุญ **{secret_number}** ุจูุฏ.", parse_mode=ParseMode.HTML)
        del active_games['guess_number'][chat_id]
        return ConversationHandler.END
    return GUESSING

async def cancel_game_conversation(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    if update.effective_chat.id in active_games['guess_number']: del active_games['guess_number'][update.effective_chat.id]
    await update.message.reply_text('ุจุงุฒ ุญุฏุณ ุนุฏุฏ ูุบู ุดุฏ.')
    # ุจุงุฒฺฏุดุช ุจู ูพูู ุงุตู
    await rsgame_command(update, context)
    return ConversationHandler.END

# --------------------------- GAME: DOOZ (TIC-TAC-TOE) - ##### ุจุงุฒููุณ ฺฉุงูู ##### ---------------------------
async def dooz_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    chat_id = query.message.chat_id

    # if await check_ban_status(update, context): return

    data = query.data.split('_')
    action = data[1]

    # --- ุจููฺฉ ฑ: ุดุฑูุน ุจุงุฒ ---
    if action == "start":
        try:
            target_user_id = int(data[-1])
            if user.id != target_user_id:
                await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
                return
        except (ValueError, IndexError):
            await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
            return

        if chat_id not in active_games['dooz']:
            active_games['dooz'][chat_id] = {}

        # ุงุฌุงุฏ ูพุงู ุฌุฏุฏ ุจุฑุง ุจุงุฒ
        sent_message = await query.message.reply_text("ุฏุฑ ุญุงู ุณุงุฎุช ุจุงุฒ ุฏูุฒ...")
        game_id = sent_message.message_id
        
        game = {
            "status": "joining",
            "players_info": [{'id': user.id, 'name': user.first_name, 'symbol': 'โ'}],
            "board": [[" "]*3 for _ in range(3)],
            "turn": None
        }
        active_games['dooz'][chat_id][game_id] = game
        
        keyboard = [[InlineKeyboardButton("ูพูุณุชู ุจู ุจุงุฒ (1/2)", callback_data=f"dooz_join_{game_id}")]]
        await sent_message.edit_text(
            f"ุจุงุฒ ุฏูุฒ ุชูุณุท {user.mention_html()} ุณุงุฎุชู ุดุฏ! ููุชุธุฑ ุญุฑู...\n\n( @RHINOSOUL_TM ุจุฑุง ูพูุณุชู ุจู ุจุงุฒุ ุจุงุฏ ุฏุฑ ฺฉุงูุงู ุนุถู ุจุงุดุฏ)", 
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode=ParseMode.HTML
        )
        
        # ุญุฐู ูพูู ุงุตู ุจุงุฒโูุง
        try:
            await query.message.delete()
        except Exception:
            pass
        return

    # --- ุจููฺฉ ฒ: ูุฏุฑุช ุณุงุฑ ุงฺฉุดูโูุง ุจุงุฒ ---
    try:
        game_id = int(data[2])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง ุฏุฑ ูพุฑุฏุงุฒุด ุฏุฑุฎูุงุณุช.", show_alert=True)
        return

    if chat_id not in active_games['dooz'] or game_id not in active_games['dooz'][chat_id]:
        await query.answer("ุงู ุจุงุฒ ุฏฺฏุฑ ูุนุงู ูุณุช.", show_alert=True)
        try:
            await query.edit_message_text("ุงู ุจุงุฒ ุชูุงู ุดุฏู ุง ูููุถ ุดุฏู ุงุณุช.")
        except:
            pass
        return
        
    game = active_games['dooz'][chat_id][game_id]

    # --- ุณุงุฎุชุงุฑ ุฌุฏุฏ ุจุง elif ---
    if action == "join":
        if not await check_join_for_alert(update, context): return

        if any(p['id'] == user.id for p in game['players_info']):
            await query.answer("ุดูุง ูุจูุงู ุจู ุจุงุฒ ูพูุณุชูโุงุฏ!", show_alert=True)
            return
        
        if len(game['players_info']) >= 2:
            await query.answer("ุธุฑูุช ุจุงุฒ ุชฺฉูู ุงุณุช.", show_alert=True)
            return
            await query.answer()
        game['players_info'].append({'id': user.id, 'name': user.first_name, 'symbol': 'โญ๏ธ'})
        game['status'] = 'playing'
        game['turn'] = game['players_info'][0]['id'] # ููุจุช ุจุง ุจุงุฒฺฉู ุงูู

        p1 = game['players_info'][0]
        p2 = game['players_info'][1]

        text = f"ุจุงุฒ ุดุฑูุน ุดุฏ!\n{p1['name']} ({p1['symbol']}) โ๏ธ {p2['name']} ({p2['symbol']})\n\nููุจุช {p1['name']} ุงุณุช."
        
        # ุณุงุฎุช ฺฉุจูุฑุฏ ุงููู ุจุงุฒ
        keyboard = [
            [InlineKeyboardButton(" ", callback_data=f"dooz_move_{game_id}_{r*3+c}") for c in range(3)] 
            for r in range(3)
        ]
        await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode=ParseMode.HTML)

    elif action == "move":
        if game['status'] != 'playing':
            await query.answer("ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.", show_alert=True)
            return
            
        if user.id not in [p['id'] for p in game['players_info']]:
            await query.answer("ุดูุง ุจุงุฒฺฉู ุงู ูุณุงุจูู ูุณุชุฏ!", show_alert=True)
            return
            
        if user.id != game['turn']:
            await query.answer("ููุจุช ุดูุง ูุณุช!", show_alert=True)
            return

        try:
            cell_index = int(data[3])
            row, col = divmod(cell_index, 3)
        except (ValueError, IndexError):
            return # ุฏุฑ ุตูุฑุช callback_data ุงุดุชุจุงูุ ฺฉุงุฑ ุงูุฌุงู ูุฏู

        if game['board'][row][col] != " ":
            await query.answer("ุงู ุฎุงูู ูพุฑ ุดุฏู ุงุณุช!", show_alert=True)
            return
        
        current_player = next(p for p in game['players_info'] if p['id'] == user.id)
        symbol = current_player['symbol']
        game['board'][row][col] = symbol
        
        # ุจุฑุฑุณ ูุถุนุช ุจุฑุฏ
        b = game['board']
        win = any(all(c==symbol for c in r) for r in b) or \
              any(all(b[r][c]==symbol for r in range(3)) for c in range(3)) or \
              all(b[i][i]==symbol for i in range(3)) or \
              all(b[i][2-i]==symbol for i in range(3))
        
        is_draw = all(c!=" " for r in b for c in r) and not win
        
        # ุณุงุฎุช ฺฉุจูุฑุฏ ุฌุฏุฏ ุจุฑ ุงุณุงุณ ูุถุนุช ูุนู ุตูุญู
        board_rows = [
            [InlineKeyboardButton(b[r][c], callback_data=f"dooz_move_{game_id}_{r*3+c}") for c in range(3)]
            for r in range(3)
        ]
        
        # ุงฺฏุฑ ุจุงุฒ ุชูุงู ุดุฏ
        if win or is_draw:
            text = f"ุจุงุฒ ูุณุงู ุดุฏ! ๐ค" if is_draw else f"ุจุงุฒ ุชูุงู ุดุฏ! ุจุฑูุฏู: {current_player['name']} ๐"
            game['status'] = 'finished' # ูุถุนุช ุจุงุฒ ุฑุง ุชุบุฑ ูโุฏูู
            
            # **ูฺฉุชู ฺฉูุฏ:** ฺฉุจูุฑุฏ ููุง ุฑุง ุจุง ุฏฺฉููโูุง ุบุฑูุนุงู ูโุณุงุฒู
            final_keyboard_rows = [
                [InlineKeyboardButton(b[r][c], callback_data=f"dooz_noop_{game_id}") for c in range(3)]
                for r in range(3)
            ]
            
            await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(final_keyboard_rows), parse_mode=ParseMode.HTML)
            # ุจุงุฒ ุฑุง ุงุฒ ูุณุช ุจุงุฒโูุง ูุนุงู ุญุฐู ูโฺฉูู
            del active_games['dooz'][chat_id][game_id]
        
        # ุงฺฏุฑ ุจุงุฒ ุงุฏุงูู ุฏุงุฑุฏ
        else:
            next_player = next(p for p in game['players_info'] if p['id'] != user.id)
            game['turn'] = next_player['id']
            text = f"ููุจุช {next_player['name']} ({next_player['symbol']}) ุงุณุช."
            await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(board_rows), parse_mode=ParseMode.HTML)

    elif action == "noop":
        # ุจุฑุง ุฏฺฉููโูุง ุบุฑูุนุงู ุฏุฑ ุงูุชูุง ุจุงุฒ
        await query.answer("ุงู ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.", show_alert=True)

# --------------------------- GAME: CONNECT FOUR (ุฌุฏุฏ) --------------------------
# --- ุชูุงุจุน ฺฉูฺฉ Connect Four (ููุทู ุงุตู ุจุฏูู ุชุบุฑ) ---

def check_connect4_winner(board, symbol):
    """ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ุจุงุฒฺฉู ุจุง ููุฑู 'symbol' ุจุฑูุฏู ุดุฏู ุงุณุช ุง ุฎุฑ."""
    ROWS, COLS = 6, 7
    # ุจุฑุฑุณ ุงูู
    for r in range(ROWS):
        for c in range(COLS - 3):
            if all(board[r][c+i] == symbol for i in range(4)):
                return True
    # ุจุฑุฑุณ ุนููุฏ
    for r in range(ROWS - 3):
        for c in range(COLS):
            if all(board[r+i][c] == symbol for i in range(4)):
                return True
    # ุจุฑุฑุณ ููุฑุจ (ูพุงู ุจู ุจุงูุง)
    for r in range(3, ROWS):
        for c in range(COLS - 3):
            if all(board[r-i][c+i] == symbol for i in range(4)):
                return True
    # ุจุฑุฑุณ ููุฑุจ (ุจุงูุง ุจู ูพุงู)
    for r in range(ROWS - 3):
        for c in range(COLS - 3):
            if all(board[r+i][c+i] == symbol for i in range(4)):
                return True
    return False

# --- ุชุงุจุน ุฑูุฏุฑ ุจูููโุณุงุฒ ุดุฏู ---

def render_connect4_board(game: dict, is_finished: bool = False):
    """ุตูุญู ุจุงุฒ ุฑุง ุจู ููุฑุงู ูุชู ู ุฏฺฉููโูุง ุชููุฏ ูโฺฉูุฏ."""
    game_id = game['game_id']
    board = game['board']
    
    # ุชุนู ูุชู ูพุงู ุจุฑ ุงุณุงุณ ูุถุนุช ุจุงุฒ
    if is_finished:
        p1 = game['players_info'][0]
        p2 = game['players_info'][1]
        text = f"ุจุงุฒ ุชูุงู ุดุฏ!\n{p1['name']} ({p1['symbol']}) โ๏ธ {p2['name']} ({p2['symbol']})"
    else:
        p1 = game['players_info'][0]
        p2 = game['players_info'][1]
        turn_player_id = game.get('turn')
        turn_player = next(p for p in game['players_info'] if p['id'] == turn_player_id)
        text = f"ุจุงุฒ ฺูุงุฑ ุฏุฑ ฺฉ ุฑุฏู\n{p1['name']} ({p1['symbol']}) โ๏ธ {p2['name']} ({p2['symbol']})\n\nููุจุช {turn_player['name']} ุงุณุช."

    # ุณุงุฎุช ฺฉุจูุฑุฏ
    keyboard = []
    for r in range(len(board)):
        row_buttons = []
        for c in range(len(board[0])):
            # ุงฺฏุฑ ุจุงุฒ ุชูุงู ุดุฏู ุจุงุดุฏุ ุฏฺฉููโูุง ุบุฑูุนุงู ูโุดููุฏ
            callback_action = "noop" if is_finished else "move"
            row_buttons.append(InlineKeyboardButton(board[r][c], callback_data=f"connect4_{callback_action}_{game_id}_{c}"))
        keyboard.append(row_buttons)
    
    return text, InlineKeyboardMarkup(keyboard)


# --- ุชุงุจุน ุงุตู ู ุงุตูุงุญ ุดุฏู Connect Four ---

async def connect4_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    chat_id = query.message.chat.id

    # if await check_ban_status(update, context): return
    
    data = query.data.split('_')
    action = data[1]

    # --- ุจููฺฉ ฑ: ุดุฑูุน ุจุงุฒ ---
    if action == "start":
        try:
            target_user_id = int(data[-1])
            if user.id != target_user_id:
                await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
                return
        except (ValueError, IndexError):
            await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
            return

        if chat_id not in active_games['connect4']:
            active_games['connect4'][chat_id] = {}

        sent_message = await query.message.reply_text("ุฏุฑ ุญุงู ุณุงุฎุช ุจุงุฒ ฺูุงุฑ ุฏุฑ ฺฉ ุฑุฏู...")
        game_id = sent_message.message_id
        
        game = {
            "game_id": game_id,
            "status": "joining",
            "players_info": [{'id': user.id, 'name': user.first_name, 'symbol': '๐ด'}],
            "board": [['โช๏ธ']*7 for _ in range(6)],
            "turn": None
        }
        active_games['connect4'][chat_id][game_id] = game
        
        text = f"ุจุงุฒ ฺูุงุฑ ุฏุฑ ฺฉ ุฑุฏู ุชูุณุท {user.mention_html()} ุณุงุฎุชู ุดุฏ! ููุชุธุฑ ุญุฑู...\n\n( @RHINOSOUL_TM ุจุฑุง ูพูุณุชู ุจู ุจุงุฒุ ุจุงุฏ ุฏุฑ ฺฉุงูุงู ุนุถู ุจุงุดุฏ)"
        keyboard = [[InlineKeyboardButton("ูพูุณุชู ุจู ุจุงุฒ (1/2)", callback_data=f"connect4_join_{game_id}")]]
        await sent_message.edit_text(
            text, 
            reply_markup=InlineKeyboardMarkup(keyboard), 
            parse_mode=ParseMode.HTML
        )
        
        try:
            await query.message.delete()
        except Exception:
            pass
        return

    # --- ุจููฺฉ ฒ: ูุฏุฑุช ุณุงุฑ ุงฺฉุดูโูุง ุจุงุฒ ---
    try:
        game_id = int(data[2])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง ุฏุฑ ูพุฑุฏุงุฒุด ุฏุฑุฎูุงุณุช.", show_alert=True)
        return

    if chat_id not in active_games['connect4'] or game_id not in active_games['connect4'][chat_id]:
        await query.answer("ุงู ุจุงุฒ ุฏฺฏุฑ ูุนุงู ูุณุช.", show_alert=True)
        try: await query.edit_message_text("ุงู ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.")
        except: pass
        return
        
    game = active_games['connect4'][chat_id][game_id]

    if action == "join":
        if not await check_join_for_alert(update, context): return

        if any(p['id'] == user.id for p in game['players_info']):
            await query.answer("ุดูุง ูุจูุงู ุจู ุจุงุฒ ูพูุณุชูโุงุฏ!", show_alert=True)
            return
        
        if len(game['players_info']) >= 2:
            await query.answer("ุธุฑูุช ุจุงุฒ ุชฺฉูู ุงุณุช.", show_alert=True)
            return
            await query.answer()
        game['players_info'].append({'id': user.id, 'name': user.first_name, 'symbol': '๐ก'})
        game['status'] = 'playing'
        game['turn'] = game['players_info'][0]['id']

        text, reply_markup = render_connect4_board(game)
        await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.HTML)

    elif action == "move":
        if game.get('status') != 'playing':
            await query.answer("ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.", show_alert=True)
            return

        if user.id not in [p['id'] for p in game['players_info']]:
            await query.answer("ุดูุง ุจุงุฒฺฉู ุงู ูุณุงุจูู ูุณุชุฏ!", show_alert=True)
            return
        
        if user.id != game.get('turn'):
            await query.answer("ููุจุช ุดูุง ูุณุช!", show_alert=True)
            return

        col_index = int(data[3])
        
        # ูพุฏุง ฺฉุฑุฏู ูพุงูโุชุฑู ุฎุงูู ุฎุงู ุฏุฑ ุณุชูู
        row_index = -1
        for r in range(5, -1, -1):
            if game['board'][r][col_index] == 'โช๏ธ':
                row_index = r
                break
        
        if row_index == -1:
            await query.answer("ุงู ุณุชูู ูพุฑ ุงุณุช!", show_alert=True)
            return
            
        current_player = next(p for p in game['players_info'] if p['id'] == user.id)
        symbol = current_player['symbol']
        game['board'][row_index][col_index] = symbol

        # ุจุฑุฑุณ ุจุฑูุฏู ุง ูุณุงู
        is_winner = check_connect4_winner(game['board'], symbol)
        is_draw = all(cell != 'โช๏ธ' for row in game['board'] for cell in row) and not is_winner

        if is_winner or is_draw:
            game['status'] = 'finished'
            text, reply_markup = render_connect4_board(game, is_finished=True)
            
            if is_winner:
                text += f"\n\n๐ ุจุฑูุฏู: {current_player['name']}"
            else:
                text += f"\n\n๐ค ุจุงุฒ ูุณุงู ุดุฏ!"

            await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.HTML)
            del active_games['connect4'][chat_id][game_id]
        else:
            # ุชุบุฑ ููุจุช
            next_player = next(p for p in game['players_info'] if p['id'] != user.id)
            game['turn'] = next_player['id']
            
            text, reply_markup = render_connect4_board(game)
            await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.HTML)

    elif action == "noop":
        await query.answer("ุงู ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.", show_alert=True)

# --------------------------- GAME: ROCK, PAPER, SCISSORS (ุฌุฏุฏ) ---------------------------

async def rps_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    chat_id = query.message.chat.id

    # if await check_ban_status(update, context): return
    
    data = query.data.split('_')
    action = data[1]

    # --- ุจููฺฉ ฑ: ุดุฑูุน ุจุงุฒ ---
    if action == "start":
        try:
            target_user_id = int(data[-1])
            if user.id != target_user_id:
                await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
                return
        except (ValueError, IndexError):
            await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
            return

        if chat_id not in active_games['rps']:
            active_games['rps'][chat_id] = {}
            
        sent_message = await query.message.reply_text("ุฏุฑ ุญุงู ุณุงุฎุช ุจุงุฒ ุณูฺฏุ ฺฉุงุบุฐุ ูฺ...")
        game_id = sent_message.message_id
        game = {
            "game_id": game_id, 
            "status": "joining",
            "players_info": [{'id': user.id, 'name': user.first_name}],
            "choices": {}
        }
        active_games['rps'][chat_id][game_id] = game
        
        text = f"ุจุงุฒ ุณูฺฏุ ฺฉุงุบุฐุ ูฺ ุชูุณุท {user.mention_html()} ุณุงุฎุชู ุดุฏ! ููุชุธุฑ ุญุฑู...\n\n( @RHINOSOUL_TM ุจุฑุง ูพูุณุชู ุจู ุจุงุฒุ ุจุงุฏ ุฏุฑ ฺฉุงูุงู ุนุถู ุจุงุดุฏ)"
        keyboard = [[InlineKeyboardButton("ูพูุณุชู ุจู ุจุงุฒ (1/2)", callback_data=f"rps_join_{game_id}")]]
        await sent_message.edit_text(text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode=ParseMode.HTML)
        
        try:
            await query.message.delete()
        except Exception:
            pass
        return

    # --- ุจููฺฉ ฒ: ูุฏุฑุช ุณุงุฑ ุงฺฉุดูโูุง ุจุงุฒ ---
    try:
        game_id = int(data[2])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง ุฏุฑ ูพุฑุฏุงุฒุด ุฏุฑุฎูุงุณุช.", show_alert=True)
        return

    if chat_id not in active_games['rps'] or game_id not in active_games['rps'][chat_id]:
        await query.answer("ุงู ุจุงุฒ ุฏฺฏุฑ ูุนุงู ูุณุช.", show_alert=True)
        try: await query.edit_message_text("ุงู ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.")
        except: pass
        return
        
    game = active_games['rps'][chat_id][game_id]

    if action == "join":
        if not await check_join_for_alert(update, context): return
        
        if any(p['id'] == user.id for p in game['players_info']):
            await query.answer("ุดูุง ูุจูุงู ุจู ุจุงุฒ ูพูุณุชูโุงุฏ!", show_alert=True)
            return
            
        if len(game['players_info']) >= 2:
            await query.answer("ุธุฑูุช ุจุงุฒ ุชฺฉูู ุงุณุช.", show_alert=True)
            return
            await query.answer()
        game['players_info'].append({'id': user.id, 'name': user.first_name})
        game['status'] = 'playing'
        
        p1_name = game['players_info'][0]['name']
        p2_name = game['players_info'][1]['name']
        
        text = f"ุจุงุฒ ุดุฑูุน ุดุฏ!\n\n{p1_name} โ๏ธ {p2_name}\n\nูุทูุง ุงูุชุฎุงุจ ุฎูุฏ ุฑุง ุงูุฌุงู ุฏูุฏ:"
        keyboard = [[
            InlineKeyboardButton("๐ชจ ุณูฺฏ", callback_data=f"rps_choose_{game_id}_rock"),
            InlineKeyboardButton("๐ ฺฉุงุบุฐ", callback_data=f"rps_choose_{game_id}_paper"),
            InlineKeyboardButton("โ๏ธ ูฺ", callback_data=f"rps_choose_{game_id}_scissors")
        ]]
        await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

    elif action == "choose":
        if game.get('status') != 'playing':
            await query.answer("ุจุงุฒ ูููุฒ ุดุฑูุน ูุดุฏู ุง ุชูุงู ุดุฏู ุงุณุช.", show_alert=True)
            return

        if user.id not in [p['id'] for p in game['players_info']]:
            await query.answer("ุดูุง ุจุงุฒฺฉู ุงู ูุณุงุจูู ูุณุชุฏ!", show_alert=True)
            return
            
        if user.id in game['choices']:
            await query.answer("ุดูุง ูุจูุงู ุงูุชุฎุงุจ ุฎูุฏ ุฑุง ุซุจุช ฺฉุฑุฏูโุงุฏ!", show_alert=True)
            return
        
        try:
            choice = data[3]
            game['choices'][user.id] = choice
            await query.answer(f"ุงูุชุฎุงุจ ุดูุง ุซุจุช ุดุฏ.")
        except IndexError:
            return # callback_data ูุงูุต ุงุณุช

        p1 = game['players_info'][0]
        p2 = game['players_info'][1]
        
        # ุงฺฏุฑ ูููุฒ ููุชุธุฑ ุงูุชุฎุงุจ ุจุงุฒฺฉู ุฏูู ูุณุชู
        if len(game['choices']) < 2:
            p1_status = "โ (ุงูุชุฎุงุจ ฺฉุฑุฏ)" if p1['id'] in game['choices'] else "๐ค (ููุชุธุฑ...)"
            p2_status = "โ (ุงูุชุฎุงุจ ฺฉุฑุฏ)" if p2['id'] in game['choices'] else "๐ค (ููุชุธุฑ...)"
            
            text = f"ุจุงุฒ ุฏุฑ ุฌุฑุงู ุงุณุช...\n\n{p1['name']}: {p1_status}\n{p2['name']}: {p2_status}\n\nููุชุธุฑ ุงูุชุฎุงุจ ุญุฑู..."
            
            keyboard = [[
                InlineKeyboardButton("๐ชจ ุณูฺฏ", callback_data=f"rps_choose_{game_id}_rock"),
                InlineKeyboardButton("๐ ฺฉุงุบุฐ", callback_data=f"rps_choose_{game_id}_paper"),
                InlineKeyboardButton("โ๏ธ ูฺ", callback_data=f"rps_choose_{game_id}_scissors")
            ]]
            await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard))

        # ุงฺฏุฑ ูุฑ ุฏู ุจุงุฒฺฉู ุงูุชุฎุงุจ ฺฉุฑุฏู ุจุงุดูุฏ
        else:
            p1_choice = game['choices'][p1['id']]
            p2_choice = game['choices'][p2['id']]
            symbols = {'rock': '๐ชจ', 'paper': '๐', 'scissors': 'โ๏ธ'}
            
            winner = None
            rules = {'rock': 'scissors', 'paper': 'rock', 'scissors': 'paper'}

            if rules[p1_choice] == p2_choice:
                winner = p1
            elif rules[p2_choice] == p1_choice:
                winner = p2
            
            # ุณุงุฎุช ูพุงู ููุง ุฏุฑ ฺฉ ูุฑุญูู
            final_text = (
                f"ูุชุงุฌ ุจุงุฒ:\n\n"
                f"{p1['name']}: {symbols[p1_choice]}\n"
                f"{p2['name']}: {symbols[p2_choice]}\n\n"
            )
            
            if winner:
                final_text += f"๐ **ุจุฑูุฏู: {winner['name']}**"
            else:
                final_text += "๐ค **ุจุงุฒ ูุณุงู ุดุฏ!**"

            # ูุฑุงุด ูพุงู ููุง ู ุญุฐู ุฏฺฉููโูุง
            await query.edit_message_text(final_text, reply_markup=None, parse_mode=ParseMode.MARKDOWN)
            del active_games['rps'][chat_id][game_id]

# --------------------------- GAME: MEMORY GAME (ุฌุฏุฏ) ---------------------------
# --- ูุณุช ุงููุฌโูุง (ุจุฏูู ุชุบุฑ) ---
MEMORY_EMOJIS = [
    "๐ฝ", "๐ฑ", "๐ญ", "๐น", "๐ฐ", "๐ฆ", "๐ป", "๐ผ", "๐จ", "๐ฏ", "๐ฆ", "๐ฎ", "๐ท", "๐ธ", "๐ต", "๐", "๐ง", "๐ฆ",
    "๐ค", "๐ฆ", "๐ฆ", "๐ฆ", "๐ฆ", "๐บ", "๐", "๐ด", "๐ฆ", "๐", "๐", "๐ฆ", "๐", "๐", "๐", "๐ฆ", "๐ฆ", "๐ท"
]

# --- ุชูุงุจุน ฺฉูฺฉ (ููุทู ุจุฏูู ุชุบุฑ) ---
def generate_memory_board(rows, cols):
    """ฺฉ ูุณุช ุฏุฑููโุฑุฎุชู ุงุฒ ุฌูุช ุงููุฌโูุง ุจุฑุง ุตูุญู ุจุงุฒ ุชููุฏ ูโฺฉูุฏ."""
    num_pairs = (rows * cols) // 2
    emojis_for_game = random.sample(MEMORY_EMOJIS, num_pairs)
    card_deck = emojis_for_game * 2
    random.shuffle(card_deck)
    
    board = []
    for i in range(rows):
        row = card_deck[i * cols : (i + 1) * cols]
        board.append(row)
    return board

async def render_memory_board(game: dict, is_finished: bool = False):
    """ุตูุญู ุจุงุฒ ุญุงูุธู ุฑุง ุจุฑุง ููุงุด ุจู ฺฉุงุฑุจุฑ ุฑูุฏุฑ ูโฺฉูุฏ."""
    game_id = game['game_id']
    p1 = game['players_info'][0]
    p2 = game['players_info'][1]

    if is_finished:
        text = (
            f"๐ง **ุจุงุฒ ุญุงูุธู**\n\n"
            f"**ุงูุชุงุฒ ููุง:**\n"
            f"๐ต {p1['name']}: {p1['score']}\n"
            f"๐ด {p2['name']}: {p2['score']}"
        )
    else:
        turn_player = next(p for p in game['players_info'] if p['id'] == game['turn'])
        text = (
            f"๐ง **ุจุงุฒ ุญุงูุธู**\n\n"
            f"**ุงูุชุงุฒูุง:**\n"
            f"๐ต {p1['name']}: {p1['score']}\n"
            f"๐ด {p2['name']}: {p2['score']}\n\n"
            f"**ููุจุช {turn_player['name']}** ุงุณุช."
        )
    
    board_view = game['board_view']
    keyboard = []
    for r, row_list in enumerate(board_view):
        row_buttons = []
        for c, cell_content in enumerate(row_list):
            callback_action = "noop" if is_finished else "flip"
            row_buttons.append(InlineKeyboardButton(cell_content, callback_data=f"memory_{callback_action}_{game_id}_{r}_{c}"))
        keyboard.append(row_buttons)
        
    return text, InlineKeyboardMarkup(keyboard)

# --- ุชุงุจุน ุงุตู ู ุจุงุฒููุณ ุดุฏู ---
async def memory_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    chat_id = query.message.chat.id

    # if await check_ban_status(update, context): return
    
    data = query.data.split('_')
    action = data[1]

    if action == "start":
        try:
            target_user_id = int(data[-1])
            if user.id != target_user_id:
                await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
                return
        except (ValueError, IndexError):
            await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
            return

        if chat_id not in active_games['memory']:
            active_games['memory'][chat_id] = {}

        size_str = data[2]
        rows, cols = map(int, size_str.split('x'))

        sent_message = await query.message.reply_text(f"ุฏุฑ ุญุงู ุณุงุฎุช ุจุงุฒ ุญุงูุธู ({size_str})...")
        game_id = sent_message.message_id
        
        game = {
            "game_id": game_id, "status": "joining",
            "players_info": [{'id': user.id, 'name': user.first_name, 'score': 0}],
            "board_solution": generate_memory_board(rows, cols),
            "board_view": [['โ'] * cols for _ in range(rows)],
            "turn": None,
            "first_card": None,
            "is_checking": False,  # << ููู: ููู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ฺฉูฺฉ ููุฒูุงู
            "matched_pairs": 0,
            "total_pairs": (rows * cols) // 2
        }
        active_games['memory'][chat_id][game_id] = game
        
        text = f"ุจุงุฒ ุญุงูุธู ({size_str}) ุชูุณุท {user.mention_html()} ุณุงุฎุชู ุดุฏ! ููุชุธุฑ ุญุฑู...\n\n( @RHINOSOUL_TM ุจุฑุง ูพูุณุชู ุจู ุจุงุฒุ ุนุถู ฺฉุงูุงู ุดูุฏ)"
        keyboard = [[InlineKeyboardButton("ูพูุณุชู ุจู ุจุงุฒ (1/2)", callback_data=f"memory_join_{game_id}")]]
        await sent_message.edit_text(text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode=ParseMode.HTML)
        
        try:
            await query.message.delete()
        except Exception: pass
        return

    try:
        game_id = int(data[2])
    except (ValueError, IndexError):
        return

    if chat_id not in active_games['memory'] or game_id not in active_games['memory'][chat_id]:
        await query.answer("ุงู ุจุงุฒ ุฏฺฏุฑ ูุนุงู ูุณุช.", show_alert=True)
        return
        
    game = active_games['memory'][chat_id][game_id]

    if action == "join":
        if not await check_join_for_alert(update, context): return
        if any(p['id'] == user.id for p in game['players_info']):
            return
        if len(game['players_info']) >= 2:
            return
            await query.answer()
        game['players_info'].append({'id': user.id, 'name': user.first_name, 'score': 0})
        game['status'] = 'playing'
        game['turn'] = game['players_info'][0]['id']

        text, reply_markup = await render_memory_board(game)
        await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)

    elif action == "flip":
        if game.get('is_checking', False):
            await query.answer("ูุทูุงู ุตุจุฑ ฺฉูุฏ...", show_alert=False)
            return
        
        if user.id != game.get('turn'):
            await query.answer("ููุจุช ุดูุง ูุณุช!", show_alert=True)
            return
        
        r, c = int(data[3]), int(data[4])
        
        if game['board_view'][r][c] != 'โ':
            await query.answer("ุงู ฺฉุงุฑุช ูุจูุงู ุงูุชุฎุงุจ ุดุฏู!", show_alert=True)
            return
            
        card_value = game['board_solution'][r][c]
        game['board_view'][r][c] = card_value

        if not game['first_card']:  # ุงููู ุงูุชุฎุงุจ ุฏุฑ ููุจุช
            game['first_card'] = {'r': r, 'c': c, 'val': card_value}
            text, reply_markup = await render_memory_board(game)
            await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
        
        else:  # ุฏููู ุงูุชุฎุงุจ ุฏุฑ ููุจุช
            game['is_checking'] = True  # << ูุนุงู ฺฉุฑุฏู ููู
            text, reply_markup = await render_memory_board(game)
            await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
            await asyncio.sleep(1.5)
            
            first_card = game['first_card']
            
            # ุงฺฏุฑ ุฌูุช ุฏุฑุณุช ุจูุฏ
            if card_value == first_card['val'] and (r,c) != (first_card['r'], first_card['c']):
                game['matched_pairs'] += 1
                current_player = next(p for p in game['players_info'] if p['id'] == game['turn'])
                current_player['score'] += 1
                # ููุจุช ุนูุถ ููโุดูุฏ
            
            # ุงฺฏุฑ ุฌูุช ุงุดุชุจุงู ุจูุฏ
            else:
                game['board_view'][r][c] = 'โ'
                game['board_view'][first_card['r']][first_card['c']] = 'โ'
                # ุชุบุฑ ููุจุช
                current_turn_id = game['turn']
                next_player = next(p for p in game['players_info'] if p['id'] != current_turn_id)
                game['turn'] = next_player['id']
            
            game['first_card'] = None
            game['is_checking'] = False # << ุขุฒุงุฏ ฺฉุฑุฏู ููู

            # ฺฺฉ ฺฉุฑุฏู ูพุงุงู ุจุงุฒ
            if game['matched_pairs'] == game['total_pairs']:
                p1 = game['players_info'][0]
                p2 = game['players_info'][1]
                
                if p1['score'] > p2['score']: winner = p1
                elif p2['score'] > p1['score']: winner = p2
                else: winner = None
                
                text, reply_markup = await render_memory_board(game, is_finished=True)
                
                if winner:
                    text += f"\n\n๐ **ุจุฑูุฏู ููุง: {winner['name']}**"
                else:
                    text += "\n\n๐ค ุจุงุฒ **ูุณุงู** ุดุฏ!"
                
                await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
                del active_games['memory'][chat_id][game_id]
            else:
                # ุขูพุฏุช ุตูุญู ุจุฑุง ููุจุช ุจุนุฏ ุง ุฌุงุฒู
                text, reply_markup = await render_memory_board(game)
                await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
    
    elif action == "noop":
        await query.answer("ุงู ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.", show_alert=True)

# =========================== SAMEGAME CODE (START) ==========================
# --- ุชูุงุจุน ฺฉูฺฉ SameGame ---

def create_samegame_board():
    """ฺฉ ุตูุญู ุจุงุฒ ุชุตุงุฏู ุจุฑุง ุจุงุฒ ุฌูุชโูุง ุงุฌุงุฏ ูโฺฉูุฏ."""
    return [[random.choice(SAMEGAME_COLORS) for _ in range(SAMEGAME_WIDTH)] for _ in range(SAMEGAME_HEIGHT)]

def find_samegame_group(board, r_start, c_start):
    """ุชูุงู ุจููฺฉโูุง ููุฑูฺฏ ู ูุชุตู ุฑุง ูพุฏุง ูโฺฉูุฏ."""
    target_color = board[r_start][c_start]
    if target_color == EMPTY_CELL:
        return []

    q = [(r_start, c_start)]
    group = set(q)
    
    while q:
        r, c = q.pop(0)
        for dr, dc in [(0, 1), (0, -1), (1, 0), (-1, 0)]:
            nr, nc = r + dr, c + dc
            if (0 <= nr < SAMEGAME_HEIGHT and 0 <= nc < SAMEGAME_WIDTH and
                    board[nr][nc] == target_color and (nr, nc) not in group):
                group.add((nr, nc))
                q.append((nr, nc))
    return list(group)

# --- ุชุงุจุน ุจุงุฒููุณ ุดุฏู ุจุฑุง ูพุฑ ฺฉุฑุฏู ุชุตุงุฏู ---
def refill_samegame_board_randomly(board):
    """ุฎุงููโูุง ุฎุงู ุฑุง ุจุง ุจููฺฉโูุง ุฑูฺฏ ุชุตุงุฏู ุฌุฏุฏ ูพุฑ ูโฺฉูุฏ."""
    for r in range(SAMEGAME_HEIGHT):
        for c in range(SAMEGAME_WIDTH):
            if board[r][c] == EMPTY_CELL:
                board[r][c] = random.choice(SAMEGAME_COLORS)
    return board

def is_game_over_samegame(board):
    """ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ุญุฑฺฉุช ุจุงู ูุงูุฏู ุงุณุช ุง ุฎุฑ."""
    for r in range(SAMEGAME_HEIGHT):
        for c in range(SAMEGAME_WIDTH):
            if board[r][c] != EMPTY_CELL:
                if c + 1 < SAMEGAME_WIDTH and board[r][c] == board[r][c+1]:
                    return False
                if r + 1 < SAMEGAME_HEIGHT and board[r][c] == board[r+1][c]:
                    return False
    return True

async def render_samegame_board(game, is_finished=False):
    """ุตูุญู ุจุงุฒ ุฌูุชโูุง ุฑุง ุจุฑุง ููุงุด ุจู ฺฉุงุฑุจุฑ ุฑูุฏุฑ ูโฺฉูุฏ."""
    game_id = game['game_id']
    board = game['board']
    score = game['score']
    
    text = f"โจ **ุจุงุฒ ุฌูุชโูุง (ุจโูพุงุงู)**\nุงูุชุงุฒ: **{score}**"
    
    if is_finished:
        text += f"\n\nโ๏ธ **ุญุฑฺฉุช ุฏฺฏุฑ ุจุงู ููุงูุฏู! ุจุงุฒ ุชูุงู ุดุฏ.**"
        # ุฑูุฏุฑ ฺฉุฑุฏู ุจูุฑุฏ ููุง ุจุฏูู ุฏฺฉูู
        keyboard = []
        for r in range(SAMEGAME_HEIGHT):
            row_buttons = [InlineKeyboardButton(board[r][c], callback_data=f"samegame_noop_{game_id}") for c in range(SAMEGAME_WIDTH)]
            keyboard.append(row_buttons)
        return text, InlineKeyboardMarkup(keyboard)

    keyboard = []
    for r in range(SAMEGAME_HEIGHT):
        row_buttons = [InlineKeyboardButton(board[r][c], callback_data=f"samegame_click_{game_id}_{r}_{c}") for c in range(SAMEGAME_WIDTH)]
        keyboard.append(row_buttons)
        
    keyboard.append([InlineKeyboardButton("โ๏ธ ุจุณุชู ุจุงุฒ", callback_data=f"samegame_close_{game_id}")])
    
    return text, InlineKeyboardMarkup(keyboard)

# --- ุชุงุจุน ุงุตู ู ุจุงุฒููุณ ุดุฏู SameGame ---
async def samegame_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    chat_id = query.message.chat.id

    data = query.data.split('_')
    action = data[1]

    if action == "start":
        # ฑ. ูพุงุณุฎ ุจู ฺฉูฺฉ ฺฉุงุฑุจุฑ ุงุถุงูู ุดุฏ

        try:
            target_user_id = int(data[-1])
            if user.id != target_user_id:
                await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
                return
        except (ValueError, IndexError):
            await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
            return

        if chat_id not in active_games['samegame']:
            active_games['samegame'][chat_id] = {}
            
        if any(g['player_id'] == user.id for g in active_games['samegame'].get(chat_id, {}).values()):
            await query.answer("ุดูุง ุงุฒ ูุจู ฺฉ ุจุงุฒ ูุนุงู ุฏุงุฑุฏ.", show_alert=True)
            return
            await query.answer()
        sent_message = await query.message.reply_text("ุฏุฑ ุญุงู ุณุงุฎุช ุจุงุฒ ุฌูุชโูุง...")
        game_id = sent_message.message_id
        
        game = { "game_id": game_id, "player_id": user.id, "board": create_samegame_board(), "score": 0 }
        active_games['samegame'][chat_id][game_id] = game
        
        text, reply_markup = await render_samegame_board(game)
        await sent_message.edit_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
        
        try: 
            await query.message.delete()
        except Exception: 
            pass
        return

    try:
        game_id = int(data[2])
    except (ValueError, IndexError):
        return

    if chat_id not in active_games['samegame'] or game_id not in active_games['samegame'][chat_id]:
        await query.answer("ุงู ุจุงุฒ ุฏฺฏุฑ ูุนุงู ูุณุช.", show_alert=True)
        return
        
    game = active_games['samegame'][chat_id][game_id]

    if user.id != game.get('player_id'):
        await query.answer("ุงู ุจุงุฒ ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
        return
        
    if action == "click":
        try:
            r, c = int(data[3]), int(data[4])
        except (ValueError, IndexError):
            return

        group = find_samegame_group(game['board'], r, c)
        
        if len(group) < 2:
            await query.answer("ุจุงุฏ ุญุฏุงูู ุฏู ุจููฺฉ ููุฑูฺฏ ฺฉูุงุฑ ูู ุจุงุดูุฏ!", show_alert=True)
            return

        await query.answer()
        
        score_increment = len(group)
        game['score'] += score_increment
        
        for row, col in group:
            game['board'][row][col] = EMPTY_CELL
        
        game['board'] = refill_samegame_board_randomly(game['board'])

        if is_game_over_samegame(game['board']):
            text, reply_markup = await render_samegame_board(game, is_finished=True)
            await query.edit_message_text(text=text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
            del active_games['samegame'][chat_id][game_id]
        else:
            text, reply_markup = await render_samegame_board(game)
            await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)

    elif action == "close":
        await query.edit_message_text("ุจุงุฒ ุฌูุชโูุง ุจุณุชู ุดุฏ.")
        del active_games['samegame'][chat_id][game_id]
        
    elif action == "noop":
        await query.answer("ุงู ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.", show_alert=True)
        
# ============================ SAMEGAME CODE (END) ============================
# ======================== SLIDING PUZZLE CODE (START) - v2 =========================

# --- ุซุงุจุชโูุง ูพุงุฒู ฺฉุดู ---
SPUZZLE_SIZE = 4

# --- ุชูุงุจุน ฺฉูฺฉ ูพุงุฒู (ููุทู ุงุตู ุจุฏูู ุชุบุฑ) ---

def create_solvable_spuzzle():
    """ฺฉ ูพุงุฒู ุฏุฑููโุฑุฎุชู ุงูุง ูุงุจู ุญู ุงุฌุงุฏ ูโฺฉูุฏ."""
    board = list(range(1, SPUZZLE_SIZE * SPUZZLE_SIZE)) + [0]
    
    flat_board = list(board)
    empty_pos = len(flat_board) - 1
    
    for _ in range(300): # ุชุนุฏุงุฏ ุญุฑฺฉุงุช ุจุฑุง ุฏุฑููโุฑุฎุชู
        moves = []
        if empty_pos < SPUZZLE_SIZE * (SPUZZLE_SIZE - 1): moves.append('up')
        if empty_pos >= SPUZZLE_SIZE: moves.append('down')
        if empty_pos % SPUZZLE_SIZE < SPUZZLE_SIZE - 1: moves.append('left')
        if empty_pos % SPUZZLE_SIZE > 0: moves.append('right')
        
        move = random.choice(moves)
        
        if move == 'up':
            swap_with = empty_pos + SPUZZLE_SIZE
        elif move == 'down':
            swap_with = empty_pos - SPUZZLE_SIZE
        elif move == 'left':
            swap_with = empty_pos + 1
        else: # right
            swap_with = empty_pos - 1
            
        flat_board[empty_pos], flat_board[swap_with] = flat_board[swap_with], flat_board[empty_pos]
        empty_pos = swap_with

    return [flat_board[i:i+SPUZZLE_SIZE] for i in range(0, len(flat_board), SPUZZLE_SIZE)]


def is_spuzzle_solved(board):
    """ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ูพุงุฒู ุญู ุดุฏู ุงุณุช ุง ุฎุฑ."""
    solved_board = list(range(1, SPUZZLE_SIZE * SPUZZLE_SIZE)) + [0]
    current_flat_board = [cell for row in board for cell in row]
    return solved_board == current_flat_board

async def render_spuzzle(game):
    """ุตูุญู ูพุงุฒู ฺฉุดู ุฑุง ุฑูุฏุฑ ูโฺฉูุฏ."""
    game_id = game['game_id']
    board = game['board']
    
    text = "๐ข **ูพุงุฒู ฺฉุดู**\n\nุงุนุฏุงุฏ ุฑุง ูุฑุชุจ ฺฉูุฏ:"
    
    keyboard = []
    for r in range(SPUZZLE_SIZE):
        row_buttons = []
        for c in range(SPUZZLE_SIZE):
            cell = board[r][c]
            text_cell = str(cell) if cell != 0 else " "
            row_buttons.append(InlineKeyboardButton(text_cell, callback_data=f"spuzzle_noop_{game_id}"))
        keyboard.append(row_buttons)
        
    keyboard.append([InlineKeyboardButton("โฌ๏ธ", callback_data=f"spuzzle_move_{game_id}_up")])
    keyboard.append([
        InlineKeyboardButton("โฌ๏ธ", callback_data=f"spuzzle_move_{game_id}_left"),
        InlineKeyboardButton("โฌ๏ธ", callback_data=f"spuzzle_move_{game_id}_down"),
        InlineKeyboardButton("โก๏ธ", callback_data=f"spuzzle_move_{game_id}_right")
    ])
    keyboard.append([InlineKeyboardButton("โ๏ธ ุจุณุชู ุจุงุฒ", callback_data=f"spuzzle_close_{game_id}")])
    
    return text, InlineKeyboardMarkup(keyboard)

# --- ุชุงุจุน ุงุตู ู ุจุงุฒููุณ ุดุฏู ูพุงุฒู ---
async def spuzzle_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    user = query.from_user
    chat_id = query.message.chat.id

    data = query.data.split('_')
    action = data[1]

    if action == "start":
        try:
            target_user_id = int(data[-1])
            if user.id != target_user_id:
                await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
                return
        except (ValueError, IndexError):
            await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
            return

        if chat_id not in active_games['spuzzle']:
            active_games['spuzzle'][chat_id] = {}
        
        if any(g['player_id'] == user.id for g in active_games['spuzzle'].get(chat_id, {}).values()):
            await query.answer("ุดูุง ุงุฒ ูุจู ฺฉ ูพุงุฒู ูุนุงู ุฏุงุฑุฏ.", show_alert=True)
            return

        sent_message = await query.message.reply_text("ุฏุฑ ุญุงู ุณุงุฎุช ูพุงุฒู ฺฉุดู...")
        game_id = sent_message.message_id
        
        game = {
            "game_id": game_id, "player_id": user.id,
            "board": create_solvable_spuzzle(),
            "start_time": time.time(),
            "is_busy": False
        }
        active_games['spuzzle'][chat_id][game_id] = game
        
        text, reply_markup = await render_spuzzle(game)
        await sent_message.edit_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
        
        try:
            await query.message.delete()
        except Exception:
            pass
        return

    try:
        game_id = int(data[2])
    except (ValueError, IndexError):
        return

    if chat_id not in active_games['spuzzle'] or game_id not in active_games['spuzzle'][chat_id]:
        await query.answer("ุงู ุจุงุฒ ุฏฺฏุฑ ูุนุงู ูุณุช.", show_alert=True)
        return
        
    game = active_games['spuzzle'][chat_id][game_id]

    if user.id != game.get('player_id'):
        await query.answer("ุงู ุจุงุฒ ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
        return

    if game.get('is_busy', False):
        return

    if action == "move":
        game['is_busy'] = True
        try:
            direction = data[3]
            board = game['board']
            empty_r, empty_c = -1, -1
            for r_idx, row in enumerate(board):
                if 0 in row:
                    empty_r, empty_c = r_idx, row.index(0)
                    break

            tile_r, tile_c = empty_r, empty_c
            if direction == 'up': tile_r += 1
            elif direction == 'down': tile_r -= 1
            elif direction == 'left': tile_c += 1
            elif direction == 'right': tile_c -= 1
            
            if 0 <= tile_r < SPUZZLE_SIZE and 0 <= tile_c < SPUZZLE_SIZE:
                board[empty_r][empty_c], board[tile_r][tile_c] = board[tile_r][tile_c], board[empty_r][empty_c]

                if is_spuzzle_solved(board):
                    duration = time.time() - game['start_time']
                    
                    final_text = (
                        f"๐ **ุชุจุฑฺฉ {user.mention_html()}!** ๐\n\n"
                        f"ุดูุง ูพุงุฒู ุฑุง ุฏุฑ ุฒูุงู **{int(duration)} ุซุงูู** ุญู ฺฉุฑุฏุฏ!"
                    )
                    
                    final_board_text, _ = await render_spuzzle(game)
                    
                    await query.edit_message_text(
                        f"{final_board_text}\n\n{final_text}",
                        reply_markup=None,
                        parse_mode=ParseMode.HTML
                    )
                    del active_games['spuzzle'][chat_id][game_id]
                    return
                
                text, reply_markup = await render_spuzzle(game)
                await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
            else:
                await query.answer("ุญุฑฺฉุช ุบุฑูุฌุงุฒ!")
        finally:
            if chat_id in active_games['spuzzle'] and game_id in active_games['spuzzle'][chat_id]:
                active_games['spuzzle'][chat_id][game_id]['is_busy'] = False

    elif action == "close":
        await query.edit_message_text("ูพุงุฒู ฺฉุดู ุจุณุชู ุดุฏ.")
        del active_games['spuzzle'][chat_id][game_id]

    elif action == "noop":
        pass

# ========================= SLIDING PUZZLE CODE (END) - v2 ==========================
# ======================== 4-PLAYER DOZ CODE (START) =========================

# --- ุซุงุจุชโูุง ุฏูุฒ ฺูุงุฑ ููุฑู ---
DOZ4P_SIZE = 10
DOZ4P_SYMBOLS = ["๐ด", "๐ต", "๐ข", "๐ก"]

# --- ุชูุงุจุน ฺฉูฺฉ (ููุทู ุงุตู ุจุฏูู ุชุบุฑ) ---

def check_doz4p_winner(board, symbol):
    """ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ุจุงุฒฺฉู ุจุง ููุงุฏ 'symbol' ุจุฑูุฏู ุดุฏู ุงุณุช (ด ููุฑู ุฏุฑ ฺฉ ุฑุฏู)."""
    # ุจุฑุฑุณ ุงูู
    for r in range(DOZ4P_SIZE):
        for c in range(DOZ4P_SIZE - 3):
            if all(board[r][c+i] == symbol for i in range(4)):
                return True
    # ุจุฑุฑุณ ุนููุฏ
    for r in range(DOZ4P_SIZE - 3):
        for c in range(DOZ4P_SIZE):
            if all(board[r+i][c] == symbol for i in range(4)):
                return True
    # ุจุฑุฑุณ ููุฑุจ (ูพุงู ุจู ุจุงูุง)
    for r in range(3, DOZ4P_SIZE):
        for c in range(DOZ4P_SIZE - 3):
            if all(board[r-i][c+i] == symbol for i in range(4)):
                return True
    # ุจุฑุฑุณ ููุฑุจ (ุจุงูุง ุจู ูพุงู)
    for r in range(DOZ4P_SIZE - 3):
        for c in range(DOZ4P_SIZE - 3):
            if all(board[r+i][c+i] == symbol for i in range(4)):
                return True
    return False

# --- ุชุงุจุน ุฑูุฏุฑ ุจูููโุณุงุฒ ุดุฏู ---

async def render_doz4p_board(game, is_finished=False):
    """ุตูุญู ุจุงุฒ ุฏูุฒ ฺูุงุฑ ููุฑู ุฑุง ุฑูุฏุฑ ูโฺฉูุฏ."""
    game_id = game['game_id']
    board = game['board']
    player_list = "\n".join(f"{p['symbol']} {p['name']}" for p in game['players_info'])

    if is_finished:
        text = f"๐ **ุฏูุฒ ฺูุงุฑ ููุฑู (ุชูุงู ุดุฏ)**\n\n{player_list}"
    else:
        turn_player = game['players_info'][game['turn_index']]
        text = f"๐ **ุฏูุฒ ฺูุงุฑ ููุฑู**\n\n{player_list}\n\nููุจุช: {turn_player['symbol']} {turn_player['name']}"
    
    keyboard = []
    for r in range(DOZ4P_SIZE):
        row_buttons = []
        for c in range(DOZ4P_SIZE):
            callback_action = "noop" if is_finished else "move"
            row_buttons.append(InlineKeyboardButton(board[r][c], callback_data=f"doz4p_{callback_action}_{game_id}_{r}_{c}"))
        keyboard.append(row_buttons)
        
    return text, InlineKeyboardMarkup(keyboard)

# --- ุชุงุจุน ุงุตู ู ุจุงุฒููุณ ุดุฏู ุฏูุฒ ด ููุฑู ---

async def doz4p_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    chat_id = query.message.chat.id

    # if await check_ban_status(update, context): return
    
    data = query.data.split('_')
    action = data[1]

    if action == "start":
        # << ุงููุช: ุจุฑุฑุณ ูุงูฺฉุช ูพูู >>
        try:
            target_user_id = int(data[-1])
            if user.id != target_user_id:
                await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
                return
        except (ValueError, IndexError):
            await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
            return

        if chat_id not in active_games['doz4p']:
            active_games['doz4p'] = {chat_id: {}}
        
        sent_message = await query.message.reply_text("ุฏุฑ ุญุงู ุณุงุฎุช ุจุงุฒ ุฏูุฒ ฺูุงุฑ ููุฑู...")
        game_id = sent_message.message_id
        
        game = {
            "game_id": game_id, "status": "joining",
            "players_info": [{'id': user.id, 'name': user.first_name, 'symbol': DOZ4P_SYMBOLS[0]}],
            "board": [['โช๏ธ'] * DOZ4P_SIZE for _ in range(DOZ4P_SIZE)],
            "turn_index": 0
        }
        active_games['doz4p'][chat_id][game_id] = game
        
        text = f"ุจุงุฒ ุฏูุฒ ฺูุงุฑ ููุฑู ุชูุณุท {user.mention_html()} ุณุงุฎุชู ุดุฏ! (1/4)\n\n( @RHINOSOUL_TM ุจุฑุง ูพูุณุชู ุจู ุจุงุฒุ ุจุงุฏ ุฏุฑ ฺฉุงูุงู ุนุถู ุจุงุดุฏ)"
        keyboard = [[InlineKeyboardButton("ูพูุณุชู ุจู ุจุงุฒ", callback_data=f"doz4p_join_{game_id}")]]
        await sent_message.edit_text(text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode=ParseMode.HTML)
        
        try:
            await query.message.delete()
        except Exception:
            pass
        return

    try:
        game_id = int(data[2])
    except (ValueError, IndexError):
        return

    if chat_id not in active_games['doz4p'] or game_id not in active_games['doz4p'][chat_id]:
        await query.answer("ุงู ุจุงุฒ ุฏฺฏุฑ ูุนุงู ูุณุช.", show_alert=True)
        return
        
    game = active_games['doz4p'][chat_id][game_id]

    if action == "join":
        if not await check_join_for_alert(update, context):
            return

        if any(p['id'] == user.id for p in game['players_info']):
            await query.answer("ุดูุง ูุจูุงู ุจู ุจุงุฒ ูพูุณุชูโุงุฏ!", show_alert=True)
            return
        
        num_players = len(game['players_info'])
        if num_players >= 4:
            await query.answer("ุธุฑูุช ุจุงุฒ ุชฺฉูู ุงุณุช.", show_alert=True)
            return
            await query.answer()
        game['players_info'].append({'id': user.id, 'name': user.first_name, 'symbol': DOZ4P_SYMBOLS[num_players]})
        
        if num_players + 1 < 4:
            player_names = "ุ ".join([p['name'] for p in game['players_info']])
            text = f"ุจุงุฒ ุฏูุฒ ฺูุงุฑ ููุฑู ({num_players + 1}/4)\n\nุจุงุฒฺฉูุงู ูุนู: {player_names}\n\n( @RHINOSOUL_TM ุจุฑุง ูพูุณุชู ุจู ุจุงุฒุ ุจุงุฏ ุฏุฑ ฺฉุงูุงู ุนุถู ุจุงุดุฏ)"
            keyboard = [[InlineKeyboardButton("ูพูุณุชู ุจู ุจุงุฒ", callback_data=f"doz4p_join_{game_id}")]]
            await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode=ParseMode.HTML)
        else:
            game['status'] = 'playing'
            text, reply_markup = await render_doz4p_board(game)
            await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)

    elif action == "move":
        if game.get('status') != 'playing':
            await query.answer("ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.", show_alert=True)
            return

        turn_player = game['players_info'][game['turn_index']]
        if user.id != turn_player['id']:
            await query.answer("ููุจุช ุดูุง ูุณุช!", show_alert=True)
            return
        
        r, c = int(data[3]), int(data[4])
        if game['board'][r][c] != 'โช๏ธ':
            await query.answer("ุงู ุฎุงูู ูพุฑ ุงุณุช!", show_alert=True)
            return
        
        symbol = turn_player['symbol']
        game['board'][r][c] = symbol

        is_winner = check_doz4p_winner(game['board'], symbol)
        is_draw = all(cell != 'โช๏ธ' for row in game['board'] for cell in row) and not is_winner

        if is_winner or is_draw:
            game['status'] = 'finished'
            text, reply_markup = await render_doz4p_board(game, is_finished=True)
            
            if is_winner:
                text += f"\n\n๐ ุจุฑูุฏู: {turn_player['symbol']} {turn_player['name']}"
            else:
                text += "\n\n๐ค ุจุงุฒ ูุณุงู ุดุฏ!"
            
            await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)
            del active_games['doz4p'][chat_id][game_id]
        else:
            game['turn_index'] = (game['turn_index'] + 1) % 4
            text, reply_markup = await render_doz4p_board(game)
            await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.MARKDOWN)

    elif action == "noop":
        await query.answer("ุงู ุจุงุฒ ุชูุงู ุดุฏู ุงุณุช.", show_alert=True)

# ======================== GARDONE SHANS (START) =========================

async def render_gardone_board(game: dict):
    """ุตูุญู ฺฏุฑุฏููู ุดุงูุณ ุฑุง ุจุง ูุณุช ุดุฑฺฉุชโฺฉููุฏฺฏุงู ู ุฏฺฉููโูุง ูโุณุงุฒุฏ."""
    game_id = game['game_id']
    starter_admin_id = game['starter_admin_id']
    participants = game['participants']
    
    participant_list = "ูููุฒ ฺฉุณ ุซุจุช ูุงู ูฺฉุฑุฏู ุงุณุช."
    if participants:
        # ูุณุช ุดุฑฺฉุชโฺฉููุฏฺฏุงู ุฑุง ุจุง ููุดู ฺฉุฑุฏู ูุงูุดุงู ูโุณุงุฒู
        participant_list = "\n".join([f"๐ค {p['name']}" for p in participants])

    text = f"๐ก **ฺฏุฑุฏููู ุดุงูุณ ูุนุงู ุงุณุช!** ๐ก\n\n" \
           f"ุจุฑุง ุดุฑฺฉุช ุฏุฑ ูุฑุนูโฺฉุด ุฑู ุฏฺฉูู ยซูพูุณุชูยป ฺฉูฺฉ ฺฉูุฏ.\n\n" \
           f"**ูุณุช ุดุฑฺฉุชโฺฉููุฏฺฏุงู ({len(participants)} ููุฑ):**\n" \
           f"{participant_list}"

    keyboard = [
        [InlineKeyboardButton("โ ูพูุณุชู ุจู ฺฏุฑุฏููู", callback_data=f"gardone_join_{game_id}")],
        [InlineKeyboardButton("๐ฐ ฺุฑุฎุงูุฏู ฺฏุฑุฏููู", callback_data=f"gardone_spin_{game_id}_{starter_admin_id}")],
        [InlineKeyboardButton("โ ูุบู ฺฏุฑุฏููู", callback_data=f"gardone_cancel_{game_id}_{starter_admin_id}")],
    ]
    return text, InlineKeyboardMarkup(keyboard)

async def gardone_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    chat_id = query.message.chat.id
    
    data = query.data.split('_')
    action = data[1]

    if action == "start":
        await query.answer()
        
        # ุจุฑุฑุณ ูุงูฺฉุช ูพูู
        try:
            target_user_id = int(data[-1])
            if user.id != target_user_id:
                await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
                return
        except (ValueError, IndexError):
            return

        # ุจุฑุฑุณ ุงูฺฉู ฺฉุงุฑุจุฑ ุงุฏูู ุงุณุช
        if not await is_group_admin(user.id, chat_id, context):
            await query.answer("ุงู ุจุฎุด ููุท ุจุฑุง ูุฏุฑุงู ฺฏุฑูู ุงุณุช.", show_alert=True)
            return

        # ุฌููฺฏุฑ ุงุฒ ุดุฑูุน ฺูุฏ ฺฏุฑุฏููู ููุฒูุงู ุฏุฑ ฺฉ ฺฏุฑูู
        if chat_id in active_games['gardone']:
            await query.answer("ฺฉ ฺฏุฑุฏููู ุดุงูุณ ุฏุฑ ุงู ฺฏุฑูู ูุนุงู ุงุณุช.", show_alert=True)
            return
            
        sent_message = await query.message.reply_text("ุฏุฑ ุญุงู ุขูุงุฏูโุณุงุฒ ฺฏุฑุฏููู ุดุงูุณ...")
        game_id = sent_message.message_id
        
        game = {
            "game_id": game_id,
            "starter_admin_id": user.id, # ุดูุงุณู ุงุฏูู ฺฉู ุจุงุฒ ุฑุง ุณุงุฎุชู
            "participants": [] # ูุณุช ุฎุงู ุจุฑุง ุดุฑฺฉุชโฺฉููุฏฺฏุงู
        }
        active_games['gardone'][chat_id] = game
        
        text, reply_markup = await render_gardone_board(game)
        await sent_message.edit_text(text, reply_markup=reply_markup, parse_mode=ParseMode.HTML)
        
        try:
            await query.message.delete()
        except Exception:
            pass
        return

    # ุงุณุชุฎุฑุงุฌ game_id ุงุฒ callback_data ุจุฑุง ุงฺฉุดูโูุง ุฏฺฏุฑ
    try:
        game_id = int(data[2])
    except (ValueError, IndexError):
        return

    if chat_id not in active_games['gardone'] or active_games['gardone'][chat_id]['game_id'] != game_id:
        await query.answer("ุงู ฺฏุฑุฏููู ุดุงูุณ ุฏฺฏุฑ ูุนุงู ูุณุช.", show_alert=True)
        return
        
    game = active_games['gardone'][chat_id]

    if action == "join":
        # ฑ. ุงุจุชุฏุง ุนุถูุช ุฏุฑ ฺฉุงูุงู ุฑุง ฺฺฉ ูโฺฉูู
        if not await check_join_for_alert(update, context):
            return # ุงฺฏุฑ ุนุถู ูุจุงุดุฏุ ุชุงุจุน ฺฺฉ ุฎูุฏุด ูุดุฏุงุฑ ูโุฏูุฏ ู ุฎุงุฑุฌ ูโุดูุฏ

        # ฒ. ฺฺฉ ูโฺฉูู ฺฉู ฺฉุงุฑุจุฑ ูุจูุงู ููพูุณุชู ุจุงุดุฏ
        if any(p['id'] == user.id for p in game['participants']):
            await query.answer("ุดูุง ูุจูุงู ุฏุฑ ุงู ูุฑุนูโฺฉุด ุดุฑฺฉุช ฺฉุฑุฏูโุงุฏ!", show_alert=True)
            return

        # ณ. ฺฉุงุฑุจุฑ ุฑุง ุจู ูุณุช ุงุถุงูู ูโฺฉูู
        game['participants'].append({'id': user.id, 'name': user.first_name})
        await query.answer("ุดูุง ุจุง ููููุช ุจู ฺฏุฑุฏููู ุดุงูุณ ูพูุณุชุฏ!")
        
        # ด. ูพุงู ุฑุง ุจุง ูุณุช ุฌุฏุฏ ุจูโุฑูุฒุฑุณุงู ูโฺฉูู
        text, reply_markup = await render_gardone_board(game)
        await query.edit_message_text(text, reply_markup=reply_markup, parse_mode=ParseMode.HTML)

    elif action == "spin":
        starter_admin_id = int(data[3])
        if user.id != starter_admin_id:
            await query.answer("ููุท ุงุฏูู ฺฉู ฺฏุฑุฏููู ุฑุง ุณุงุฎุชูุ ูโุชูุงูุฏ ุขู ุฑุง ุจฺุฑุฎุงูุฏ!", show_alert=True)
            return

        if not game['participants']:
            await query.answer("ูฺโฺฉุณ ุฏุฑ ูุฑุนูโฺฉุด ุดุฑฺฉุช ูฺฉุฑุฏู ุงุณุช!", show_alert=True)
            return

        await query.answer("ฺฏุฑุฏููู ุฏุฑ ุญุงู ฺุฑุฎุด ุงุณุช...")
        winner = random.choice(game['participants'])
        
        final_text = f"๐ **ุจุฑูุฏู ูุดุฎุต ุดุฏ!** ๐\n\n" \
                     f"ุชุจุฑฺฉ ุจู **{winner['name']}** ุนุฒุฒ!\nุดูุง ุจุฑูุฏู ุฎูุดโุดุงูุณ ุงู ฺฏุฑุฏููู ุจูุฏุฏ."
        
        await query.edit_message_text(final_text, reply_markup=None, parse_mode=ParseMode.HTML)
        del active_games['gardone'][chat_id]

    elif action == "cancel":
        starter_admin_id = int(data[3])
        if user.id != starter_admin_id:
            await query.answer("ููุท ุงุฏูู ฺฉู ฺฏุฑุฏููู ุฑุง ุณุงุฎุชูุ ูโุชูุงูุฏ ุขู ุฑุง ูุบู ฺฉูุฏ!", show_alert=True)
            return
            
        await query.edit_message_text("๐ก ฺฏุฑุฏููู ุดุงูุณ ุชูุณุท ุงุฏูู ูุบู ุดุฏ.")
        del active_games['gardone'][chat_id]
        
# ========================= GARDONE SHANS (END) ==========================
# ======================== 4-PLAYER DOZ CODE (END) =========================
# --------------------------- GAME: HADS KALAME (ุจุง ุฌุงู ุฌุฏุงฺฏุงูู) ---------------------------
async def hads_kalame_start_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    data = query.data.split('_')
    try:
        target_user_id = int(data[-1])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
        return

    if user.id != target_user_id:
        await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
        return
        await query.answer()
    
    if await check_ban_status(update, context): return
    
    chat_id = update.effective_chat.id
    if chat_id in active_games['hangman']:
        await query.answer("ฺฉ ุจุงุฒ ุญุฏุณ ฺฉููู ูุนุงู ุงุณุช.", show_alert=True)
        return
        
    word = random.choice(WORD_LIST)
    active_games['hangman'][chat_id] = {"word": word, "display": ["_"] * len(word), "guessed_letters": set(), "players": {}}
    game = active_games['hangman'][chat_id]
    text = f"๐ต๏ธโโ๏ธ **ุญุฏุณ ฺฉููู (ุฑูุงุจุช) ุดุฑูุน ุดุฏ!**\n\nูุฑ ฺฉุงุฑุจุฑ {INITIAL_LIVES} ุฌุงู ุฏุงุฑุฏ.\n\n|ูฺฉุชู*:|ุจู ุตูุฑุช ุชฺฉ ุญุฑู ุญุฏุณ ุจุฒูุฏ.ูุซุงู:(ู)*\n\nฺฉููู: `{' '.join(game['display'])}`"
    await query.edit_message_text(text, parse_mode=ParseMode.MARKDOWN)

async def handle_letter_guess(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id, user = update.effective_chat.id, update.effective_user
    if chat_id not in active_games['hangman']: return
    if await check_ban_status(update, context): return

    guess = update.message.text.strip()
    game = active_games['hangman'][chat_id]
    
    if user.id not in game['players']: game['players'][user.id] = INITIAL_LIVES
    if game['players'][user.id] == 0: 
        await update.message.reply_text(f"{user.mention_html()}ุ ุดูุง ุชูุงู ุฌุงูโูุง ุฎูุฏ ุฑุง ุงุฒ ุฏุณุช ุฏุงุฏูโุงุฏ!", parse_mode=ParseMode.HTML)
        return

    # ##### ุชุบุฑ ฺฉูุฏ: ุงุทูุงุนโุฑุณุงู ุจุฑุง ุญุฑู ุชฺฉุฑุงุฑ #####
    if guess in game['guessed_letters']:
        await update.message.reply_text("ุงู ุญุฑู ูุจูุงู ฺฏูุชู ุดุฏู!", quote=True)
        return

    game['guessed_letters'].add(guess)
    if guess in game['word']:
        for i, letter in enumerate(game['word']):
            if letter == guess: game['display'][i] = letter
        if "_" not in game['display']:
            await update.message.reply_text(f"โ **{user.mention_html()}** ุจุฑูุฏู ุดุฏ! ฺฉููู ุตุญุญ `{game['word']}` ุจูุฏ.", parse_mode=ParseMode.HTML, reply_markup=None)
            del active_games['hangman'][chat_id]
        else:
            await update.message.reply_text(f"`{' '.join(game['display'])}`", parse_mode=ParseMode.MARKDOWN)
    else:
        game['players'][user.id] -= 1
        lives_left = game['players'][user.id]
        if lives_left > 0:
            await update.message.reply_text(f"ุงุดุชุจุงู ุจูุฏ {user.mention_html()}! ุดูุง **{lives_left}** ุฌุงู ุฏฺฏุฑ ุฏุงุฑุฏ.", parse_mode=ParseMode.HTML)
        else:
            await update.message.reply_text(f"{user.mention_html()} ุชูุงู ุฌุงูโูุง ุฎูุฏ ุฑุง ุงุฒ ุฏุณุช ุฏุงุฏ ู ุงุฒ ุจุงุฒ ุญุฐู ุดุฏ.", parse_mode=ParseMode.HTML)
            # ฺฺฉ ฺฉุฑุฏู ุงูฺฉู ุขุง ููู ุจุงุฒฺฉูุงู ุญุฐู ุดุฏูโุงูุฏ ุง ุฎุฑ
            active_players_lives = [lives for uid, lives in game['players'].items() if lives > 0]
            if not active_players_lives:
                await update.message.reply_text(f"โ๏ธ ููู ุจุงุฎุชุฏ! ฺฉููู ุตุญุญ `{game['word']}` ุจูุฏ.", parse_mode=ParseMode.MARKDOWN)
                del active_games['hangman'][chat_id]

# --------------------------- GAME: TYPE SPEED ---------------------------
def create_typing_image(text: str) -> io.BytesIO:
    reshaped_text = arabic_reshaper.reshape(text)
    bidi_text = get_display(reshaped_text)
    try:
        font = ImageFont.truetype("Vazir.ttf", 24)
    except IOError:
        logger.warning("Vazir.ttf font not found. Falling back to default.")
        font = ImageFont.load_default()
    
    dummy_img, draw = Image.new('RGB', (1, 1)), ImageDraw.Draw(Image.new('RGB', (1, 1)))
    _, _, w, h = draw.textbbox((0, 0), bidi_text, font=font)
    img = Image.new('RGB', (w + 40, h + 40), color=(255, 255, 255))
    ImageDraw.Draw(img).text((20, 20), bidi_text, fill=(0, 0, 0), font=font)
    bio = io.BytesIO()
    bio.name = 'image.jpeg'
    img.save(bio, 'JPEG')
    bio.seek(0)
    return bio

async def type_start_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    data = query.data.split('_')
    try:
        target_user_id = int(data[-1])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
        return

    if user.id != target_user_id:
        await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
        return
        await query.answer()

    if await check_ban_status(update, context): return
    
    chat_id = update.effective_chat.id
    if chat_id in active_games['typing']: 
        await query.answer("ฺฉ ุจุงุฒ ุชุงูพ ุณุฑุนุช ูุนุงู ุงุณุช.", show_alert=True)
        return
        
    sentence = random.choice(TYPING_SENTENCES)
    active_games['typing'][chat_id] = {"sentence": sentence, "start_time": datetime.now()}
    
    await query.edit_message_text("ุจุงุฒ ุชุงูพ ุณุฑุนุช ณ... ฒ... ฑ...")
    image_file = create_typing_image(sentence)
    await context.bot.send_photo(chat_id=chat_id, photo=image_file, caption="ุณุฑุน ุชุงูพ ฺฉูุฏ!")

async def handle_typing_attempt(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    if chat_id not in active_games['typing']: return
    if await check_ban_status(update, context): return
    
    game = active_games['typing'][chat_id]
    user_input = update.message.text.strip()
    
    if user_input == game['sentence']:
        duration = (datetime.now() - game['start_time']).total_seconds()
        user = update.effective_user
        await update.message.reply_text(f"๐ {user.mention_html()} ุจุฑูุฏู ุดุฏ!\nุฒูุงู: **{duration:.2f}** ุซุงูู", parse_mode=ParseMode.HTML)
        del active_games['typing'][chat_id]

# --------------------------- GAME: GHARCH & ETERAF ---------------------------
# (ููุทู ุงู ุจุงุฒโูุง ุนูุฏุชุงู ุจุฏูู ุชุบุฑ ุงุณุชุ ููุท ูุญูู ุดุฑูุน ุขููุง ุงุฒ ูพูู ุงุถุงูู ุดุฏู)
async def gharch_start_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    query = update.callback_query
    user = query.from_user
    data = query.data.split('_')
    try:
        target_user_id = int(data[-1])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
        return

    if user.id != target_user_id:
        await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
        return
        await query.answer()
    
    if await check_ban_status(update, context): return ConversationHandler.END

    if not await is_group_admin(update.effective_user.id, update.effective_chat.id, context):
        await query.answer("โ ููุท ุงุฏููโูุง ฺฏุฑูู ูโุชูุงููุฏ ุงู ุจุงุฒ ุฑุง ุดุฑูุน ฺฉููุฏ.", show_alert=True)
        return ConversationHandler.END
    
    context.chat_data['starter_admin_id'] = update.effective_user.id
    await query.edit_message_text(
        "๐ **ุดุฑูุน ุจุงุฒ ูุงุฑฺ**\n\n"
        "ูุทูุงู ูุฒุฑูู ฺฏุงุฏ ุจุงุฒ ุฑุง ุงุฑุณุงู ฺฉูุฏ (ูุซุงู: @GodUsername).\nุจุฑุง ูุบู /cancel ุฑุง ุงุฑุณุงู ฺฉูุฏ."
    )
    context.chat_data['gharch_setup_message_id'] = query.message.message_id
    return ASKING_GOD_USERNAME

async def receive_god_username(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    starter_admin_id = context.chat_data.get('starter_admin_id')
    current_user_id = update.effective_user.id

    # ุงฺฏุฑ ฺฉุงุฑุจุฑ ฺฉู ูพุงู ุฏุงุฏูุ ููุงู ุงุฏูู ูุณุช ฺฉู ุจุงุฒ ุฑุง ุดุฑูุน ฺฉุฑุฏูุ ูพุงู ุฑุง ูุงุฏุฏู ุจฺฏุฑ
    if current_user_id != starter_admin_id:
        return ASKING_GOD_USERNAME # ุฏุฑ ููุงู ูุถุนุช ุจุงู ุจูุงู ู ูฺ ฺฉุงุฑ ูฺฉู
    # --- ูพุงุงู ุจุฎุด ุฌุฏุฏ ---
    
    god_username = update.message.text.strip()
    if not god_username.startswith('@'):
        await update.message.reply_text("ูุฑูุช ุงุดุชุจุงู ุงุณุช. ูุทูุงู ูุฒุฑูู ุฑุง ุจุง @ ุงุฑุณุงู ฺฉูุฏ.", quote=True)
        return ASKING_GOD_USERNAME

    context.chat_data['god_username'] = god_username
    starter_admin_id = context.chat_data['starter_admin_id']
    setup_message_id = context.chat_data.get('gharch_setup_message_id')

    try:
        await update.message.delete()
    except Exception as e:
        logger.warning(f"Could not delete admin's username message: {e}")

    if not setup_message_id:
        await context.bot.send_message(update.effective_chat.id, "ุฎุทุง ุฏุฑ ุงูุชู ูพุงู ุงุตู ุฑุฎ ุฏุงุฏ. ูุทูุงู ุจุงุฒ ุฑุง ุจุง /cancel ูุบู ู ูุฌุฏุฏุงู ุดุฑูุน ฺฉูุฏ.")
        return ConversationHandler.END

    keyboard = [[
        InlineKeyboardButton("โ ุชุงุฏ ูโฺฉูู", callback_data=f"gharch_confirm_god_{starter_admin_id}")
    ]]
    
    await context.bot.edit_message_text(
        chat_id=update.effective_chat.id,
        message_id=setup_message_id,
        text=(
            f"{god_username} ุนุฒุฒุ\n"
            f"ุดูุง ุจู ุนููุงู ฺฏุงุฏ ุจุงุฒ ูุงุฑฺ ุงูุชุฎุงุจ ุดุฏุฏ. ูุทูุงู ุจุฑุง ุดุฑูุน ุจุงุฒุ ุงู ูุณุฆููุช ุฑุง ุชุงุฏ ฺฉูุฏ.\n\n"
            f"โ๏ธ **ูฺฉุชู:** ุจุฑุง ุฏุฑุงูุช ฺฏุฒุงุฑุดโูุงุ ุจุงุฏ ุฑุจุงุช ุฑุง ุงุณุชุงุฑุช ฺฉุฑุฏู ุจุงุดุฏ."
        ),
        reply_markup=InlineKeyboardMarkup(keyboard)
    )
    return CONFIRMING_GOD

async def confirm_god(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    """ฺฏุงุฏ ุจุงุฒ ุฑุง ุชุงุฏ ฺฉุฑุฏู ู ุจุงุฒ ุฑุณูุงู ุดุฑูุน ูโุดูุฏ."""
    query = update.callback_query
    user = query.from_user
    chat_id = query.message.chat.id
    
    god_username_from_admin = context.chat_data.get('god_username', '').lower().lstrip('@')

    if not user.username or user.username.lower() != god_username_from_admin:
        await query.answer("ุงู ุฏุฑุฎูุงุณุช ุจุฑุง ุดูุง ูุณุชุ ุง ูุฒุฑูู ุชูฺฏุฑุงู ุดูุง ุชูุธู ูุดุฏู ุงุณุช.", show_alert=True)
        return CONFIRMING_GOD

    await query.answer("ุดูุง ุจู ุนููุงู ฺฏุงุฏ ุชุงุฏ ุดุฏุฏ!")

    try:
        god_id = user.id
        god_username_display = f"@{user.username}"
        active_gharch_games[chat_id] = {'god_id': god_id, 'god_username': god_username_display}

        bot_username = (await context.bot.get_me()).username
        game_message_text = (
            "**ุจุงุฒ ูุงุฑฺ ๐ ุดุฑูุน ุดุฏ!**\n\n"
            "ุฑู ุฏฺฉูู ุฒุฑ ฺฉูฺฉ ฺฉู ู ุญุฑู ุฏูุช ุฑู ุจููุณ ุชุง ุจู ุตูุฑุช ูุงุดูุงุณ ุฏุฑ ฺฏุฑูู ุธุงูุฑ ุจุดู!\n\n"
            f"*(ููุท ฺฏุงุฏ ุจุงุฒุ {god_username_display}ุ ุงุฒ ููุช ุงุฑุณุงูโฺฉููุฏู ูุทูุน ุฎูุงูุฏ ุดุฏ.)*"
        )
        keyboard = [[InlineKeyboardButton("๐ ุงุฑุณุงู ูพุงู ูุงุดูุงุณ", url=f"https://t.me/{bot_username}?start=gharch_{chat_id}")]]
        
        await query.edit_message_text(
            text=game_message_text,
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode=ParseMode.MARKDOWN
        )
        
        try:
            await context.bot.pin_chat_message(chat_id, query.message.message_id)
            active_gharch_games[chat_id]['pinned_message_id'] = query.message.message_id
        except Exception as pin_error:
            logger.warning(f"Could not pin message in group {chat_id}. Reason: {pin_error}")
            await context.bot.send_message(
                chat_id=chat_id,
                text="โ ุจุงุฒ ุจุง ููููุช ุดุฑูุน ุดุฏ. ุงุฏููโูุง ุนุฒุฒุ ูุทูุงู ุงู ูพุงู ุฑุง ูพู ฺฉูุฏ.",
                reply_to_message_id=query.message.message_id
            )

    except Exception as e:
        error_message = f"๐ซ **ุฎุทุง ูุงุดูุงุฎุชู!**\n\nุฑุจุงุช ุฏุฑ ุณุงุฎุช ุจุงุฒ ุจุง ฺฉ ุฎุทุง ุบุฑููุชุธุฑู ููุงุฌู ุดุฏ: `{e}`"
        await context.bot.send_message(chat_id=chat_id, text=error_message, parse_mode=ParseMode.MARKDOWN)
        logger.error(f"CRITICAL ERROR in confirm_god: {e}")
        return ConversationHandler.END

    return ConversationHandler.END

async def cancel_gharch_conv(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    """ูุบู ูุฑุขูุฏ ุณุงุฎุช ุจุงุฒ ูุงุฑฺ."""
    await update.message.reply_text("ูุฑุขูุฏ ุณุงุฎุช ุจุงุฒ ูุงุฑฺ ูุบู ุดุฏ.")
    await rsgame_command(update, context)
    return ConversationHandler.END

async def eteraf_start_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user = query.from_user
    data = query.data.split('_')
    try:
        target_user_id = int(data[-1])
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
        return

    if user.id != target_user_id:
        await query.answer("ุงู ูพูู ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
        return
        await query.answer()

    if await check_ban_status(update, context): return
    
    user = update.effective_user
    chat_id = update.effective_chat.id
    if not await is_group_admin(user.id, chat_id, context):
        await query.answer("โ ุดูุง ุงุฌุงุฒู ุงุณุชูุงุฏู ุงุฒ ุงู ุฏุณุชูุฑ ุฑุง ูุฏุงุฑุฏ.", show_alert=True)
        return
    
    data = query.data.split('_')
    eteraf_type = data[2] 

    if eteraf_type == "default":
        starter_text = "ฺฉ ููุถูุน ุงุนุชุฑุงู ุฌุฏุฏ ุดุฑูุน ุดุฏ. ุจุฑุง ุงุฑุณุงู ุงุนุชุฑุงู ูุงุดูุงุณุ ุงุฒ ุฏฺฉูู ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ."
        bot_username = (await context.bot.get_me()).username
        try:
            starter_message = await context.bot.send_message(chat_id, starter_text)
            keyboard = [[InlineKeyboardButton("ุงุฑุณุงู ุจู ุตูุฑุช ูุงุดูุงุณ", url=f"https://t.me/{bot_username}?start=eteraf_{chat_id}_{starter_message.message_id}")]]
            await starter_message.edit_reply_markup(reply_markup=InlineKeyboardMarkup(keyboard))
            await query.message.delete() 
        except Exception as e:
            logger.error(f"Error in eteraf_command: {e}")
        return

    elif eteraf_type == "custom":
        # ##### ุชุบุฑ ุฌุฏุฏ: ุฐุฎุฑู ุขุฏ ูพุงู ุจุฑุง ุญุฐู ุฏุฑ ุขูุฏู #####
        context.chat_data['starter_admin_id'] = query.from_user.id
        context.chat_data['eteraf_prompt_message_id'] = query.message.message_id
        await query.edit_message_text("ูุทูุงู ูุชู ุฏูุฎูุงู ุฎูุฏ ุฑุง ุจุฑุง ุดุฑูุน ุงุนุชุฑุงู ุงุฑุณุงู ฺฉูุฏ.\nุจุฑุง ูุบู /cancel ุฑุง ุงุฑุณุงู ฺฉูุฏ.")
        return ENTERING_ETERAF_TEXT

async def receive_eteraf_text(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # --- ุจุฎุด ุฌุฏุฏ ุจุฑุง ุจุฑุฑุณ ุดูุงุณู ฺฉุงุฑุจุฑ ---
    starter_admin_id = context.chat_data.get('starter_admin_id')
    current_user_id = update.effective_user.id

    # ุงฺฏุฑ ฺฉุงุฑุจุฑ ฺฉู ูพุงู ุฏุงุฏูุ ููุงู ุงุฏูู ูุณุช ฺฉู ุจุงุฒ ุฑุง ุดุฑูุน ฺฉุฑุฏูุ ูพุงู ุฑุง ูุงุฏุฏู ุจฺฏุฑ
    if current_user_id != starter_admin_id:
        return ENTERING_ETERAF_TEXT # ุฏุฑ ููู ูุถุนุช ููุชุธุฑ ุจูุงู ู ฺฉุงุฑ ูฺฉู
    # --- ูพุงุงู ุจุฎุด ุฌุฏุฏ ---
    custom_text = update.message.text
    chat_id = update.effective_chat.id
    bot_username = (await context.bot.get_me()).username
    
    try:
        # ุฑุจุงุช ูพุงู ุฌุฏุฏ ุงุนุชุฑุงู ุฑุง ุจุง ุฏฺฉูู ุงุฑุณุงู ูโฺฉูุฏ
        starter_message = await context.bot.send_message(chat_id, custom_text)
        keyboard = [[InlineKeyboardButton("ุงุฑุณุงู ุจู ุตูุฑุช ูุงุดูุงุณ", url=f"https://t.me/{bot_username}?start=eteraf_{chat_id}_{starter_message.message_id}")]]
        await starter_message.edit_reply_markup(reply_markup=InlineKeyboardMarkup(keyboard))
    except Exception as e:
        logger.error(f"Error in eteraf_command (custom): {e}")
        await update.message.reply_text(f"ุฎุทุง ุฏุฑ ุงุฑุณุงู ูพุงู ุฑุฎ ุฏุงุฏ: {e}")
    finally:
        # ูพุงู ูุจู ุฑุจุงุช ("ูุทูุง ูุชู ุฎูุฏ ุฑุง ุงุฑุณุงู ฺฉูุฏ") ุญุฐู ูโุดูุฏ
        prompt_message_id = context.chat_data.pop('eteraf_prompt_message_id', None)
        try:
            if prompt_message_id:
                await context.bot.delete_message(chat_id=chat_id, message_id=prompt_message_id)
            
            # ##### ุชุบุฑ ุงุตู: ุฎุท ุฒุฑ ุญุฐู ุดุฏ #####
            # await update.message.delete() # -> ุงู ุฎุท ุฏฺฏุฑ ูุฌูุฏ ูุฏุงุฑุฏ ู ูพุงู ุดูุง ุจุงู ูโูุงูุฏ.

        except Exception:
            pass
            
        return ConversationHandler.END

async def handle_anonymous_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_data = context.user_data
    if 'anon_target_chat' not in user_data:
        return await update.message.reply_text("ูุทูุงู ุงุจุชุฏุง ุงุฒ ุทุฑู ุฏฺฉููโุง ฺฉู ุฏุฑ ฺฏุฑูู ูุฑุงุฑ ุฏุงุฑุฏุ ูุฑุขูุฏ ุฑุง ุดุฑูุน ฺฉูุฏ.")
    
    target_info = user_data['anon_target_chat']
    target_chat_id = target_info['id']
    game_type = target_info['type']
    message_text = update.message.text

    try:
        if game_type == "gharch":
            if target_chat_id in active_gharch_games:
                sender = update.effective_user
                god_info = active_gharch_games[target_chat_id]
                god_id = god_info['god_id']

                await context.bot.send_message(
                    chat_id=target_chat_id,
                    text=f"#ูพุงู_ูุงุดูุงุณ ๐\n\n{message_text}"
                )
                await update.message.reply_text("โ ูพุงู ุดูุง ุจุง ููููุช ุจู ุตูุฑุช ูุงุดูุงุณ ุฏุฑ ฺฏุฑูู ุงุฑุณุงู ุดุฏ.")

                report_text = (
                    f"๐ **ฺฏุฒุงุฑุด ูพุงู ูุงุดูุงุณ ุฌุฏุฏ**\n\n"
                    f"๐ค **ุงุฑุณุงู ฺฉููุฏู:**\n"
                    f"- ูุงู: {sender.mention_html()}\n"
                    f"- ูุฒุฑูู: @{sender.username}\n"
                    f"- ุขุฏ: `{sender.id}`\n\n"
                    f"๐ **ูุชู ูพุงู:**\n"
                    f"{message_text}"
                )
                await context.bot.send_message(chat_id=god_id, text=report_text, parse_mode=ParseMode.HTML)
            else:
                await update.message.reply_text("ุงู ุจุงุฒ ูุงุฑฺ ุฏฺฏุฑ ูุนุงู ูุณุช ุง ูููุถ ุดุฏู ุงุณุช.")

        elif game_type == "eteraf":
            reply_to_id = target_info.get('reply_to')
            header = "#ุงุนุชุฑุงู_ูุงุดูุงุณ ๐คซ"
            await context.bot.send_message(
                chat_id=target_chat_id,
                text=f"{header}\n\n{message_text}",
                reply_to_message_id=reply_to_id
            )
            await update.message.reply_text("โ ุงุนุชุฑุงู ุดูุง ุจุง ููููุช ุจู ุตูุฑุช ูุงุดูุงุณ ุฏุฑ ฺฏุฑูู ุงุฑุณุงู ุดุฏ.")
        
        else:
            await update.message.reply_text("ููุน ุจุงุฒ ูุงุดูุงุณ ูุดุฎุต ูุณุช.")

    except Exception as e:
        await update.message.reply_text(f"โ๏ธ ุงุฑุณุงู ูพุงู ุจุง ุฎุทุง ููุงุฌู ุดุฏ: {e}")
        logger.error(f"Error in handle_anonymous_message for game {game_type}: {e}")
    finally:
        if 'anon_target_chat' in context.user_data:
            del context.user_data['anon_target_chat']


# =================================================================
# ================= OWNER & CORE COMMANDS (ุจุฏูู ุชุบุฑ) =============
# =================================================================
async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.effective_user
    chat_id = update.effective_chat.id

    if await check_ban_status(update, context): return

    # --- ุจุฎุด ฑ: ูุฏุฑุช ููฺฉโูุง ูุฑูุฏ (Deep Linking) ---
    if context.args:
        try:
            payload = context.args[0]
            parts = payload.split('_')
            game_type, target_chat_id = parts[0], int(parts[1])

            if game_type == "gharch":
                if target_chat_id in active_gharch_games:
                    god_username = active_gharch_games[target_chat_id]['god_username']
                    context.user_data['anon_target_chat'] = {'id': target_chat_id, 'type': game_type}
                    prompt = f"ูพุงู ุฎูุฏ ุฑุง ุจุฑุง ุงุฑุณุงู ูุงุดูุงุณ ุจููุณุฏ...\n\nุชูุฌู: ููุท ฺฏุงุฏ ุจุงุฒ ({god_username}) ููุช ุดูุง ุฑุง ุฎูุงูุฏ ุฏุฏ."
                    await update.message.reply_text(prompt)
                    return
                else:
                    await update.message.reply_text("ุงู ุจุงุฒ ูุงุฑฺ ุฏฺฏุฑ ูุนุงู ูุณุช."); return
            
            elif game_type == "eteraf":
                context.user_data['anon_target_chat'] = {'id': target_chat_id, 'type': game_type}
                if len(parts) > 2:
                    context.user_data['anon_target_chat']['reply_to'] = int(parts[2])
                prompt = "ุงุนุชุฑุงู ุฎูุฏ ุฑุง ุจููุณุฏ ุชุง ุจู ุตูุฑุช ูุงุดูุงุณ ุฏุฑ ฺฏุฑูู ุงุฑุณุงู ุดูุฏ..."
                await update.message.reply_text(prompt)
                return

        except (ValueError, IndexError):
            pass # ุงฺฏุฑ payload ูุนุชุจุฑ ูุจูุฏุ ุจู ุจุฎุด ุงุณุชุงุฑุช ูุนููู ูโุฑูุฏ

    # --- ุจุฎุด ฒ: ููุทู ุงุณุชุงุฑุช ูุนููู ---
    conn = get_db_connection()
    if conn:
        with conn.cursor() as cur: 
            cur.execute("INSERT INTO users (user_id, first_name, username) VALUES (%s, %s, %s) ON CONFLICT (user_id) DO NOTHING;", (user.id, user.first_name, user.username))
            conn.commit()
    
    # ุงูุฌุง ุนุถูุช ุงุฌุจุงุฑ ุจุฑุง ุงุณุชุงุฑุช ูุนููู ฺฺฉ ููโุดูุฏุ ููุท ุฏุฑ ุจุงุฒโูุง ุฎุงุต
    
    # --- ุจุฎุด ณ: ุงุฑุณุงู ูพุงู ุฎูุดุงูุฏฺฏู (ุณูุงุฑุด ุง ูพุดโูุฑุถ) ---
    keyboard = [
        [InlineKeyboardButton("โ ุงูุฒูุฏู ุฑุจุงุช ุจู ฺฏุฑูู", url=f"https://t.me/{(await context.bot.get_me()).username}?startgroup=true")],
        #[InlineKeyboardButton("๐ฎ ูพูู ุจุงุฒโูุง", callback_data="rsgame_cat_main_pv")], # ุฏฺฉูู ูพูู ุฏุฑ PV
        [InlineKeyboardButton("๐ค ุงุฑุชุจุงุท ุจุง ูพุดุชุจุงู", url=f"https://t.me/{SUPPORT_USERNAME}")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    custom_welcome_sent = False
    if conn:
        try:
            with conn.cursor() as cur:
                cur.execute("SELECT message_id, chat_id FROM start_message WHERE id = 1;")
                start_msg_data = cur.fetchone()
                if start_msg_data:
                    message_id, from_chat_id = start_msg_data
                    await context.bot.copy_message(chat_id=chat_id, from_chat_id=from_chat_id, message_id=message_id, reply_markup=reply_markup)
                    custom_welcome_sent = True
        except Exception as e:
            logger.error(f"Could not send custom start message in PV: {e}")
        finally:
            conn.close()

    if not custom_welcome_sent:
        await update.message.reply_text("ุณูุงู ุจู ุฑุงููุจุงุฒ ุฎูุด ุขูุฏุฏ.\nุจุฑุง ุดุฑูุน ุจุงุฒโูุง ุงุฒ ุฏฺฉูู ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ.", reply_markup=reply_markup)
    
    report_text = f"โ ฺฉุงุฑุจุฑ ุฌุฏุฏ: {user.mention_html()} (ID: `{user.id}`)"
    for owner_id in OWNER_IDS:
        try:
            await context.bot.send_message(chat_id=owner_id, text=report_text, parse_mode=ParseMode.HTML)
        except:
            pass
            
async def rsgame_pv_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ููฺฏุงู ฺฉู ฺฉุงุฑุจุฑ ุฏุฑ PV ุฑู ุฏฺฉูู ูพูู ฺฉูฺฉ ูโฺฉูุฏ"""
    query = update.callback_query
    await query.answer()
    await query.edit_message_text("ุงู ูพูู ููุท ุฏุฑ ฺฏุฑููโูุง ฺฉุงุฑ ูโฺฉูุฏ. ูุทูุงู ุฑุจุงุช ุฑุง ุจู ฺฉ ฺฏุฑูู ุงุถุงูู ฺฉุฑุฏู ู ุฏุณุชูุฑ /rsgame ุฑุง ุงุฑุณุงู ฺฉูุฏ.")


# ุจูู ุฏุณุชูุฑุงุช ุงุฏูู (stats, fwdusers, ...) ุจุฏูู ุชุบุฑ ุจุงู ูโูุงููุฏ
# ...
async def set_start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not await is_owner(update.effective_user.id): return
    if not update.message.reply_to_message: return await update.message.reply_text("ุฑู ฺฉ ูพุงู ุฑูพูุง ฺฉูุฏ.")
    msg = update.message.reply_to_message
    conn = get_db_connection()
    if conn:
        with conn.cursor() as cur: cur.execute("INSERT INTO start_message (id, message_id, chat_id) VALUES (1, %s, %s) ON CONFLICT (id) DO UPDATE SET message_id = EXCLUDED.message_id, chat_id = EXCLUDED.chat_id;", (msg.message_id, msg.chat_id)); conn.commit()
        conn.close()
        await update.message.reply_text("โ ูพุงู ุฎูุดุงูุฏฺฏู ุชูุธู ุดุฏ.")

async def stats_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not await is_owner(update.effective_user.id): return
    conn = get_db_connection()
    if conn:
        with conn.cursor() as cur:
            cur.execute("SELECT COUNT(*) FROM users;"); user_count = cur.fetchone()[0]
            cur.execute("SELECT COUNT(*) FROM groups;"); group_count = cur.fetchone()[0]
            cur.execute("SELECT SUM(member_count) FROM groups;"); total_members = cur.fetchone()[0] or 0
        stats = f"๐ **ุขูุงุฑ ุฑุจุงุช**\n\n๐ค ฺฉุงุฑุจุฑุงู: {user_count}\n๐ฅ ฺฏุฑููโูุง: {group_count}\n๐จโ๐ฉโ๐งโ๐ฆ ูุฌููุน ุงุนุถุง: {total_members}"
        await update.message.reply_text(stats, parse_mode=ParseMode.MARKDOWN)
        conn.close()
        
async def broadcast_command(update: Update, context: ContextTypes.DEFAULT_TYPE, target: str):
    if not await is_owner(update.effective_user.id): return
    if not update.message.reply_to_message: return await update.message.reply_text("ุฑู ฺฉ ูพุงู ุฑูพูุง ฺฉูุฏ.")
    conn, table, column = get_db_connection(), "users" if target == "users" else "groups", "user_id" if target == "users" else "group_id"
    if not conn: return
    with conn.cursor() as cur: cur.execute(f"SELECT {column} FROM {table};"); targets = cur.fetchall()
    conn.close()
    if not targets: return await update.message.reply_text("ูุฏู ุงูุช ูุดุฏ.")
    
    sent, failed = 0, 0
    status_msg = await update.message.reply_text(f"โณ ุฏุฑ ุญุงู ุงุฑุณุงู ุจู {len(targets)} {target}...")
    for (target_id,) in targets:
        try:
            await context.bot.forward_message(chat_id=target_id, from_chat_id=update.message.reply_to_message.chat.id, message_id=update.message.reply_to_message.message_id)
            sent += 1
        except Exception as e:
            failed += 1
            logger.error(f"Broadcast failed for {target_id}: {e}")
    await status_msg.edit_text(f"๐ ุงุฑุณุงู ุชูุงู ุดุฏ.\n\nโ ูููู: {sent}\nโ ูุงูููู: {failed}")

async def fwdusers_command(update: Update, context: ContextTypes.DEFAULT_TYPE): await broadcast_command(update, context, "users")
async def fwdgroups_command(update: Update, context: ContextTypes.DEFAULT_TYPE): await broadcast_command(update, context, "groups")

async def leave_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not await is_owner(update.effective_user.id): return
    if not context.args: return await update.message.reply_text("ุงุณุชูุงุฏู: /leave <group_id>")
    try:
        group_id = int(context.args[0])
        await context.bot.leave_chat(group_id)
        await update.message.reply_text(f"โ ุจุง ููููุช ุงุฒ ฺฏุฑูู `{group_id}` ุฎุงุฑุฌ ุดุฏู.", parse_mode=ParseMode.MARKDOWN)
    except Exception as e:
        await update.message.reply_text(f"ุฎุทุง: {e}")

async def grouplist_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not await is_owner(update.effective_user.id): return
    conn = get_db_connection()
    if conn:
        with conn.cursor() as cur:
            cur.execute("SELECT group_id, title, member_count FROM groups;")
            groups = cur.fetchall()
        conn.close()
        if not groups: return await update.message.reply_text("ุฑุจุงุช ุฏุฑ ูฺ ฺฏุฑูู ุนุถู ูุณุช.")
        message = "๐ **ูุณุช ฺฏุฑููโูุง:**\n\n"
        for i, (group_id, title, member_count) in enumerate(groups, 1):
            message += f"{i}. **{title}**\n   - ID: `{group_id}`\n   - ุงุนุถุง: {member_count}\n\n"
        await update.message.reply_text(message, parse_mode=ParseMode.MARKDOWN)

async def join_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not await is_owner(update.effective_user.id): return
    if not context.args: return await update.message.reply_text("ุงุณุชูุงุฏู: /join <group_id>")
    try:
        group_id = int(context.args[0])
        link = await context.bot.create_chat_invite_link(group_id, member_limit=30)
        await update.message.reply_text(f"ููฺฉ ูุฑูุฏ ุดูุง:\n{link.invite_link}")
    except Exception as e:
        await update.message.reply_text(f"ุฎุทุง ุฏุฑ ุณุงุฎุช ููฺฉ (ุดุงุฏ ุฑุจุงุช ุงุฏูู ูุจุงุดุฏ): {e}")

async def ban_user_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not await is_owner(update.effective_user.id): return
    if not context.args: return await update.message.reply_text("ุงุณุชูุงุฏู: /ban_user <user_id>")
    try:
        user_id = int(context.args[0])
        conn = get_db_connection()
        if conn:
            with conn.cursor() as cur: cur.execute("INSERT INTO banned_users (user_id) VALUES (%s) ON CONFLICT DO NOTHING;", (user_id,))
            conn.commit(); conn.close()
            await update.message.reply_text(f"ฺฉุงุฑุจุฑ `{user_id}` ุจุง ููููุช ูุณุฏูุฏ ุดุฏ.", parse_mode=ParseMode.MARKDOWN)
    except: await update.message.reply_text("ุขุฏ ูุงูุนุชุจุฑ ุงุณุช.")

async def unban_user_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not await is_owner(update.effective_user.id): return
    if not context.args: return await update.message.reply_text("ุงุณุชูุงุฏู: /unban_user <user_id>")
    try:
        user_id = int(context.args[0])
        conn = get_db_connection()
        if conn:
            with conn.cursor() as cur: cur.execute("DELETE FROM banned_users WHERE user_id = %s;", (user_id,))
            conn.commit(); conn.close()
            await update.message.reply_text(f"ฺฉุงุฑุจุฑ `{user_id}` ุจุง ููููุช ุงุฒ ูุณุฏูุฏุช ุฎุงุฑุฌ ุดุฏ.", parse_mode=ParseMode.MARKDOWN)
    except: await update.message.reply_text("ุขุฏ ูุงูุนุชุจุฑ ุงุณุช.")

async def ban_group_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Bans a group from using the bot."""
    if not await is_owner(update.effective_user.id): return
    if not context.args: return await update.message.reply_text("ุงุณุชูุงุฏู ุตุญุญ: /ban_group <group_id>")
    
    try:
        group_id = int(context.args[0])
        conn = get_db_connection()
        if conn:
            with conn.cursor() as cur:
                cur.execute("INSERT INTO banned_groups (group_id) VALUES (%s) ON CONFLICT DO NOTHING;", (group_id,))
            conn.commit()
            conn.close()
            await update.message.reply_text(f"ฺฏุฑูู `{group_id}` ุจุง ููููุช ูุณุฏูุฏ ุดุฏ.", parse_mode=ParseMode.MARKDOWN)
            
            # Bot leaves the group after banning it
            try:
                await context.bot.leave_chat(group_id)
            except Exception as e:
                logger.warning(f"Could not leave the banned group {group_id}: {e}")

    except (ValueError, IndexError):
        await update.message.reply_text("ูุทูุง ฺฉ ุขุฏ ุนุฏุฏ ูุนุชุจุฑ ุจุฑุง ฺฏุฑูู ูุงุฑุฏ ฺฉูุฏ.")

async def unban_group_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Unbans a group."""
    if not await is_owner(update.effective_user.id): return
    if not context.args: return await update.message.reply_text("ุงุณุชูุงุฏู ุตุญุญ: /unban_group <group_id>")

    try:
        group_id = int(context.args[0])
        conn = get_db_connection()
        if conn:
            with conn.cursor() as cur:
                cur.execute("DELETE FROM banned_groups WHERE group_id = %s;", (group_id,))
            conn.commit()
            conn.close()
            await update.message.reply_text(f"ฺฏุฑูู `{group_id}` ุจุง ููููุช ุงุฒ ูุณุฏูุฏุช ุฎุงุฑุฌ ุดุฏ.", parse_mode=ParseMode.MARKDOWN)
    except (ValueError, IndexError):
        await update.message.reply_text("ูุทูุง ฺฉ ุขุฏ ุนุฏุฏ ูุนุชุจุฑ ุจุฑุง ฺฏุฑูู ูุงุฑุฏ ฺฉูุฏ.")

async def checkgps_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    ุงุทูุงุนุงุช ฺฏุฑููโูุง ุซุจุชโุดุฏู ุฏุฑ ุฏุชุงุจุณ ุฑุง ุจูโุฑูุฒุฑุณุงู ู ฺฉ ฺฏุฒุงุฑุด ฺฉุงูู ุงุฑุณุงู ูโฺฉูุฏ.
    ุงู ุฏุณุชูุฑ ฺฏุฑููโูุง ุฌุฏุฏ ุฑุง ฺฉุดู ููโฺฉูุฏ.
    """
    if not await is_owner(update.effective_user.id):
        return

    status_msg = await update.message.reply_text("โณ ูุทูุงู ุตุจุฑ ฺฉูุฏุ ุฏุฑ ุญุงู ุจุฑุฑุณ ู ุจูโุฑูุฒุฑุณุงู ุงุทูุงุนุงุช ฺฏุฑููโูุง...")
    
    conn = get_db_connection()
    if not conn:
        await status_msg.edit_text("โ ุฎุทุง ุฏุฑ ุงุชุตุงู ุจู ุฏุชุงุจุณ.")
        return

    updated_count = 0
    error_count = 0
    final_report = []

    try:
        with conn.cursor() as cur:
            cur.execute("SELECT group_id FROM groups;")
            group_ids = cur.fetchall()
        
        if not group_ids:
            await status_msg.edit_text("โน๏ธ ูฺ ฺฏุฑูู ุฏุฑ ุฏุชุงุจุณ ุซุจุช ูุดุฏู ุงุณุช.")
            return

        await status_msg.edit_text(f"โ ุชุนุฏุงุฏ {len(group_ids)} ฺฏุฑูู ุฏุฑ ุฏุชุงุจุณ ุงูุช ุดุฏ. ุฏุฑ ุญุงู ุจูโุฑูุฒุฑุณุงู ู ุชูู ฺฏุฒุงุฑุด...")

        for (group_id,) in group_ids:
            try:
                # ฺฏุฑูุชู ุงุทูุงุนุงุช ุฌุฏุฏ ุงุฒ ุชูฺฏุฑุงู
                chat_info = await context.bot.get_chat(group_id)
                member_count = await context.bot.get_chat_member_count(group_id)
                title = chat_info.title
                
                # ุจูโุฑูุฒุฑุณุงู ุงุทูุงุนุงุช ุฏุฑ ุฏุชุงุจุณ
                with conn.cursor() as cur:
                    cur.execute("UPDATE groups SET title = %s, member_count = %s WHERE group_id = %s;", (title, member_count, group_id))
                conn.commit()
                updated_count += 1
                
                owner_mention = "ูุงูุดุฎุต"
                try:
                    admins = await context.bot.get_chat_administrators(group_id)
                    for admin in admins:
                        if admin.status == 'creator':
                            owner_mention = f"[{admin.user.first_name}](tg://user?id={admin.user.id})"
                            break
                except Exception:
                    owner_mention = "ุฎุทุง ุฏุฑ ุฏุฑุงูุช"

                invite_link_text = "ููฺฉ ุฏุฑุงูุช ูุดุฏ"
                try:
                    link = await context.bot.export_chat_invite_link(group_id)
                    invite_link_text = f"[ูุฑูุฏ ุจู ฺฏุฑูู]({link})"
                except Exception:
                    pass

                report_text = (
                    f"๐ **{title}**\n"
                    f"๐ `{group_id}`\n"
                    f"๐ฅ {member_count} ููุฑ | ๐ {owner_mention}\n"
                    f"๐ {invite_link_text}"
                )
                final_report.append(report_text)

            except Exception as e:
                error_count += 1
                # ุงฺฏุฑ ุฑุจุงุช ุงุฒ ฺฏุฑูู ุงุฎุฑุงุฌ ุดุฏู ุจุงุดุฏุ ุขู ุฑุง ุงุฒ ุฏุชุงุจุณ ุญุฐู ูโฺฉูู
                if "chat not found" in str(e).lower():
                    with conn.cursor() as cur:
                        cur.execute("DELETE FROM groups WHERE group_id = %s;", (group_id,))
                    conn.commit()

            await asyncio.sleep(0.5) # ุชุฃุฎุฑ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุญุฏูุฏุช API

        # ุงุฑุณุงู ฺฏุฒุงุฑุด ููุง
        if final_report:
            full_message = "\n\n---\n\n".join(final_report)
            await status_msg.edit_text(
                f"๐ **ฺฏุฒุงุฑุด ููุง ฺฏุฑููโูุง**\n\n"
                f"{full_message}\n\n"
                f"--- \n"
                f"๐ {updated_count} ฺฏุฑูู ุจูโุฑูุฒุฑุณุงู ุดุฏ.\n"
                f"โ๏ธ {error_count} ฺฏุฑูู ุจุง ุฎุทุง ููุงุฌู ุดุฏ (ุงุญุชูุงูุงู ุฑุจุงุช ุงุฎุฑุงุฌ ุดุฏู).",
                parse_mode=ParseMode.MARKDOWN,
                disable_web_page_preview=True
            )
        else:
            await status_msg.edit_text("ฺฏุฒุงุฑุด ุจุฑุง ููุงุด ูุฌูุฏ ูุฏุงุฑุฏ. ููฺฉู ุงุณุช ุฑุจุงุช ุงุฒ ุชูุงู ฺฏุฑููโูุง ุงุฎุฑุงุฌ ุดุฏู ุจุงุดุฏ.")

    except Exception as e:
        await status_msg.edit_text(f"๐ซ ุจุฑูุฒ ุฎุทุง ุบุฑููุชุธุฑู: {e}")
    finally:
        conn.close()

# -----------------
async def track_chats(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """
    ููฺฏุงู ุงุถุงูู ุดุฏู ุฑุจุงุช ุจู ฺฏุฑููุ ุงุทูุงุนุงุช ุฑุง ุซุจุช ฺฉุฑุฏู ู ฺฏุฒุงุฑุด ฺฉุงูู ุจุฑุง ุงุฏูู ุงุฑุณุงู ูโฺฉูุฏ.
    """
    # ูุงฺฏ ุงููู ุจุฑุง ุงุทููุงู ุงุฒ ุงุฌุฑุง ุชุงุจุน
    logger.info("--- track_chats handler triggered ---")

    # --- ุจุฎุด ุงุตูุงุญ ุดุฏู ุจุฑุง ุณุงุฒฺฏุงุฑ ุจุดุชุฑ ุจุง ุขูพุฏุชโูุง ุชูฺฏุฑุงู ---
    # ุงุจุชุฏุง ุณุน ูโฺฉูุฏ ุงุฒ my_chat_member ุงุณุชูุงุฏู ฺฉูุฏุ ุงฺฏุฑ ูุจูุฏ ุงุฒ chat_member
    result = update.my_chat_member or update.chat_member
    
    if not result:
        logger.warning("Both my_chat_member and chat_member are empty in the update. Exiting.")
        return
    # --- ูพุงุงู ุจุฎุด ุงุตูุงุญ ุดุฏู ---
    
    logger.info(f"Chat member update received. Old status: '{result.old_chat_member.status}', New status: '{result.new_chat_member.status}'")
    
    chat = result.chat
    user = result.from_user # ฺฉุงุฑุจุฑ ฺฉู ูุถุนุช ุฑุง ุชุบุฑ ุฏุงุฏู (ุฑุจุงุช ุฑุง ุงุถุงูู ฺฉุฑุฏู)
    
    # ูุทูุฆู ูโุดูู ฺฉู ุชุบุฑ ูุถุนุช ูุฑุจูุท ุจู ุฑุจุงุช ูุงุณุช
    if result.new_chat_member.user.id != context.bot.id:
        return

    # --- ููุช ุฑุจุงุช ุจู ฺฏุฑูู ุงุถุงูู ูโุดูุฏ ---
    if result.new_chat_member.status in ('member', 'administrator') and result.old_chat_member.status not in ('member', 'administrator'):
        logger.info(f"CONDITION MET: Bot was added to group '{chat.title}' ({chat.id})")
        
        conn = get_db_connection()
        if not conn:
            logger.error("Database connection FAILED inside track_chats.")
            return
        
        logger.info("Database connection successful.")
        
        try:
            # ุจุฎุด ุจุฑุฑุณ ูุญุฏูุฏุช ูุตุจ (ฺฉุฏ ุงุตู ุดูุง)
            with conn.cursor() as cur:
                cur.execute("SELECT COUNT(*) FROM groups;")
                group_count = cur.fetchone()[0]

            if group_count >= GROUP_INSTALL_LIMIT:
                await chat.send_message(f"โ๏ธ ุธุฑูุช ูุตุจ ุงู ุฑุจุงุช ุชฺฉูู ุดุฏู ุงุณุช! ูุทูุงู ุจุง ูพุดุชุจุงู (@{SUPPORT_USERNAME}) ุชูุงุณ ุจฺฏุฑุฏ.")
                await context.bot.leave_chat(chat.id)
                for owner_id in OWNER_IDS:
                    await context.bot.send_message(owner_id, f"๐ ูุดุฏุงุฑ: ุณูู ูุตุจ ({GROUP_INSTALL_LIMIT}) ุชฺฉูู ุดุฏ. ุฑุจุงุช ุงุฒ ฺฏุฑูู `{chat.title}` ุฎุงุฑุฌ ุดุฏ.", parse_mode=ParseMode.MARKDOWN)
                return

            # ุซุจุช ุงุทูุงุนุงุช ุฏุฑ ุฏุชุงุจุณ
            member_count = await chat.get_member_count()
            with conn.cursor() as cur:
                cur.execute("INSERT INTO groups (group_id, title, member_count) VALUES (%s, %s, %s) ON CONFLICT (group_id) DO UPDATE SET title = EXCLUDED.title, member_count = EXCLUDED.member_count;", (chat.id, chat.title, member_count))
            conn.commit()
            logger.info("SUCCESS: Group info was inserted/updated in the database.")

            await chat.send_message("ุดูุง ุจู ููุฑุงูุงู ุฑุงููุณูู ูพูุณุชุฏ\n\n /start ุจุฑุง ูุตุจ ฺฉู ุฑุจุงุช ฺฉุงูุณุช ุงู ุฏุณุชูุฑ ุฑุง ุงุฑุณุงู ฺฉูุฏ\n\n /rsgame ุณูพุณ ุจุง ุชฺฉ ุฏุณุชูุฑ ุฑุจุงุช ูพูู ุจุงุฒ ูุง ุฑุง ุจุงุฒ ฺฉูุฏ\n\nุณูพุงุณ ุงุฒ ููุฑุงู ุดูุง...")

            # --- ุฌูุนโุขูุฑ ุงุทูุงุนุงุช ฺฉุงูู ุจุฑุง ฺฏุฒุงุฑุด ---
            
            # ฑ. ูพุฏุง ฺฉุฑุฏู ูุงูฺฉ ฺฏุฑูู
            owner_mention = "ูุงูุดุฎุต"
            try:
                admins = await context.bot.get_chat_administrators(chat.id)
                for admin in admins:
                    if admin.status == 'creator':
                        # ุณุงุฎุช ููุดู ูุงุจู ฺฉูฺฉ ุจุฑุง ูุงูฺฉ
                        owner_mention = f"[{admin.user.first_name}](tg://user?id={admin.user.id})"
                        break
            except Exception as e:
                logger.warning(f"Could not get group owner for {chat.id}: {e}")

            # ฒ. ุฏุฑุงูุช ููฺฉ ูุฑูุฏ (ุฏุฑ ุตูุฑุช ุฏุงุดุชู ุฏุณุชุฑุณ)
            invite_link_text = "ููฺฉ ุฏุฑุงูุช ูุดุฏ (ุฑุจุงุช ุงุฏูู ูุณุช)"
            try:
                link = await context.bot.export_chat_invite_link(chat.id)
                invite_link_text = f"[ูุฑูุฏ ุจู ฺฏุฑูู]({link})"
            except Exception as e:
                logger.warning(f"Could not get invite link for {chat.id}: {e}")
            
            # ณ. ุณุงุฎุช ููุดู ูุงุจู ฺฉูฺฉ ุจุฑุง ฺฉุงุฑุจุฑ ฺฉู ุฑุจุงุช ุฑุง ุงุถุงูู ฺฉุฑุฏู
            adder_mention = f"[{user.first_name}](tg://user?id={user.id})"

            # ด. ุณุงุฎุช ูุชู ููุง ฺฏุฒุงุฑุด
            report = (
                f"โ **ุฑุจุงุช ุจู ฺฏุฑูู ุฌุฏุฏ ุงุถุงูู ุดุฏ:**\n\n"
                f"๐ **ูุงู ฺฏุฑูู:** {chat.title}\n"
                f"๐ **ุขุฏ ุนุฏุฏ:** `{chat.id}`\n"
                f"๐ฅ **ุชุนุฏุงุฏ ุงุนุถุง:** {member_count} ููุฑ\n\n"
                f"๐ **ูุงูฺฉ ฺฏุฑูู:** {owner_mention}\n"
                f"๐ค **ุงุถุงูู ุดุฏู ุชูุณุท:** {adder_mention}\n"
                f"๐ **ููฺฉ ูุฑูุฏ:** {invite_link_text}"
            )
            
            # ต. ุงุฑุณุงู ฺฏุฒุงุฑุด ุจู ุชูุงู ุงุฏููโูุง ุงุตู
            for owner_id in OWNER_IDS:
                try: 
                    await context.bot.send_message(owner_id, report, parse_mode=ParseMode.MARKDOWN, disable_web_page_preview=True)
                except Exception as e:
                    logger.error(f"Failed to send report to owner {owner_id}: {e}")

        except Exception as e:
            logger.error(f"An unexpected error occurred in the main try block of track_chats: {e}")
        finally:
            conn.close()

    # --- ููุช ุฑุจุงุช ุงุฒ ฺฏุฑูู ุญุฐู ูโุดูุฏ ---
    elif result.new_chat_member.status in ('left', 'kicked'):
        logger.info(f"CONDITION MET: Bot was removed from group '{chat.title}' ({chat.id})")
        conn = get_db_connection()
        if conn:
            with conn.cursor() as cur:
                cur.execute("DELETE FROM groups WHERE group_id = %s;", (chat.id,))
            conn.commit()
            conn.close()
        
        report = f"โ **ุฑุจุงุช ุงุฒ ฺฏุฑูู ุฒุฑ ุงุฎุฑุงุฌ ุดุฏ:**\n\n๐ ูุงู: {chat.title}\n๐: `{chat.id}`"
        for owner_id in OWNER_IDS:
            try: 
                await context.bot.send_message(owner_id, report, parse_mode=ParseMode.MARKDOWN)
            except Exception: 
                pass

async def stop_games_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    ุฏุณุชูุฑ ูุบู ุชูุงู ุจุงุฒโูุง ูุนุงู ุฏุฑ ฺฉ ฺฏุฑูู ุชูุณุท ุงุฏูู.
    ุงู ุฏุณุชูุฑ ุจุงุฒโูุง ูุงุดูุงุณ (ูุงุฑฺ) ุฑุง ูุบู ููโฺฉูุฏ.
    """
    chat = update.effective_chat
    user = update.effective_user

    # ฑ. ุงู ุฏุณุชูุฑ ููุท ุฏุฑ ฺฏุฑููโูุง ฺฉุงุฑ ูโฺฉูุฏ
    if chat.type == 'private':
        await update.message.reply_text("ุงู ุฏุณุชูุฑ ููุท ุฏุฑ ฺฏุฑููโูุง ูุงุจู ุงุณุชูุงุฏู ุงุณุช.")
        return

    # ฒ. ููุท ุงุฏููโูุง ูโุชูุงููุฏ ุงุฒ ุงู ุฏุณุชูุฑ ุงุณุชูุงุฏู ฺฉููุฏ
    if not await is_group_admin(user.id, chat.id, context):
        await update.message.reply_text("โ ุดูุง ุงุฌุงุฒู ุงุณุชูุงุฏู ุงุฒ ุงู ุฏุณุชูุฑ ุฑุง ูุฏุงุฑุฏ. ุงู ุฏุณุชูุฑ ูุฎุตูุต ูุฏุฑุงู ุงุณุช.")
        return
        
    chat_id = chat.id
    canceled_count = 0

    # ณ. ูุณุช ุจุงุฒโูุง ฺฉู ุจุงุฏ ูุบู ุดููุฏ
    # ุจุงุฒ ูุงุฑฺ (gharch) ุฏุฑ ุงู ูุณุช ูุณุช
    games_to_cancel = ['hangman', 'typing', 'guess_number']

    for game_key in games_to_cancel:
        # ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ุจุงุฒ ุงุฒ ุงู ููุน ุฏุฑ ุงู ฺฏุฑูู ูุนุงู ุงุณุช ุง ุฎุฑ
        if chat_id in active_games.get(game_key, {}):
            # ุญุฐู ุชูุงู ุจุงุฒโูุง ูุนุงู ุขู ููุน ุงุฒ ฺฏุฑูู ูุนู
            del active_games[game_key][chat_id]
            canceled_count += 1
            
    # ด. ุงุฑุณุงู ูพุงู ูุชุฌู ุจู ุงุฏูู
    if canceled_count > 0:
        await update.message.reply_text(f"โ ุจุง ููููุช {canceled_count} ููุน ุจุงุฒ ูุนุงู ูุบู ุดุฏ.")
    else:
        await update.message.reply_text("ูฺ ุจุงุฒ ูุนุงู ุจุฑุง ูุบู ฺฉุฑุฏู ุฏุฑ ุงู ฺฏุฑูู ูุฌูุฏ ูุฏุงุดุช.")

async def text_help_trigger(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ุจุง ุฏุฑุงูุช ฺฉููู 'ุฑุงูููุง'ุ ูพูู ุชุนุงูู ุฑุงูููุง ุจุงุฒโูุง ุฑุง ุงุฑุณุงู ูโฺฉูุฏ."""
    user = update.effective_user
    text = f"ุฑุงูููุง ุจุงุฒโูุง ุจุฑุง {user.mention_html()}\n\n" \
           "ูุทูุงู ุจุฑุง ูุดุงูุฏู ุชูุถุญุงุชุ ุฑู ูุงู ูุฑ ุจุงุฒ ฺฉูฺฉ ฺฉูุฏ:"

    # ุณุงุฎุช ุฏฺฉููโูุง ูพูู ุงุตู ุฑุงูููุง
    # user_id ุฑุง ุจู callback_data ุงุถุงูู ูโฺฉูู ุชุง ูพูู ุงุฎุชุตุงุต ุดูุฏ
    keyboard = [
        [
            InlineKeyboardButton("๐ ุจุงุฒโูุง ฺฏุฑูู", callback_data=f"help_cat_board_{user.id}"),
            InlineKeyboardButton("๐ค ุจุงุฒโูุง ุชฺฉโููุฑู", callback_data=f"help_cat_single_{user.id}")
        ],
        [
            InlineKeyboardButton("โ๏ธ ุจุงุฒโูุง ุชุงูพ", callback_data=f"help_cat_typing_{user.id}"),
            InlineKeyboardButton("๐คซ ุจุงุฒโูุง ูุงุดูุงุณ", callback_data=f"help_cat_anon_{user.id}")
        ],
        [InlineKeyboardButton("โ๏ธ ุจุณุชู ูพูู", callback_data=f"help_close_{user.id}")]
    ]

    await update.message.reply_text(text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode=ParseMode.HTML)

async def help_panel_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """ฺฉูฺฉ ุฑู ุฏฺฉููโูุง ูพูู ุฑุงูููุง ุฑุง ูุฏุฑุช ูโฺฉูุฏ."""
    query = update.callback_query
    user = query.from_user
    data = query.data.split('_')
    
    # --- ุจุฎุด ุงููุช (ุจุฏูู ุชุบุฑ) ---
    try:
        target_user_id = int(data[-1])
        if user.id != target_user_id:
            await query.answer("ุงู ูพูู ุฑุงูููุง ุจุฑุง ุดูุง ูุณุช!", show_alert=True)
            return
    except (ValueError, IndexError):
        await query.answer("ุฎุทุง: ุฏฺฉูู ูุงูุนุชุจุฑ ุงุณุช.", show_alert=True)
        return
    # --- ูพุงุงู ุจุฎุด ุงููุช ---

    await query.answer()
    action = data[1]

    if action == "close":
        try:
            await query.delete_message()
        except Exception:
            await query.edit_message_text("ูพูู ุฑุงูููุง ุจุณุชู ุดุฏ.")
        return
        
    elif action == "main":
        # ... (ุงู ุจุฎุด ุจุฏูู ุชุบุฑ ุจุงู ูโูุงูุฏ)
        text = f"ุฑุงูููุง ุจุงุฒโูุง ุจุฑุง {user.mention_html()}\n\n" \
               "ูุทูุงู ุจุฑุง ูุดุงูุฏู ุชูุถุญุงุชุ ุฑู ูุงู ูุฑ ุจุงุฒ ฺฉูฺฉ ฺฉูุฏ:"
        keyboard = [
            [
                InlineKeyboardButton("๐ ุจุงุฒโูุง ฺฏุฑูู", callback_data=f"help_cat_board_{user.id}"),
                InlineKeyboardButton("๐ค ุจุงุฒโูุง ุชฺฉโููุฑู", callback_data=f"help_cat_single_{user.id}")
            ],
            [
                InlineKeyboardButton("โ๏ธ ุจุงุฒโูุง ุชุงูพ", callback_data=f"help_cat_typing_{user.id}"),
                InlineKeyboardButton("๐คซ ุจุงุฒโูุง ูุงุดูุงุณ", callback_data=f"help_cat_anon_{user.id}")
            ],
            [InlineKeyboardButton("โ๏ธ ุจุณุชู ูพูู", callback_data=f"help_close_{user.id}")]
        ]
        await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode=ParseMode.HTML)

    elif action == "game":
        # ========== ุงู ุจุฎุด ุงุตูุงุญ ุดุฏู ุงุณุช ==========
        # ฺฉูุฏ ุจุงุฒ ููฺฉู ุงุณุช ฺูุฏ ุจุฎุด ุจุงุดุฏ (ูุซู hads_kalame)
        # ูพุณ ุชูุงู ุจุฎุดโูุง ุจู 'game' ู ุขุฏ ุนุฏุฏ ุฑุง ุจู ูู ูโฺุณุจุงูู
        game_key = "_".join(data[2:-1])
        # ==========================================
        
        game_name = " ".join(word.capitalize() for word in game_key.replace('_', ' ').split())
        description = GAME_DESCRIPTIONS.get(game_key, "ุชูุถุญุงุช ุงู ุจุงุฒ ุงูุช ูุดุฏ.")
        keyboard = [[InlineKeyboardButton("๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู", callback_data=f"help_main_{user.id}")]]
        await query.edit_message_text(f"๐ **ุชูุถุญุงุช ุจุงุฒ {game_name}**:\n\n{description}", 
                                      reply_markup=InlineKeyboardMarkup(keyboard), 
                                      parse_mode=ParseMode.MARKDOWN)

    elif action == "cat":
        # ... (ุงู ุจุฎุด ุจุฏูู ุชุบุฑ ู ฺฉุงูู ุงุณุช) ...
        category = data[2]
        keyboard = []
        text = "ูุทูุง ุจุงุฒ ููุฑุฏ ูุธุฑ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:"

        if category == "board":
            text = "๐ **ุฑุงูููุง ุจุงุฒโูุง ฺฏุฑูู:**"
            keyboard.extend([
                [InlineKeyboardButton("ุญฺฉู", callback_data=f"help_game_hokm_{user.id}")],
                [InlineKeyboardButton("ุฏูุฒ (ฒ ููุฑู)", callback_data=f"help_game_dooz_{user.id}")],
                [InlineKeyboardButton("ุฏูุฒ (ด ููุฑู)", callback_data=f"help_game_doz4p_{user.id}")],
                [InlineKeyboardButton("ฺูุงุฑ ุฏุฑ ฺฉ ุฑุฏู", callback_data=f"help_game_connect4_{user.id}")],
                [InlineKeyboardButton("ุณูฺฏ ฺฉุงุบุฐ ูฺ", callback_data=f"help_game_rps_{user.id}")],
                [InlineKeyboardButton("ุจุงุฒ ุญุงูุธู", callback_data=f"help_game_memory_{user.id}")],
            ])
        
        elif category == "single":
            text = "๐ค **ุฑุงูููุง ุจุงุฒโูุง ุชฺฉโููุฑู:**"
            keyboard.extend([
                [InlineKeyboardButton("2048", callback_data=f"help_game_2048_{user.id}")],
                [InlineKeyboardButton("ูพุงุฒู ฺฉุดู", callback_data=f"help_game_spuzzle_{user.id}")],
                [InlineKeyboardButton("ุจุงุฒ ุฌูุชโูุง", callback_data=f"help_game_samegame_{user.id}")],
            ])

        elif category == "typing":
            text = "โ๏ธ **ุฑุงูููุง ุจุงุฒโูุง ุชุงูพ ู ุณุฑุนุช:**"
            keyboard.extend([
                [InlineKeyboardButton("ุญุฏุณ ฺฉููู", callback_data=f"help_game_hads_kalame_{user.id}")],
                [InlineKeyboardButton("ุชุงูพ ุณุฑุนุช", callback_data=f"help_game_type_speed_{user.id}")],
                [InlineKeyboardButton("ุญุฏุณ ุนุฏุฏ", callback_data=f"help_game_hads_addad_{user.id}")],
            ])

        elif category == "anon":
            text = "๐คซ **ุฑุงูููุง ุจุงุฒโูุง ูุงุดูุงุณ ู ุงุฏูู:**"
            keyboard.extend([
                [InlineKeyboardButton("ุงุนุชุฑุงู", callback_data=f"help_game_eteraf_{user.id}")],
                [InlineKeyboardButton("ูุงุฑฺ", callback_data=f"help_game_gharch_{user.id}")],
                [InlineKeyboardButton("ฺฏุฑุฏููู ุดุงูุณ", callback_data=f"help_game_gardone_{user.id}")],
            ])
        
        keyboard.append([InlineKeyboardButton("๐ ุจุงุฒฺฏุดุช ุจู ููู ุงุตู", callback_data=f"help_main_{user.id}")])
        await query.edit_message_text(text, reply_markup=InlineKeyboardMarkup(keyboard), parse_mode=ParseMode.MARKDOWN)

async def ping_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    ุณุฑุนุช ูพุงุณุฎโุฏู (latency) ุฑุจุงุช ุฑุง ูุญุงุณุจู ฺฉุฑุฏู ู ููุท ุจุฑุง ูุงูฺฉ ุฑุจุงุช ุงุฑุณุงู ูโฺฉูุฏ.
    """
    # ฑ. ุฒูุงู ุดุฑูุน ุฑุง ูุจู ุงุฒ ุงุฑุณุงู ูพุงู ุซุจุช ูโฺฉูู
    start_time = time.time()
    
    # ฒ. ฺฉ ูพุงู ุงููู ุงุฑุณุงู ูโฺฉูู ุชุง ุจุชูุงูู ุขู ุฑุง ูุฑุงุด ฺฉูู
    message = await update.message.reply_text("...")
    
    # ณ. ุฒูุงู ูพุงุงู ุฑุง ูพุณ ุงุฒ ุงุฑุณุงู ูพุงู ุซุจุช ูโฺฉูู
    end_time = time.time()
    
    # ด. ุงุฎุชูุงู ุฒูุงู ุฑุง ูุญุงุณุจู ู ุจู ููโุซุงูู ุชุจุฏู ูโฺฉูู
    latency_s = end_time - start_time
    
    # ต. ูพุงู ุงููู ุฑุง ุจุง ูุชุฌู ููุง ูุฑุงุด ูโฺฉูู
    await message.edit_text(f"ุฑุงูู ฺฏู ุขููุงู ุงุณุช!\n\nโก๏ธูพุงุณุฎฺฏู: {latency_s:.4f} ุซุงูู")

# =================================================================
def main() -> None:
    """Start the bot."""
    setup_database()
    BOT_TOKEN = os.environ.get("BOT_TOKEN")
    if not BOT_TOKEN:
        logger.critical("BOT_TOKEN environment variable not set.")
        return

    application = Application.builder().token(BOT_TOKEN).build()
    
    # --- Conversation Handlers ---
    gharch_conv = ConversationHandler(
        entry_points=[CallbackQueryHandler(gharch_start_callback, pattern=r'^gharch_start_')],
        states={
            ASKING_GOD_USERNAME: [MessageHandler(filters.TEXT & ~filters.COMMAND, receive_god_username)],
            CONFIRMING_GOD: [CallbackQueryHandler(confirm_god, pattern=r'^gharch_confirm_god_')],
        },
        fallbacks=[CommandHandler('cancel', cancel_gharch_conv)],
        per_user=False, per_chat=True,
    )
    
    guess_number_conv = ConversationHandler(
        entry_points=[CallbackQueryHandler(hads_addad_start_callback, pattern=r'^hads_addad_start_')],
        states={
            SELECTING_RANGE: [MessageHandler(filters.TEXT & ~filters.COMMAND, receive_range)],
            GUESSING: [MessageHandler(filters.Regex(r'^[\dฐ-น]+$'), handle_guess_conversation)],
        },
        fallbacks=[CommandHandler('cancel', cancel_game_conversation)],
        per_user=False, per_chat=True
    )

    eteraf_conv = ConversationHandler(
        entry_points=[CallbackQueryHandler(eteraf_start_callback, pattern=r'^eteraf_start_custom_')],
        states={
            ENTERING_ETERAF_TEXT: [MessageHandler(filters.TEXT & ~filters.COMMAND, receive_eteraf_text)]
        },
        fallbacks=[CommandHandler('cancel', cancel_game_conversation)],
        per_user=True, per_chat=False
    )
    
    application.add_handler(gharch_conv)
    application.add_handler(guess_number_conv)
    application.add_handler(eteraf_conv)

    # --- Command Handlers (ุจุฏูู ุชุบุฑ) ---
    application.add_handler(CommandHandler("start", start_command))
    application.add_handler(CommandHandler("rsgame", rsgame_command))
    application.add_handler(CommandHandler("stop", stop_games_command))
    
    # ุฏุณุชูุฑุงุช ูุงูฺฉ ุฑุจุงุช (ุจุฏูู ุชุบุฑ)
    application.add_handler(CommandHandler("setstart", set_start_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("stats", stats_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("fwdusers", fwdusers_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("fwdgroups", fwdgroups_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("leave", leave_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("grouplist", grouplist_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("join", join_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("ban_user", ban_user_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("unban_user", unban_user_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("ban_group", ban_group_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("unban_group", unban_group_command, filters=filters.User(OWNER_IDS)))
    application.add_handler(CommandHandler("checkgps", checkgps_command, filters=filters.User(OWNER_IDS)))

    # ========================== ุจุฎุด ุงุตู ุชุบุฑุงุช ุงูุฌุงุณุช ==========================
    # --- CallbackQueryHandlers ---
    # ุชุฑุชุจ ุจุณุงุฑ ููู ุงุณุช: ุงุฒ ููุฏูุฑูุง ุงุฎุชุตุงุตโุชุฑ ุจู ุนูููโุชุฑ ูโุฑูู.

    # ฑ. ููุฏูุฑูุง ุนููู ุฑุงุจุท ฺฉุงุฑุจุฑ (ฺฉู ุจุฎุด ุงุฒ ฺฉ ุจุงุฒ ุฎุงุต ูุณุชูุฏ)
    application.add_handler(CallbackQueryHandler(rsgame_check_join_callback, pattern=r'^rsgame_check_join$'))
    application.add_handler(CallbackQueryHandler(rsgame_close_callback, pattern=r'^rsgame_close_'))
    application.add_handler(CallbackQueryHandler(rsgame_pv_callback, pattern=r'^rsgame_cat_main_pv$'))
    
    # ฒ. ุชูุงู ููุฏูุฑูุง ูุฑุจูุท ุจู ุจุงุฒโูุง (ุดุฑูุน ู ุญุฑฺฉุงุช ุฏุงุฎู)
    # ุงูโูุง ุจุงุฏ ูุจู ุงุฒ ููุฏูุฑ ุนููู ููููุง ุจุงูุฏ
    application.add_handler(CallbackQueryHandler(hads_kalame_start_callback, pattern=r'^hads_kalame_start_'))
    application.add_handler(CallbackQueryHandler(type_start_callback, pattern=r'^type_start_'))
    application.add_handler(CallbackQueryHandler(eteraf_start_callback, pattern=r'^eteraf_start_default_'))
    
    application.add_handler(CallbackQueryHandler(hokm_callback, pattern=r'^hokm_'))
    application.add_handler(CallbackQueryHandler(dooz_callback, pattern=r'^dooz_'))
    application.add_handler(CallbackQueryHandler(connect4_callback, pattern=r'^connect4_'))
    application.add_handler(CallbackQueryHandler(rps_callback, pattern=r'^rps_'))
    application.add_handler(CallbackQueryHandler(memory_callback, pattern=r'^memory_'))
    application.add_handler(CallbackQueryHandler(game_2048_callback, pattern=r'^2048_'))
    application.add_handler(CallbackQueryHandler(samegame_callback, pattern=r'^samegame_'))
    application.add_handler(CallbackQueryHandler(spuzzle_callback, pattern=r'^spuzzle_'))
    application.add_handler(CallbackQueryHandler(doz4p_callback, pattern=r'^doz4p_'))
    application.add_handler(CallbackQueryHandler(gardone_callback, pattern=r'^gardone_'))
    # ณ. ููุฏูุฑ ุนููู ูุงูุจุฑ ุฏุฑ ููููุง (ุจุงุฏ ุฏุฑ ุขุฎุฑ ุงู ุจุฎุด ุจุงุดุฏ)
    application.add_handler(CallbackQueryHandler(help_panel_callback, pattern=r'^help_'))
    # ุงู ููุฏูุฑ ููุท ุฒูุงู ุงุฌุฑุง ูโุดูุฏ ฺฉู ูฺโฺฉุฏุงู ุงุฒ ุงูฺฏููุง ุงุฎุชุตุงุตโุชุฑ ุจุงูุง ูุทุงุจูุช ูุฏุงุดุชู ุจุงุดูุฏ
    application.add_handler(CallbackQueryHandler(rsgame_callback_handler, pattern=r'^rsgame_cat_'))
    
    # ========================== ูพุงุงู ุจุฎุด ุชุบุฑุงุช ==========================

    # --- Message Handlers (ุจุฏูู ุชุบุฑ) ---
    application.add_handler(MessageHandler(filters.Regex(r'^ุฑุงูููุง$'), text_help_trigger))
    application.add_handler(MessageHandler(filters.Regex(r'^ูพูฺฏ$') & filters.User(OWNER_IDS), ping_command))
    application.add_handler(MessageHandler(filters.Regex(r'^[ุข-]$') & filters.ChatType.GROUPS, handle_letter_guess))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND & filters.ChatType.PRIVATE, handle_anonymous_message))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND & filters.ChatType.GROUPS, handle_typing_attempt))
    
    # --- ุณุงุฑ Handler ูุง (ุจุฏูู ุชุบุฑ) ---
    application.add_handler(ChatMemberHandler(track_chats, ChatMemberHandler.MY_CHAT_MEMBER))
    
    logger.info("Bot is starting with the new refactored logic...")
    application.run_polling()

if __name__ == "__main__":
    main()
